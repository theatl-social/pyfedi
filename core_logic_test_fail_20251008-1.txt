2025-10-08T16:23:23.6418920Z Current runner version: '2.328.0'
2025-10-08T16:23:23.6445080Z ##[group]Runner Image Provisioner
2025-10-08T16:23:23.6445843Z Hosted Compute Agent
2025-10-08T16:23:23.6446441Z Version: 20250912.392
2025-10-08T16:23:23.6447019Z Commit: d921fda672a98b64f4f82364647e2f10b2267d0b
2025-10-08T16:23:23.6447670Z Build Date: 2025-09-12T15:23:14Z
2025-10-08T16:23:23.6448295Z ##[endgroup]
2025-10-08T16:23:23.6448842Z ##[group]Operating System
2025-10-08T16:23:23.6449744Z Ubuntu
2025-10-08T16:23:23.6450297Z 24.04.3
2025-10-08T16:23:23.6450719Z LTS
2025-10-08T16:23:23.6451155Z ##[endgroup]
2025-10-08T16:23:23.6451632Z ##[group]Runner Image
2025-10-08T16:23:23.6452208Z Image: ubuntu-24.04
2025-10-08T16:23:23.6452696Z Version: 20250929.60.1
2025-10-08T16:23:23.6453676Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250929.60/images/ubuntu/Ubuntu2404-Readme.md
2025-10-08T16:23:23.6455192Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250929.60
2025-10-08T16:23:23.6456218Z ##[endgroup]
2025-10-08T16:23:23.6458623Z ##[group]GITHUB_TOKEN Permissions
2025-10-08T16:23:23.6461325Z Actions: write
2025-10-08T16:23:23.6461870Z Attestations: write
2025-10-08T16:23:23.6462377Z Checks: write
2025-10-08T16:23:23.6463143Z Contents: write
2025-10-08T16:23:23.6463919Z Deployments: write
2025-10-08T16:23:23.6464608Z Discussions: write
2025-10-08T16:23:23.6465089Z Issues: write
2025-10-08T16:23:23.6465677Z Metadata: read
2025-10-08T16:23:23.6466121Z Models: read
2025-10-08T16:23:23.6466578Z Packages: write
2025-10-08T16:23:23.6467082Z Pages: write
2025-10-08T16:23:23.6467561Z PullRequests: write
2025-10-08T16:23:23.6468070Z RepositoryProjects: write
2025-10-08T16:23:23.6468666Z SecurityEvents: write
2025-10-08T16:23:23.6469490Z Statuses: write
2025-10-08T16:23:23.6469955Z ##[endgroup]
2025-10-08T16:23:23.6472587Z Secret source: Actions
2025-10-08T16:23:23.6473254Z Prepare workflow directory
2025-10-08T16:23:23.6807949Z Prepare all required actions
2025-10-08T16:23:23.6845994Z Getting action download info
2025-10-08T16:23:24.0285923Z Download action repository 'actions/checkout@v4' (SHA:08eba0b27e820071cde6df949e0beb9ba4906955)
2025-10-08T16:23:24.0988805Z Download action repository 'actions/setup-python@v5' (SHA:a26af69be951a213d495a4c3e4e4022e16d87065)
2025-10-08T16:23:24.1934496Z Download action repository 'actions/cache@v4' (SHA:0057852bfaa89a56745cba8c7296529d2fc39830)
2025-10-08T16:23:24.3638625Z Complete job name: 🔒 Core Logic Tests
2025-10-08T16:23:24.4365740Z ##[group]Run actions/checkout@v4
2025-10-08T16:23:24.4366670Z with:
2025-10-08T16:23:24.4367198Z   repository: theatl-social/pyfedi
2025-10-08T16:23:24.4367928Z   token: ***
2025-10-08T16:23:24.4368368Z   ssh-strict: true
2025-10-08T16:23:24.4368820Z   ssh-user: git
2025-10-08T16:23:24.4369475Z   persist-credentials: true
2025-10-08T16:23:24.4369990Z   clean: true
2025-10-08T16:23:24.4370461Z   sparse-checkout-cone-mode: true
2025-10-08T16:23:24.4371004Z   fetch-depth: 1
2025-10-08T16:23:24.4371464Z   fetch-tags: false
2025-10-08T16:23:24.4371958Z   show-progress: true
2025-10-08T16:23:24.4372428Z   lfs: false
2025-10-08T16:23:24.4372850Z   submodules: false
2025-10-08T16:23:24.4373303Z   set-safe-directory: true
2025-10-08T16:23:24.4374213Z ##[endgroup]
2025-10-08T16:23:24.5427093Z Syncing repository: theatl-social/pyfedi
2025-10-08T16:23:24.5428928Z ##[group]Getting Git version info
2025-10-08T16:23:24.5429837Z Working directory is '/home/runner/work/pyfedi/pyfedi'
2025-10-08T16:23:24.5430891Z [command]/usr/bin/git version
2025-10-08T16:23:24.5465981Z git version 2.51.0
2025-10-08T16:23:24.5491537Z ##[endgroup]
2025-10-08T16:23:24.5505859Z Temporarily overriding HOME='/home/runner/work/_temp/003717cc-4572-4fc9-b37a-881ab6228d9b' before making global git config changes
2025-10-08T16:23:24.5507311Z Adding repository directory to the temporary git global config as a safe directory
2025-10-08T16:23:24.5511375Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/pyfedi/pyfedi
2025-10-08T16:23:24.5546644Z Deleting the contents of '/home/runner/work/pyfedi/pyfedi'
2025-10-08T16:23:24.5550450Z ##[group]Initializing the repository
2025-10-08T16:23:24.5554557Z [command]/usr/bin/git init /home/runner/work/pyfedi/pyfedi
2025-10-08T16:23:24.5643105Z hint: Using 'master' as the name for the initial branch. This default branch name
2025-10-08T16:23:24.5645000Z hint: is subject to change. To configure the initial branch name to use in all
2025-10-08T16:23:24.5646285Z hint: of your new repositories, which will suppress this warning, call:
2025-10-08T16:23:24.5647762Z hint:
2025-10-08T16:23:24.5648829Z hint: 	git config --global init.defaultBranch <name>
2025-10-08T16:23:24.5650405Z hint:
2025-10-08T16:23:24.5651782Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2025-10-08T16:23:24.5653590Z hint: 'development'. The just-created branch can be renamed via this command:
2025-10-08T16:23:24.5654926Z hint:
2025-10-08T16:23:24.5655691Z hint: 	git branch -m <name>
2025-10-08T16:23:24.5656627Z hint:
2025-10-08T16:23:24.5657881Z hint: Disable this message with "git config set advice.defaultBranchName false"
2025-10-08T16:23:24.5660089Z Initialized empty Git repository in /home/runner/work/pyfedi/pyfedi/.git/
2025-10-08T16:23:24.5662995Z [command]/usr/bin/git remote add origin https://github.com/theatl-social/pyfedi
2025-10-08T16:23:24.5692711Z ##[endgroup]
2025-10-08T16:23:24.5694022Z ##[group]Disabling automatic garbage collection
2025-10-08T16:23:24.5697500Z [command]/usr/bin/git config --local gc.auto 0
2025-10-08T16:23:24.5726121Z ##[endgroup]
2025-10-08T16:23:24.5726830Z ##[group]Setting up auth
2025-10-08T16:23:24.5732869Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-10-08T16:23:24.5762551Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-10-08T16:23:24.6017801Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-10-08T16:23:24.6046260Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-10-08T16:23:24.6285670Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2025-10-08T16:23:24.6320823Z ##[endgroup]
2025-10-08T16:23:24.6322067Z ##[group]Fetching the repository
2025-10-08T16:23:24.6328879Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +9d26b2075743a17ae9921c3f1ecb41caa6050322:refs/remotes/pull/30/merge
2025-10-08T16:23:25.1555696Z From https://github.com/theatl-social/pyfedi
2025-10-08T16:23:25.1557340Z  * [new ref]         9d26b2075743a17ae9921c3f1ecb41caa6050322 -> pull/30/merge
2025-10-08T16:23:25.1586312Z ##[endgroup]
2025-10-08T16:23:25.1587536Z ##[group]Determining the checkout info
2025-10-08T16:23:25.1588821Z ##[endgroup]
2025-10-08T16:23:25.1593332Z [command]/usr/bin/git sparse-checkout disable
2025-10-08T16:23:25.1633228Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2025-10-08T16:23:25.1662843Z ##[group]Checking out the ref
2025-10-08T16:23:25.1666907Z [command]/usr/bin/git checkout --progress --force refs/remotes/pull/30/merge
2025-10-08T16:23:25.2394250Z Note: switching to 'refs/remotes/pull/30/merge'.
2025-10-08T16:23:25.2395493Z 
2025-10-08T16:23:25.2396141Z You are in 'detached HEAD' state. You can look around, make experimental
2025-10-08T16:23:25.2397639Z changes and commit them, and you can discard any commits you make in this
2025-10-08T16:23:25.2399743Z state without impacting any branches by switching back to a branch.
2025-10-08T16:23:25.2401320Z 
2025-10-08T16:23:25.2402326Z If you want to create a new branch to retain commits you create, you may
2025-10-08T16:23:25.2404545Z do so (now or later) by using -c with the switch command. Example:
2025-10-08T16:23:25.2406450Z 
2025-10-08T16:23:25.2407013Z   git switch -c <new-branch-name>
2025-10-08T16:23:25.2407916Z 
2025-10-08T16:23:25.2408438Z Or undo this operation with:
2025-10-08T16:23:25.2409548Z 
2025-10-08T16:23:25.2410057Z   git switch -
2025-10-08T16:23:25.2410787Z 
2025-10-08T16:23:25.2411887Z Turn off this advice by setting config variable advice.detachedHead to false
2025-10-08T16:23:25.2413528Z 
2025-10-08T16:23:25.2415421Z HEAD is now at 9d26b20 Merge 000a89361e1eaa52ff6bdad103871861f6fb82f1 into 6b86d33d18a97451115234de4d16c3b57dbaf0ba
2025-10-08T16:23:25.2420442Z ##[endgroup]
2025-10-08T16:23:25.2446836Z [command]/usr/bin/git log -1 --format=%H
2025-10-08T16:23:25.2470051Z 9d26b2075743a17ae9921c3f1ecb41caa6050322
2025-10-08T16:23:25.2786755Z ##[group]Run actions/setup-python@v5
2025-10-08T16:23:25.2787942Z with:
2025-10-08T16:23:25.2788758Z   python-version: 3.13
2025-10-08T16:23:25.2789991Z   check-latest: false
2025-10-08T16:23:25.2791200Z   token: ***
2025-10-08T16:23:25.2792075Z   update-environment: true
2025-10-08T16:23:25.2793162Z   allow-prereleases: false
2025-10-08T16:23:25.2794191Z   freethreaded: false
2025-10-08T16:23:25.2795133Z ##[endgroup]
2025-10-08T16:23:25.4441612Z ##[group]Installed versions
2025-10-08T16:23:25.4526340Z Successfully set up CPython (3.13.7)
2025-10-08T16:23:25.4529305Z ##[endgroup]
2025-10-08T16:23:25.6155290Z ##[group]Run actions/cache@v4
2025-10-08T16:23:25.6156305Z with:
2025-10-08T16:23:25.6157041Z   path: ~/.cache/pip
2025-10-08T16:23:25.6158519Z   key: Linux-pip-93b72d60a1f660b784d6309a0b22f127a738518ffed9eeb65aa476cd228c20e5
2025-10-08T16:23:25.6160418Z   restore-keys: Linux-pip-

2025-10-08T16:23:25.6161421Z   enableCrossOsArchive: false
2025-10-08T16:23:25.6162433Z   fail-on-cache-miss: false
2025-10-08T16:23:25.6163388Z   lookup-only: false
2025-10-08T16:23:25.6164232Z   save-always: false
2025-10-08T16:23:25.6165076Z env:
2025-10-08T16:23:25.6166043Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:25.6167745Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:23:25.6169674Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:25.6171200Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:25.6172743Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:25.6174367Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:23:25.6175672Z ##[endgroup]
2025-10-08T16:23:25.8618940Z Cache hit for: Linux-pip-93b72d60a1f660b784d6309a0b22f127a738518ffed9eeb65aa476cd228c20e5
2025-10-08T16:23:26.3940917Z Received 105551174 of 105551174 (100.0%), 209.3 MBs/sec
2025-10-08T16:23:26.3943215Z Cache Size: ~101 MB (105551174 B)
2025-10-08T16:23:26.3977709Z [command]/usr/bin/tar -xf /home/runner/work/_temp/293ef47b-8362-4ef0-867a-de4020c4ffc3/cache.tzst -P -C /home/runner/work/pyfedi/pyfedi --use-compress-program unzstd
2025-10-08T16:23:26.6522163Z Cache restored successfully
2025-10-08T16:23:26.6801680Z Cache restored from key: Linux-pip-93b72d60a1f660b784d6309a0b22f127a738518ffed9eeb65aa476cd228c20e5
2025-10-08T16:23:26.6936600Z ##[group]Run python -m pip install --upgrade pip
2025-10-08T16:23:26.6937030Z [36;1mpython -m pip install --upgrade pip[0m
2025-10-08T16:23:26.6937375Z [36;1mpip install -r requirements.txt[0m
2025-10-08T16:23:26.6937667Z [36;1mpip install pytest[0m
2025-10-08T16:23:26.6981071Z shell: /usr/bin/bash -e {0}
2025-10-08T16:23:26.6981340Z env:
2025-10-08T16:23:26.6981605Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:26.6982041Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:23:26.6982458Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:26.6982818Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:26.6983196Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:26.6983559Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:23:26.6984081Z ##[endgroup]
2025-10-08T16:23:28.9410852Z Requirement already satisfied: pip in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (25.2)
2025-10-08T16:23:29.5371069Z Collecting urllib3~=1.26.20 (from -r requirements.txt (line 1))
2025-10-08T16:23:29.5384498Z   Using cached urllib3-1.26.20-py2.py3-none-any.whl.metadata (50 kB)
2025-10-08T16:23:29.5638025Z Collecting Flask==3.1.1 (from -r requirements.txt (line 2))
2025-10-08T16:23:29.5649717Z   Using cached flask-3.1.1-py3-none-any.whl.metadata (3.0 kB)
2025-10-08T16:23:29.5832483Z Collecting python-dotenv==1.0.0 (from -r requirements.txt (line 3))
2025-10-08T16:23:29.5843388Z   Using cached python_dotenv-1.0.0-py3-none-any.whl.metadata (21 kB)
2025-10-08T16:23:29.6010280Z Collecting flask-wtf==1.2.2 (from -r requirements.txt (line 4))
2025-10-08T16:23:29.6021215Z   Using cached flask_wtf-1.2.2-py3-none-any.whl.metadata (3.4 kB)
2025-10-08T16:23:29.6175394Z Collecting flask-sqlalchemy==3.1.1 (from -r requirements.txt (line 5))
2025-10-08T16:23:29.6186348Z   Using cached flask_sqlalchemy-3.1.1-py3-none-any.whl.metadata (3.4 kB)
2025-10-08T16:23:29.6350627Z Collecting flask-migrate~=4.1.0 (from -r requirements.txt (line 6))
2025-10-08T16:23:29.6361506Z   Using cached Flask_Migrate-4.1.0-py3-none-any.whl.metadata (3.3 kB)
2025-10-08T16:23:29.6491796Z Collecting flask-login==0.6.3 (from -r requirements.txt (line 7))
2025-10-08T16:23:29.6502520Z   Using cached Flask_Login-0.6.3-py3-none-any.whl.metadata (5.8 kB)
2025-10-08T16:23:29.6653624Z Collecting email-validator==2.0.0 (from -r requirements.txt (line 9))
2025-10-08T16:23:29.6664558Z   Using cached email_validator-2.0.0-py3-none-any.whl.metadata (25 kB)
2025-10-08T16:23:29.6821287Z Collecting flask-mail~=0.10.0 (from -r requirements.txt (line 10))
2025-10-08T16:23:29.6832095Z   Using cached flask_mail-0.10.0-py3-none-any.whl.metadata (2.1 kB)
2025-10-08T16:23:29.6959696Z Collecting flask-babel~=4.0.0 (from -r requirements.txt (line 11))
2025-10-08T16:23:29.6970617Z   Using cached flask_babel-4.0.0-py3-none-any.whl.metadata (1.9 kB)
2025-10-08T16:23:29.7099981Z Collecting flask-bcrypt~=1.0.0 (from -r requirements.txt (line 12))
2025-10-08T16:23:29.7111279Z   Using cached Flask_Bcrypt-1.0.1-py3-none-any.whl.metadata (2.6 kB)
2025-10-08T16:23:29.7738708Z Collecting psycopg2-binary (from -r requirements.txt (line 13))
2025-10-08T16:23:29.7751595Z   Using cached psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
2025-10-08T16:23:29.7964383Z Collecting httpx~=0.28.0 (from httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:29.7975634Z   Using cached httpx-0.28.1-py3-none-any.whl.metadata (7.1 kB)
2025-10-08T16:23:29.8168340Z Collecting pyjwt==2.8.0 (from -r requirements.txt (line 15))
2025-10-08T16:23:29.8179895Z   Using cached PyJWT-2.8.0-py3-none-any.whl.metadata (4.2 kB)
2025-10-08T16:23:29.8337974Z Collecting SQLAlchemy-Searchable==2.1.0 (from -r requirements.txt (line 16))
2025-10-08T16:23:29.8349636Z   Using cached sqlalchemy_searchable-2.1.0-py3-none-any.whl.metadata (2.0 kB)
2025-10-08T16:23:29.8597074Z Collecting SQLAlchemy-Utils==0.41.1 (from -r requirements.txt (line 17))
2025-10-08T16:23:29.8608970Z   Using cached SQLAlchemy_Utils-0.41.1-py3-none-any.whl.metadata (4.3 kB)
2025-10-08T16:23:30.0470476Z Collecting cryptography==44.0.2 (from -r requirements.txt (line 18))
2025-10-08T16:23:30.0483817Z   Using cached cryptography-44.0.2-cp39-abi3-manylinux_2_34_x86_64.whl.metadata (5.7 kB)
2025-10-08T16:23:30.0705397Z Collecting Bootstrap-Flask==2.5.0 (from -r requirements.txt (line 19))
2025-10-08T16:23:30.0717312Z   Using cached bootstrap_flask-2.5.0-py3-none-any.whl.metadata (6.1 kB)
2025-10-08T16:23:30.0893450Z Collecting arrow==1.2.3 (from -r requirements.txt (line 20))
2025-10-08T16:23:30.0904701Z   Using cached arrow-1.2.3-py3-none-any.whl.metadata (6.9 kB)
2025-10-08T16:23:30.1052287Z Collecting pyld==2.0.4 (from -r requirements.txt (line 21))
2025-10-08T16:23:30.1063373Z   Using cached PyLD-2.0.4-py3-none-any.whl.metadata (10.0 kB)
2025-10-08T16:23:30.3951619Z Collecting boto3~=1.39.0 (from -r requirements.txt (line 22))
2025-10-08T16:23:30.3964529Z   Using cached boto3-1.39.17-py3-none-any.whl.metadata (6.7 kB)
2025-10-08T16:23:30.4137850Z Collecting markdown2==2.5.3 (from -r requirements.txt (line 23))
2025-10-08T16:23:30.4148783Z   Using cached markdown2-2.5.3-py3-none-any.whl.metadata (2.1 kB)
2025-10-08T16:23:30.4332460Z Collecting beautifulsoup4==4.12.2 (from -r requirements.txt (line 24))
2025-10-08T16:23:30.4343485Z   Using cached beautifulsoup4-4.12.2-py3-none-any.whl.metadata (3.6 kB)
2025-10-08T16:23:30.4491593Z Collecting flask-caching~=2.3.0 (from -r requirements.txt (line 25))
2025-10-08T16:23:30.4502441Z   Using cached Flask_Caching-2.3.1-py3-none-any.whl.metadata (2.2 kB)
2025-10-08T16:23:30.6050326Z Collecting Pillow (from -r requirements.txt (line 26))
2025-10-08T16:23:30.6063444Z   Using cached pillow-11.3.0-cp313-cp313-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (9.0 kB)
2025-10-08T16:23:30.7020266Z Collecting pillow-heif (from -r requirements.txt (line 27))
2025-10-08T16:23:30.7033961Z   Using cached pillow_heif-1.1.1-cp313-cp313-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl.metadata (9.6 kB)
2025-10-08T16:23:30.7617754Z Collecting pillow-avif-plugin (from -r requirements.txt (line 28))
2025-10-08T16:23:30.7630023Z   Using cached pillow_avif_plugin-1.5.2-cp313-cp313-manylinux_2_28_x86_64.whl.metadata (2.1 kB)
2025-10-08T16:23:30.7772050Z Collecting feedgen==0.9.0 (from -r requirements.txt (line 29))
2025-10-08T16:23:30.7773307Z   Using cached feedgen-0.9.0-py2.py3-none-any.whl
2025-10-08T16:23:30.8166387Z Collecting celery==5.3.6 (from -r requirements.txt (line 30))
2025-10-08T16:23:30.8178000Z   Using cached celery-5.3.6-py3-none-any.whl.metadata (21 kB)
2025-10-08T16:23:30.8648950Z Collecting redis~=5.2.0 (from -r requirements.txt (line 31))
2025-10-08T16:23:30.8661010Z   Using cached redis-5.2.1-py3-none-any.whl.metadata (9.1 kB)
2025-10-08T16:23:30.8894587Z Collecting Werkzeug==3.1.3 (from -r requirements.txt (line 32))
2025-10-08T16:23:30.8905688Z   Using cached werkzeug-3.1.3-py3-none-any.whl.metadata (3.7 kB)
2025-10-08T16:23:30.9032893Z Collecting pytesseract==0.3.10 (from -r requirements.txt (line 33))
2025-10-08T16:23:30.9043726Z   Using cached pytesseract-0.3.10-py3-none-any.whl.metadata (11 kB)
2025-10-08T16:23:30.9581773Z Collecting sentry-sdk==2.27.0 (from -r requirements.txt (line 34))
2025-10-08T16:23:30.9599200Z   Using cached sentry_sdk-2.27.0-py2.py3-none-any.whl.metadata (10 kB)
2025-10-08T16:23:30.9899318Z Collecting python-slugify==8.0.4 (from -r requirements.txt (line 35))
2025-10-08T16:23:30.9911186Z   Using cached python_slugify-8.0.4-py2.py3-none-any.whl.metadata (8.5 kB)
2025-10-08T16:23:31.0064817Z Collecting furl==2.1.3 (from -r requirements.txt (line 36))
2025-10-08T16:23:31.0076275Z   Using cached furl-2.1.3-py2.py3-none-any.whl.metadata (1.2 kB)
2025-10-08T16:23:31.0209971Z Collecting captcha (from -r requirements.txt (line 38))
2025-10-08T16:23:31.0221275Z   Using cached captcha-0.7.1-py3-none-any.whl.metadata (2.2 kB)
2025-10-08T16:23:31.0602214Z Collecting pytest (from -r requirements.txt (line 39))
2025-10-08T16:23:31.0613949Z   Using cached pytest-8.4.2-py3-none-any.whl.metadata (7.7 kB)
2025-10-08T16:23:31.1372778Z Collecting stripe~=12.0.0 (from -r requirements.txt (line 40))
2025-10-08T16:23:31.1385331Z   Using cached stripe-12.0.1-py2.py3-none-any.whl.metadata (2.9 kB)
2025-10-08T16:23:31.1582005Z Collecting Authlib~=1.5.0 (from -r requirements.txt (line 41))
2025-10-08T16:23:31.1593246Z   Using cached authlib-1.5.2-py2.py3-none-any.whl.metadata (3.9 kB)
2025-10-08T16:23:31.1787920Z Collecting webauthn~=2.5.0 (from -r requirements.txt (line 42))
2025-10-08T16:23:31.1799205Z   Using cached webauthn-2.5.3-py3-none-any.whl.metadata (5.7 kB)
2025-10-08T16:23:31.1984629Z Collecting ldap3~=2.9.0 (from -r requirements.txt (line 43))
2025-10-08T16:23:31.1995591Z   Using cached ldap3-2.9.1-py2.py3-none-any.whl.metadata (5.4 kB)
2025-10-08T16:23:31.4908599Z Collecting sqlalchemy~=2.0.0 (from -r requirements.txt (line 44))
2025-10-08T16:23:31.4921496Z   Using cached sqlalchemy-2.0.43-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (9.6 kB)
2025-10-08T16:23:31.7352204Z Collecting orjson~=3.10.0 (from -r requirements.txt (line 45))
2025-10-08T16:23:31.7365165Z   Using cached orjson-3.10.18-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (41 kB)
2025-10-08T16:23:31.7779437Z Collecting marshmallow~=4.0.0 (from -r requirements.txt (line 46))
2025-10-08T16:23:31.7790549Z   Using cached marshmallow-4.0.1-py3-none-any.whl.metadata (7.4 kB)
2025-10-08T16:23:31.8028491Z Collecting flask-smorest~=0.46.1 (from -r requirements.txt (line 47))
2025-10-08T16:23:31.8040474Z   Using cached flask_smorest-0.46.2-py3-none-any.whl.metadata (5.3 kB)
2025-10-08T16:23:31.8199444Z Collecting ics~=0.7.0 (from -r requirements.txt (line 48))
2025-10-08T16:23:31.8209859Z   Using cached ics-0.7.2-py2.py3-none-any.whl.metadata (4.2 kB)
2025-10-08T16:23:31.8370627Z Collecting dateparser~=1.2.0 (from -r requirements.txt (line 49))
2025-10-08T16:23:31.8381471Z   Using cached dateparser-1.2.2-py3-none-any.whl.metadata (29 kB)
2025-10-08T16:23:31.8688518Z Collecting uvicorn==0.35.0 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:31.8699503Z   Using cached uvicorn-0.35.0-py3-none-any.whl.metadata (6.5 kB)
2025-10-08T16:23:31.8909596Z Collecting asgiref==3.9.1 (from -r requirements.txt (line 51))
2025-10-08T16:23:31.8920609Z   Using cached asgiref-3.9.1-py3-none-any.whl.metadata (9.3 kB)
2025-10-08T16:23:31.9132650Z Collecting pygments~=2.19.0 (from -r requirements.txt (line 52))
2025-10-08T16:23:31.9143681Z   Using cached pygments-2.19.2-py3-none-any.whl.metadata (2.5 kB)
2025-10-08T16:23:31.9634902Z Collecting fastapi~=0.118.0 (from -r requirements.txt (line 53))
2025-10-08T16:23:31.9646266Z   Using cached fastapi-0.118.2-py3-none-any.whl.metadata (28 kB)
2025-10-08T16:23:31.9906540Z Collecting sqlakeyset~=2.0.0 (from -r requirements.txt (line 54))
2025-10-08T16:23:31.9917487Z   Using cached sqlakeyset-2.0.1746777265-py3-none-any.whl.metadata (9.1 kB)
2025-10-08T16:23:32.0168210Z Collecting Flask-Limiter[redis] (from -r requirements.txt (line 8))
2025-10-08T16:23:32.0179493Z   Using cached flask_limiter-4.0.0-py3-none-any.whl.metadata (6.2 kB)
2025-10-08T16:23:32.0336850Z Collecting ua-parser[regex] (from -r requirements.txt (line 37))
2025-10-08T16:23:32.0368521Z   Using cached ua_parser-1.0.1-py3-none-any.whl.metadata (5.6 kB)
2025-10-08T16:23:32.0506555Z Collecting blinker>=1.9.0 (from Flask==3.1.1->-r requirements.txt (line 2))
2025-10-08T16:23:32.0518206Z   Using cached blinker-1.9.0-py3-none-any.whl.metadata (1.6 kB)
2025-10-08T16:23:32.0707409Z Collecting click>=8.1.3 (from Flask==3.1.1->-r requirements.txt (line 2))
2025-10-08T16:23:32.0719601Z   Using cached click-8.3.0-py3-none-any.whl.metadata (2.6 kB)
2025-10-08T16:23:32.0850575Z Collecting itsdangerous>=2.2.0 (from Flask==3.1.1->-r requirements.txt (line 2))
2025-10-08T16:23:32.0862102Z   Using cached itsdangerous-2.2.0-py3-none-any.whl.metadata (1.9 kB)
2025-10-08T16:23:32.1023849Z Collecting jinja2>=3.1.2 (from Flask==3.1.1->-r requirements.txt (line 2))
2025-10-08T16:23:32.1035179Z   Using cached jinja2-3.1.6-py3-none-any.whl.metadata (2.9 kB)
2025-10-08T16:23:32.1583095Z Collecting markupsafe>=2.1.1 (from Flask==3.1.1->-r requirements.txt (line 2))
2025-10-08T16:23:32.1596449Z   Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.7 kB)
2025-10-08T16:23:32.1795917Z Collecting wtforms (from flask-wtf==1.2.2->-r requirements.txt (line 4))
2025-10-08T16:23:32.1807286Z   Using cached wtforms-3.2.1-py3-none-any.whl.metadata (5.3 kB)
2025-10-08T16:23:32.2265419Z Collecting dnspython>=2.0.0 (from email-validator==2.0.0->-r requirements.txt (line 9))
2025-10-08T16:23:32.2276976Z   Using cached dnspython-2.8.0-py3-none-any.whl.metadata (5.7 kB)
2025-10-08T16:23:32.2462059Z Collecting idna>=2.0.0 (from email-validator==2.0.0->-r requirements.txt (line 9))
2025-10-08T16:23:32.2473599Z   Using cached idna-3.10-py3-none-any.whl.metadata (10 kB)
2025-10-08T16:23:32.4050659Z Collecting cffi>=1.12 (from cryptography==44.0.2->-r requirements.txt (line 18))
2025-10-08T16:23:32.4064676Z   Using cached cffi-2.0.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (2.6 kB)
2025-10-08T16:23:32.4243985Z Collecting python-dateutil>=2.7.0 (from arrow==1.2.3->-r requirements.txt (line 20))
2025-10-08T16:23:32.4255635Z   Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl.metadata (8.4 kB)
2025-10-08T16:23:32.4452574Z Collecting cachetools (from pyld==2.0.4->-r requirements.txt (line 21))
2025-10-08T16:23:32.4464191Z   Using cached cachetools-6.2.0-py3-none-any.whl.metadata (5.4 kB)
2025-10-08T16:23:32.4864885Z Collecting frozendict (from pyld==2.0.4->-r requirements.txt (line 21))
2025-10-08T16:23:32.4876998Z   Using cached frozendict-2.4.6-py313-none-any.whl.metadata (23 kB)
2025-10-08T16:23:32.6703663Z Collecting lxml (from pyld==2.0.4->-r requirements.txt (line 21))
2025-10-08T16:23:32.6717134Z   Using cached lxml-6.0.2-cp313-cp313-manylinux_2_26_x86_64.manylinux_2_28_x86_64.whl.metadata (3.6 kB)
2025-10-08T16:23:32.6936029Z Collecting soupsieve>1.2 (from beautifulsoup4==4.12.2->-r requirements.txt (line 24))
2025-10-08T16:23:32.6947912Z   Using cached soupsieve-2.8-py3-none-any.whl.metadata (4.6 kB)
2025-10-08T16:23:32.7170286Z Collecting billiard<5.0,>=4.2.0 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.7181811Z   Using cached billiard-4.2.2-py3-none-any.whl.metadata (4.8 kB)
2025-10-08T16:23:32.7297587Z Collecting click-didyoumean>=0.3.0 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.7309015Z   Using cached click_didyoumean-0.3.1-py3-none-any.whl.metadata (3.9 kB)
2025-10-08T16:23:32.7433252Z Collecting click-plugins>=1.1.1 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.7444760Z   Using cached click_plugins-1.1.1.2-py2.py3-none-any.whl.metadata (6.5 kB)
2025-10-08T16:23:32.7570890Z Collecting click-repl>=0.2.0 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.7582166Z   Using cached click_repl-0.3.0-py3-none-any.whl.metadata (3.6 kB)
2025-10-08T16:23:32.7947982Z Collecting kombu<6.0,>=5.3.4 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.7959636Z   Using cached kombu-5.5.4-py3-none-any.whl.metadata (3.5 kB)
2025-10-08T16:23:32.8189617Z Collecting tzdata>=2022.7 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.8201159Z   Using cached tzdata-2025.2-py2.py3-none-any.whl.metadata (1.4 kB)
2025-10-08T16:23:32.8324428Z Collecting vine<6.0,>=5.1.0 (from celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:32.8335913Z   Using cached vine-5.1.0-py3-none-any.whl.metadata (2.7 kB)
2025-10-08T16:23:32.8542399Z Collecting packaging>=21.3 (from pytesseract==0.3.10->-r requirements.txt (line 33))
2025-10-08T16:23:32.8553842Z   Using cached packaging-25.0-py3-none-any.whl.metadata (3.3 kB)
2025-10-08T16:23:32.8878951Z Collecting certifi (from sentry-sdk==2.27.0->-r requirements.txt (line 34))
2025-10-08T16:23:32.8890687Z   Using cached certifi-2025.10.5-py3-none-any.whl.metadata (2.5 kB)
2025-10-08T16:23:32.9026393Z Collecting text-unidecode>=1.3 (from python-slugify==8.0.4->-r requirements.txt (line 35))
2025-10-08T16:23:32.9037737Z   Using cached text_unidecode-1.3-py2.py3-none-any.whl.metadata (2.4 kB)
2025-10-08T16:23:32.9209709Z Collecting six>=1.8.0 (from furl==2.1.3->-r requirements.txt (line 36))
2025-10-08T16:23:32.9221679Z   Using cached six-1.17.0-py2.py3-none-any.whl.metadata (1.7 kB)
2025-10-08T16:23:32.9339865Z Collecting orderedmultidict>=1.0.1 (from furl==2.1.3->-r requirements.txt (line 36))
2025-10-08T16:23:32.9351566Z   Using cached orderedmultidict-1.0.1-py2.py3-none-any.whl.metadata (1.3 kB)
2025-10-08T16:23:32.9531693Z Collecting h11>=0.8 (from uvicorn==0.35.0->uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:32.9542400Z   Using cached h11-0.16.0-py3-none-any.whl.metadata (8.3 kB)
2025-10-08T16:23:32.9857225Z Collecting httptools>=0.6.3 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:32.9868711Z   Using cached httptools-0.6.4-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.6 kB)
2025-10-08T16:23:33.0268693Z Collecting pyyaml>=5.1 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:33.0280876Z   Using cached pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (2.4 kB)
2025-10-08T16:23:33.0659678Z Collecting uvloop>=0.15.1 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:33.0671028Z   Using cached uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
2025-10-08T16:23:33.1395700Z Collecting watchfiles>=0.13 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:33.1408450Z   Using cached watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (4.9 kB)
2025-10-08T16:23:33.2280248Z Collecting websockets>=10.4 (from uvicorn[standard]==0.35.0->-r requirements.txt (line 50))
2025-10-08T16:23:33.2292814Z   Using cached websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.8 kB)
2025-10-08T16:23:33.2620814Z Collecting alembic>=1.9.0 (from flask-migrate~=4.1.0->-r requirements.txt (line 6))
2025-10-08T16:23:33.2631766Z   Using cached alembic-1.16.5-py3-none-any.whl.metadata (7.3 kB)
2025-10-08T16:23:33.2826648Z Collecting Babel>=2.12 (from flask-babel~=4.0.0->-r requirements.txt (line 11))
2025-10-08T16:23:33.2837399Z   Using cached babel-2.17.0-py3-none-any.whl.metadata (2.0 kB)
2025-10-08T16:23:33.3261409Z Collecting pytz>=2022.7 (from flask-babel~=4.0.0->-r requirements.txt (line 11))
2025-10-08T16:23:33.3272292Z   Using cached pytz-2025.2-py2.py3-none-any.whl.metadata (22 kB)
2025-10-08T16:23:33.3728303Z Collecting bcrypt>=3.1.1 (from flask-bcrypt~=1.0.0->-r requirements.txt (line 12))
2025-10-08T16:23:33.3738994Z   Using cached bcrypt-5.0.0-cp39-abi3-manylinux_2_34_x86_64.whl.metadata (10 kB)
2025-10-08T16:23:33.3964687Z Collecting anyio (from httpx~=0.28.0->httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:33.3975433Z   Using cached anyio-4.11.0-py3-none-any.whl.metadata (4.1 kB)
2025-10-08T16:23:33.4211077Z Collecting httpcore==1.* (from httpx~=0.28.0->httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:33.4222763Z   Using cached httpcore-1.0.9-py3-none-any.whl.metadata (21 kB)
2025-10-08T16:23:33.8623939Z Collecting botocore<1.40.0,>=1.39.17 (from boto3~=1.39.0->-r requirements.txt (line 22))
2025-10-08T16:23:33.8636898Z   Using cached botocore-1.39.17-py3-none-any.whl.metadata (5.7 kB)
2025-10-08T16:23:33.8794853Z Collecting jmespath<2.0.0,>=0.7.1 (from boto3~=1.39.0->-r requirements.txt (line 22))
2025-10-08T16:23:33.8805757Z   Using cached jmespath-1.0.1-py3-none-any.whl.metadata (7.6 kB)
2025-10-08T16:23:33.9004944Z Collecting s3transfer<0.14.0,>=0.13.0 (from boto3~=1.39.0->-r requirements.txt (line 22))
2025-10-08T16:23:33.9015732Z   Using cached s3transfer-0.13.1-py3-none-any.whl.metadata (1.7 kB)
2025-10-08T16:23:33.9168666Z Collecting cachelib>=0.9.0 (from flask-caching~=2.3.0->-r requirements.txt (line 25))
2025-10-08T16:23:33.9179794Z   Using cached cachelib-0.13.0-py3-none-any.whl.metadata (2.0 kB)
2025-10-08T16:23:33.9411420Z Collecting typing_extensions>=4.5.0 (from stripe~=12.0.0->-r requirements.txt (line 40))
2025-10-08T16:23:33.9422491Z   Using cached typing_extensions-4.15.0-py3-none-any.whl.metadata (3.3 kB)
2025-10-08T16:23:33.9718643Z Collecting requests>=2.20 (from stripe~=12.0.0->-r requirements.txt (line 40))
2025-10-08T16:23:33.9730125Z   Using cached requests-2.32.5-py3-none-any.whl.metadata (4.9 kB)
2025-10-08T16:23:33.9920852Z Collecting asn1crypto>=1.5.1 (from webauthn~=2.5.0->-r requirements.txt (line 42))
2025-10-08T16:23:33.9931822Z   Using cached asn1crypto-1.5.1-py2.py3-none-any.whl.metadata (13 kB)
2025-10-08T16:23:34.0337136Z Collecting cbor2>=5.6.5 (from webauthn~=2.5.0->-r requirements.txt (line 42))
2025-10-08T16:23:34.0348845Z   Using cached cbor2-5.7.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (5.4 kB)
2025-10-08T16:23:34.0638317Z Collecting pyOpenSSL>=25.0.0 (from webauthn~=2.5.0->-r requirements.txt (line 42))
2025-10-08T16:23:34.0649005Z   Using cached pyopenssl-25.3.0-py3-none-any.whl.metadata (17 kB)
2025-10-08T16:23:34.0894674Z Collecting pyasn1>=0.4.6 (from ldap3~=2.9.0->-r requirements.txt (line 43))
2025-10-08T16:23:34.0905457Z   Using cached pyasn1-0.6.1-py3-none-any.whl.metadata (8.4 kB)
2025-10-08T16:23:34.2103934Z Collecting greenlet>=1 (from sqlalchemy~=2.0.0->-r requirements.txt (line 44))
2025-10-08T16:23:34.2116938Z   Using cached greenlet-3.2.4-cp313-cp313-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl.metadata (4.1 kB)
2025-10-08T16:23:34.2716194Z Collecting webargs<9,>=8.0.0 (from flask-smorest~=0.46.1->-r requirements.txt (line 47))
2025-10-08T16:23:34.2727087Z   Using cached webargs-8.7.0-py3-none-any.whl.metadata (6.6 kB)
2025-10-08T16:23:34.3063922Z Collecting apispec<7,>=6.0.0 (from apispec[marshmallow]<7,>=6.0.0->flask-smorest~=0.46.1->-r requirements.txt (line 47))
2025-10-08T16:23:34.3074767Z   Using cached apispec-6.8.4-py3-none-any.whl.metadata (10 kB)
2025-10-08T16:23:34.3338290Z Collecting tatsu>4.2 (from ics~=0.7.0->-r requirements.txt (line 48))
2025-10-08T16:23:34.3349178Z   Using cached tatsu-5.13.2-py3-none-any.whl.metadata (14 kB)
2025-10-08T16:23:34.3527441Z Collecting attrs>=19.1.0 (from ics~=0.7.0->-r requirements.txt (line 48))
2025-10-08T16:23:34.3538432Z   Using cached attrs-25.4.0-py3-none-any.whl.metadata (10 kB)
2025-10-08T16:23:34.6808575Z Collecting regex>=2024.9.11 (from dateparser~=1.2.0->-r requirements.txt (line 49))
2025-10-08T16:23:34.6822918Z   Using cached regex-2025.9.18-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (40 kB)
2025-10-08T16:23:34.7012353Z Collecting tzlocal>=0.2 (from dateparser~=1.2.0->-r requirements.txt (line 49))
2025-10-08T16:23:34.7023930Z   Using cached tzlocal-5.3.1-py3-none-any.whl.metadata (7.6 kB)
2025-10-08T16:23:34.7363711Z Collecting starlette<0.49.0,>=0.40.0 (from fastapi~=0.118.0->-r requirements.txt (line 53))
2025-10-08T16:23:34.7375418Z   Using cached starlette-0.48.0-py3-none-any.whl.metadata (6.3 kB)
2025-10-08T16:23:34.8789005Z Collecting pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4 (from fastapi~=0.118.0->-r requirements.txt (line 53))
2025-10-08T16:23:34.8801613Z   Using cached pydantic-2.12.0-py3-none-any.whl.metadata (83 kB)
2025-10-08T16:23:34.9730394Z Collecting h2<5,>=3 (from httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:34.9742191Z   Using cached h2-4.3.0-py3-none-any.whl.metadata (5.1 kB)
2025-10-08T16:23:34.9914834Z Collecting hyperframe<7,>=6.1 (from h2<5,>=3->httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:34.9926883Z   Using cached hyperframe-6.1.0-py3-none-any.whl.metadata (4.3 kB)
2025-10-08T16:23:35.0061021Z Collecting hpack<5,>=4.1 (from h2<5,>=3->httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:35.0072553Z   Using cached hpack-4.1.0-py3-none-any.whl.metadata (4.6 kB)
2025-10-08T16:23:35.0353010Z Collecting amqp<6.0.0,>=5.1.1 (from kombu<6.0,>=5.3.4->celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:35.0363806Z   Using cached amqp-5.3.1-py3-none-any.whl.metadata (8.9 kB)
2025-10-08T16:23:35.0603660Z Collecting annotated-types>=0.6.0 (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi~=0.118.0->-r requirements.txt (line 53))
2025-10-08T16:23:35.0614619Z   Using cached annotated_types-0.7.0-py3-none-any.whl.metadata (15 kB)
2025-10-08T16:23:35.6904937Z Collecting pydantic-core==2.41.1 (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi~=0.118.0->-r requirements.txt (line 53))
2025-10-08T16:23:35.6917461Z   Using cached pydantic_core-2.41.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (7.3 kB)
2025-10-08T16:23:35.7082903Z Collecting typing-inspection>=0.4.2 (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,<3.0.0,>=1.7.4->fastapi~=0.118.0->-r requirements.txt (line 53))
2025-10-08T16:23:35.7094043Z   Using cached typing_inspection-0.4.2-py3-none-any.whl.metadata (2.6 kB)
2025-10-08T16:23:35.9581481Z Collecting sniffio>=1.1 (from anyio->httpx~=0.28.0->httpx[http2]~=0.28.0->-r requirements.txt (line 14))
2025-10-08T16:23:35.9593186Z   Using cached sniffio-1.3.1-py3-none-any.whl.metadata (3.9 kB)
2025-10-08T16:23:36.0078457Z Collecting limits>=3.13 (from Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.0089765Z   Using cached limits-5.6.0-py3-none-any.whl.metadata (10 kB)
2025-10-08T16:23:36.0235902Z Collecting ordered-set<5,>4 (from Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.0247289Z   Using cached ordered_set-4.1.0-py3-none-any.whl.metadata (5.3 kB)
2025-10-08T16:23:36.0697840Z Collecting rich<15,>=12 (from Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.0709775Z   Using cached rich-14.1.0-py3-none-any.whl.metadata (18 kB)
2025-10-08T16:23:36.1043682Z Collecting markdown-it-py>=2.2.0 (from rich<15,>=12->Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.1055436Z   Using cached markdown_it_py-4.0.0-py3-none-any.whl.metadata (7.3 kB)
2025-10-08T16:23:36.1386250Z Collecting ua-parser-builtins (from ua-parser[regex]->-r requirements.txt (line 37))
2025-10-08T16:23:36.1397752Z   Using cached ua_parser_builtins-0.18.0.post1-py3-none-any.whl.metadata (1.4 kB)
2025-10-08T16:23:36.1538995Z Collecting ua-parser-rs (from ua-parser[regex]->-r requirements.txt (line 37))
2025-10-08T16:23:36.1550768Z   Using cached ua_parser_rs-0.1.3-cp39-abi3-manylinux_2_34_x86_64.whl.metadata (1.5 kB)
2025-10-08T16:23:36.1740643Z Collecting iniconfig>=1 (from pytest->-r requirements.txt (line 39))
2025-10-08T16:23:36.1752300Z   Using cached iniconfig-2.1.0-py3-none-any.whl.metadata (2.7 kB)
2025-10-08T16:23:36.1889376Z Collecting pluggy<2,>=1.5 (from pytest->-r requirements.txt (line 39))
2025-10-08T16:23:36.1900994Z   Using cached pluggy-1.6.0-py3-none-any.whl.metadata (4.8 kB)
2025-10-08T16:23:36.2172218Z Collecting Mako (from alembic>=1.9.0->flask-migrate~=4.1.0->-r requirements.txt (line 6))
2025-10-08T16:23:36.2183650Z   Using cached mako-1.3.10-py3-none-any.whl.metadata (2.9 kB)
2025-10-08T16:23:36.2557258Z Collecting pycparser (from cffi>=1.12->cryptography==44.0.2->-r requirements.txt (line 18))
2025-10-08T16:23:36.2568674Z   Using cached pycparser-2.23-py3-none-any.whl.metadata (993 bytes)
2025-10-08T16:23:36.3000886Z Collecting prompt-toolkit>=3.0.36 (from click-repl>=0.2.0->celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:36.3012625Z   Using cached prompt_toolkit-3.0.52-py3-none-any.whl.metadata (6.4 kB)
2025-10-08T16:23:36.3453869Z Collecting deprecated>=1.2 (from limits>=3.13->Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.3465926Z   Using cached Deprecated-1.2.18-py2.py3-none-any.whl.metadata (5.7 kB)
2025-10-08T16:23:36.4633436Z Collecting wrapt<2,>=1.10 (from deprecated>=1.2->limits>=3.13->Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.4646989Z   Using cached wrapt-1.17.3-cp313-cp313-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl.metadata (6.4 kB)
2025-10-08T16:23:36.4837725Z Collecting mdurl~=0.1 (from markdown-it-py>=2.2.0->rich<15,>=12->Flask-Limiter[redis]->-r requirements.txt (line 8))
2025-10-08T16:23:36.4849964Z   Using cached mdurl-0.1.2-py3-none-any.whl.metadata (1.6 kB)
2025-10-08T16:23:36.5133701Z Collecting wcwidth (from prompt-toolkit>=3.0.36->click-repl>=0.2.0->celery==5.3.6->-r requirements.txt (line 30))
2025-10-08T16:23:36.5145268Z   Using cached wcwidth-0.2.14-py2.py3-none-any.whl.metadata (15 kB)
2025-10-08T16:23:36.5352606Z INFO: pip is looking at multiple versions of pyopenssl to determine which version is compatible with other requirements. This could take a while.
2025-10-08T16:23:36.5357485Z Collecting pyOpenSSL>=25.0.0 (from webauthn~=2.5.0->-r requirements.txt (line 42))
2025-10-08T16:23:36.5369595Z   Using cached pyopenssl-25.2.0-py3-none-any.whl.metadata (17 kB)
2025-10-08T16:23:36.5546583Z   Using cached pyopenssl-25.1.0-py3-none-any.whl.metadata (17 kB)
2025-10-08T16:23:36.6636417Z Collecting charset_normalizer<4,>=2 (from requests>=2.20->stripe~=12.0.0->-r requirements.txt (line 40))
2025-10-08T16:23:36.6649963Z   Using cached charset_normalizer-3.4.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl.metadata (36 kB)
2025-10-08T16:23:36.7876017Z Using cached flask-3.1.1-py3-none-any.whl (103 kB)
2025-10-08T16:23:36.7888064Z Using cached python_dotenv-1.0.0-py3-none-any.whl (19 kB)
2025-10-08T16:23:36.7900150Z Using cached flask_wtf-1.2.2-py3-none-any.whl (12 kB)
2025-10-08T16:23:36.7911284Z Using cached flask_sqlalchemy-3.1.1-py3-none-any.whl (25 kB)
2025-10-08T16:23:36.7922541Z Using cached Flask_Login-0.6.3-py3-none-any.whl (17 kB)
2025-10-08T16:23:36.7933567Z Using cached email_validator-2.0.0-py3-none-any.whl (31 kB)
2025-10-08T16:23:36.7944715Z Using cached PyJWT-2.8.0-py3-none-any.whl (22 kB)
2025-10-08T16:23:36.7955979Z Using cached sqlalchemy_searchable-2.1.0-py3-none-any.whl (8.3 kB)
2025-10-08T16:23:36.7967075Z Using cached SQLAlchemy_Utils-0.41.1-py3-none-any.whl (92 kB)
2025-10-08T16:23:36.7979243Z Using cached cryptography-44.0.2-cp39-abi3-manylinux_2_34_x86_64.whl (4.2 MB)
2025-10-08T16:23:36.8020524Z Using cached bootstrap_flask-2.5.0-py3-none-any.whl (4.6 MB)
2025-10-08T16:23:36.8065093Z Using cached arrow-1.2.3-py3-none-any.whl (66 kB)
2025-10-08T16:23:36.8076593Z Using cached PyLD-2.0.4-py3-none-any.whl (70 kB)
2025-10-08T16:23:36.8087984Z Using cached markdown2-2.5.3-py3-none-any.whl (48 kB)
2025-10-08T16:23:36.8099520Z Using cached beautifulsoup4-4.12.2-py3-none-any.whl (142 kB)
2025-10-08T16:23:36.8111366Z Using cached celery-5.3.6-py3-none-any.whl (422 kB)
2025-10-08T16:23:36.8125425Z Using cached werkzeug-3.1.3-py3-none-any.whl (224 kB)
2025-10-08T16:23:36.8137762Z Using cached pytesseract-0.3.10-py3-none-any.whl (14 kB)
2025-10-08T16:23:36.8149299Z Using cached sentry_sdk-2.27.0-py2.py3-none-any.whl (340 kB)
2025-10-08T16:23:36.8162683Z Using cached python_slugify-8.0.4-py2.py3-none-any.whl (10 kB)
2025-10-08T16:23:36.8173849Z Using cached furl-2.1.3-py2.py3-none-any.whl (20 kB)
2025-10-08T16:23:36.8185033Z Using cached uvicorn-0.35.0-py3-none-any.whl (66 kB)
2025-10-08T16:23:36.8196427Z Using cached asgiref-3.9.1-py3-none-any.whl (23 kB)
2025-10-08T16:23:36.8207674Z Using cached urllib3-1.26.20-py2.py3-none-any.whl (144 kB)
2025-10-08T16:23:36.8219589Z Using cached Flask_Migrate-4.1.0-py3-none-any.whl (21 kB)
2025-10-08T16:23:36.8230798Z Using cached flask_mail-0.10.0-py3-none-any.whl (8.5 kB)
2025-10-08T16:23:36.8241608Z Using cached flask_babel-4.0.0-py3-none-any.whl (9.6 kB)
2025-10-08T16:23:36.8252791Z Using cached Flask_Bcrypt-1.0.1-py3-none-any.whl (6.0 kB)
2025-10-08T16:23:36.8264414Z Using cached httpx-0.28.1-py3-none-any.whl (73 kB)
2025-10-08T16:23:36.8275339Z Using cached boto3-1.39.17-py3-none-any.whl (139 kB)
2025-10-08T16:23:36.8287050Z Using cached Flask_Caching-2.3.1-py3-none-any.whl (28 kB)
2025-10-08T16:23:36.8298154Z Using cached redis-5.2.1-py3-none-any.whl (261 kB)
2025-10-08T16:23:36.8311852Z Using cached stripe-12.0.1-py2.py3-none-any.whl (1.6 MB)
2025-10-08T16:23:36.8334748Z Using cached authlib-1.5.2-py2.py3-none-any.whl (232 kB)
2025-10-08T16:23:36.8347072Z Using cached webauthn-2.5.3-py3-none-any.whl (70 kB)
2025-10-08T16:23:36.8358504Z Using cached ldap3-2.9.1-py2.py3-none-any.whl (432 kB)
2025-10-08T16:23:36.8372861Z Using cached sqlalchemy-2.0.43-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.3 MB)
2025-10-08T16:23:36.8406241Z Using cached orjson-3.10.18-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (133 kB)
2025-10-08T16:23:36.8417536Z Using cached marshmallow-4.0.1-py3-none-any.whl (48 kB)
2025-10-08T16:23:36.8428555Z Using cached flask_smorest-0.46.2-py3-none-any.whl (32 kB)
2025-10-08T16:23:36.8439448Z Using cached ics-0.7.2-py2.py3-none-any.whl (40 kB)
2025-10-08T16:23:36.8450368Z Using cached dateparser-1.2.2-py3-none-any.whl (315 kB)
2025-10-08T16:23:36.8463473Z Using cached pygments-2.19.2-py3-none-any.whl (1.2 MB)
2025-10-08T16:23:36.8483039Z Using cached fastapi-0.118.2-py3-none-any.whl (97 kB)
2025-10-08T16:23:36.8494351Z Using cached sqlakeyset-2.0.1746777265-py3-none-any.whl (26 kB)
2025-10-08T16:23:36.8505069Z Using cached apispec-6.8.4-py3-none-any.whl (30 kB)
2025-10-08T16:23:36.8515980Z Using cached billiard-4.2.2-py3-none-any.whl (86 kB)
2025-10-08T16:23:36.8527517Z Using cached botocore-1.39.17-py3-none-any.whl (13.9 MB)
2025-10-08T16:23:36.8637273Z Using cached click-8.3.0-py3-none-any.whl (107 kB)
2025-10-08T16:23:36.8648593Z Using cached httpcore-1.0.9-py3-none-any.whl (78 kB)
2025-10-08T16:23:36.8659873Z Using cached h2-4.3.0-py3-none-any.whl (61 kB)
2025-10-08T16:23:36.8671064Z Using cached hpack-4.1.0-py3-none-any.whl (34 kB)
2025-10-08T16:23:36.8682172Z Using cached hyperframe-6.1.0-py3-none-any.whl (13 kB)
2025-10-08T16:23:36.8692823Z Using cached jmespath-1.0.1-py3-none-any.whl (20 kB)
2025-10-08T16:23:36.8703532Z Using cached kombu-5.5.4-py3-none-any.whl (210 kB)
2025-10-08T16:23:36.8715708Z Using cached vine-5.1.0-py3-none-any.whl (9.6 kB)
2025-10-08T16:23:36.8726545Z Using cached amqp-5.3.1-py3-none-any.whl (50 kB)
2025-10-08T16:23:36.8737756Z Using cached pydantic-2.12.0-py3-none-any.whl (459 kB)
2025-10-08T16:23:36.8752418Z Using cached pydantic_core-2.41.1-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.1 MB)
2025-10-08T16:23:36.8778152Z Using cached python_dateutil-2.9.0.post0-py2.py3-none-any.whl (229 kB)
2025-10-08T16:23:36.8790817Z Using cached s3transfer-0.13.1-py3-none-any.whl (85 kB)
2025-10-08T16:23:36.8802329Z Using cached starlette-0.48.0-py3-none-any.whl (73 kB)
2025-10-08T16:23:36.8813741Z Using cached anyio-4.11.0-py3-none-any.whl (109 kB)
2025-10-08T16:23:36.8825529Z Using cached webargs-8.7.0-py3-none-any.whl (31 kB)
2025-10-08T16:23:36.8836893Z Using cached flask_limiter-4.0.0-py3-none-any.whl (29 kB)
2025-10-08T16:23:36.8847914Z Using cached ordered_set-4.1.0-py3-none-any.whl (7.6 kB)
2025-10-08T16:23:36.8859219Z Using cached rich-14.1.0-py3-none-any.whl (243 kB)
2025-10-08T16:23:36.8872190Z Using cached psycopg2_binary-2.9.10-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.0 MB)
2025-10-08T16:23:36.8906616Z Using cached pillow-11.3.0-cp313-cp313-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (6.6 MB)
2025-10-08T16:23:36.8964931Z Using cached pillow_heif-1.1.1-cp313-cp313-manylinux_2_27_x86_64.manylinux_2_28_x86_64.whl (5.5 MB)
2025-10-08T16:23:36.9015033Z Using cached pillow_avif_plugin-1.5.2-cp313-cp313-manylinux_2_28_x86_64.whl (4.2 MB)
2025-10-08T16:23:36.9055798Z Using cached ua_parser-1.0.1-py3-none-any.whl (31 kB)
2025-10-08T16:23:36.9066898Z Using cached captcha-0.7.1-py3-none-any.whl (147 kB)
2025-10-08T16:23:36.9078888Z Using cached pytest-8.4.2-py3-none-any.whl (365 kB)
2025-10-08T16:23:36.9093281Z Using cached pluggy-1.6.0-py3-none-any.whl (20 kB)
2025-10-08T16:23:36.9104386Z Using cached alembic-1.16.5-py3-none-any.whl (247 kB)
2025-10-08T16:23:36.9116977Z Using cached annotated_types-0.7.0-py3-none-any.whl (13 kB)
2025-10-08T16:23:36.9128045Z Using cached asn1crypto-1.5.1-py2.py3-none-any.whl (105 kB)
2025-10-08T16:23:36.9139801Z Using cached attrs-25.4.0-py3-none-any.whl (67 kB)
2025-10-08T16:23:36.9151441Z Using cached babel-2.17.0-py3-none-any.whl (10.2 MB)
2025-10-08T16:23:36.9233934Z Using cached bcrypt-5.0.0-cp39-abi3-manylinux_2_34_x86_64.whl (278 kB)
2025-10-08T16:23:36.9247027Z Using cached blinker-1.9.0-py3-none-any.whl (8.5 kB)
2025-10-08T16:23:36.9258114Z Using cached cachelib-0.13.0-py3-none-any.whl (20 kB)
2025-10-08T16:23:36.9269982Z Using cached cbor2-5.7.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (283 kB)
2025-10-08T16:23:36.9283230Z Using cached cffi-2.0.0-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (219 kB)
2025-10-08T16:23:36.9295552Z Using cached click_didyoumean-0.3.1-py3-none-any.whl (3.6 kB)
2025-10-08T16:23:36.9307319Z Using cached click_plugins-1.1.1.2-py2.py3-none-any.whl (11 kB)
2025-10-08T16:23:36.9318260Z Using cached click_repl-0.3.0-py3-none-any.whl (10 kB)
2025-10-08T16:23:36.9329564Z Using cached dnspython-2.8.0-py3-none-any.whl (331 kB)
2025-10-08T16:23:36.9343123Z Using cached greenlet-3.2.4-cp313-cp313-manylinux_2_24_x86_64.manylinux_2_28_x86_64.whl (610 kB)
2025-10-08T16:23:36.9358622Z Using cached h11-0.16.0-py3-none-any.whl (37 kB)
2025-10-08T16:23:36.9370627Z Using cached httptools-0.6.4-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (473 kB)
2025-10-08T16:23:36.9384434Z Using cached idna-3.10-py3-none-any.whl (70 kB)
2025-10-08T16:23:36.9395850Z Using cached iniconfig-2.1.0-py3-none-any.whl (6.0 kB)
2025-10-08T16:23:36.9406964Z Using cached itsdangerous-2.2.0-py3-none-any.whl (16 kB)
2025-10-08T16:23:36.9418032Z Using cached jinja2-3.1.6-py3-none-any.whl (134 kB)
2025-10-08T16:23:36.9429559Z Using cached limits-5.6.0-py3-none-any.whl (60 kB)
2025-10-08T16:23:36.9440793Z Using cached Deprecated-1.2.18-py2.py3-none-any.whl (10.0 kB)
2025-10-08T16:23:36.9451855Z Using cached wrapt-1.17.3-cp313-cp313-manylinux1_x86_64.manylinux_2_28_x86_64.manylinux_2_5_x86_64.whl (88 kB)
2025-10-08T16:23:36.9463185Z Using cached markdown_it_py-4.0.0-py3-none-any.whl (87 kB)
2025-10-08T16:23:36.9474394Z Using cached mdurl-0.1.2-py3-none-any.whl (10.0 kB)
2025-10-08T16:23:36.9485433Z Using cached markupsafe-3.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (22 kB)
2025-10-08T16:23:36.9496057Z Using cached orderedmultidict-1.0.1-py2.py3-none-any.whl (11 kB)
2025-10-08T16:23:36.9506529Z Using cached packaging-25.0-py3-none-any.whl (66 kB)
2025-10-08T16:23:36.9519689Z Using cached prompt_toolkit-3.0.52-py3-none-any.whl (391 kB)
2025-10-08T16:23:36.9533412Z Using cached pyasn1-0.6.1-py3-none-any.whl (83 kB)
2025-10-08T16:23:36.9544813Z Using cached pyopenssl-25.1.0-py3-none-any.whl (56 kB)
2025-10-08T16:23:36.9556303Z Using cached pytz-2025.2-py2.py3-none-any.whl (509 kB)
2025-10-08T16:23:36.9571344Z Using cached pyyaml-6.0.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (801 kB)
2025-10-08T16:23:36.9588281Z Using cached regex-2025.9.18-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (802 kB)
2025-10-08T16:23:36.9604948Z Using cached requests-2.32.5-py3-none-any.whl (64 kB)
2025-10-08T16:23:36.9617034Z Using cached charset_normalizer-3.4.3-cp313-cp313-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl (151 kB)
2025-10-08T16:23:36.9628832Z Using cached certifi-2025.10.5-py3-none-any.whl (163 kB)
2025-10-08T16:23:36.9640970Z Using cached six-1.17.0-py2.py3-none-any.whl (11 kB)
2025-10-08T16:23:36.9651968Z Using cached sniffio-1.3.1-py3-none-any.whl (10 kB)
2025-10-08T16:23:36.9662915Z Using cached soupsieve-2.8-py3-none-any.whl (36 kB)
2025-10-08T16:23:36.9674262Z Using cached tatsu-5.13.2-py3-none-any.whl (80 kB)
2025-10-08T16:23:36.9685702Z Using cached text_unidecode-1.3-py2.py3-none-any.whl (78 kB)
2025-10-08T16:23:36.9697181Z Using cached typing_extensions-4.15.0-py3-none-any.whl (44 kB)
2025-10-08T16:23:36.9708306Z Using cached typing_inspection-0.4.2-py3-none-any.whl (14 kB)
2025-10-08T16:23:36.9719710Z Using cached tzdata-2025.2-py2.py3-none-any.whl (347 kB)
2025-10-08T16:23:36.9733097Z Using cached tzlocal-5.3.1-py3-none-any.whl (18 kB)
2025-10-08T16:23:36.9744574Z Using cached uvloop-0.21.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)
2025-10-08T16:23:36.9788957Z Using cached watchfiles-1.1.0-cp313-cp313-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (451 kB)
2025-10-08T16:23:36.9803780Z Using cached websockets-15.0.1-cp313-cp313-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (182 kB)
2025-10-08T16:23:36.9815580Z Using cached cachetools-6.2.0-py3-none-any.whl (11 kB)
2025-10-08T16:23:36.9826760Z Using cached frozendict-2.4.6-py313-none-any.whl (16 kB)
2025-10-08T16:23:36.9838187Z Using cached lxml-6.0.2-cp313-cp313-manylinux_2_26_x86_64.manylinux_2_28_x86_64.whl (5.2 MB)
2025-10-08T16:23:36.9885660Z Using cached mako-1.3.10-py3-none-any.whl (78 kB)
2025-10-08T16:23:36.9897225Z Using cached pycparser-2.23-py3-none-any.whl (118 kB)
2025-10-08T16:23:36.9908983Z Using cached ua_parser_builtins-0.18.0.post1-py3-none-any.whl (86 kB)
2025-10-08T16:23:36.9920855Z Using cached ua_parser_rs-0.1.3-cp39-abi3-manylinux_2_34_x86_64.whl (7.5 MB)
2025-10-08T16:23:36.9985688Z Using cached wcwidth-0.2.14-py2.py3-none-any.whl (37 kB)
2025-10-08T16:23:36.9996932Z Using cached wtforms-3.2.1-py3-none-any.whl (152 kB)
2025-10-08T16:23:37.4101830Z Installing collected packages: text-unidecode, pytz, pillow-avif-plugin, asn1crypto, wrapt, websockets, wcwidth, vine, uvloop, urllib3, ua-parser-rs, ua-parser-builtins, tzlocal, tzdata, typing_extensions, tatsu, soupsieve, sniffio, six, regex, redis, pyyaml, python-slugify, python-dotenv, pyjwt, pygments, pycparser, pyasn1, psycopg2-binary, pluggy, Pillow, packaging, orjson, ordered-set, mdurl, marshmallow, markupsafe, markdown2, lxml, jmespath, itsdangerous, iniconfig, idna, hyperframe, httptools, hpack, h11, greenlet, frozendict, dnspython, click, charset_normalizer, certifi, cbor2, cachetools, cachelib, blinker, billiard, bcrypt, Babel, attrs, asgiref, annotated-types, wtforms, Werkzeug, webargs, uvicorn, ua-parser, typing-inspection, sqlalchemy, sentry-sdk, requests, python-dateutil, pytest, pytesseract, pyld, pydantic-core, prompt-toolkit, pillow-heif, orderedmultidict, markdown-it-py, Mako, ldap3, jinja2, httpcore, h2, email-validator, deprecated, click-plugins, click-didyoumean, cffi, captcha, beautifulsoup4, apispec, anyio, amqp, watchfiles, stripe, starlette, SQLAlchemy-Utils, sqlakeyset, rich, pydantic, limits, kombu, httpx, furl, Flask, feedgen, dateparser, cryptography, click-repl, botocore, arrow, alembic, SQLAlchemy-Searchable, s3transfer, pyOpenSSL, ics, flask-wtf, flask-sqlalchemy, flask-smorest, flask-mail, flask-login, Flask-Limiter, flask-caching, flask-bcrypt, flask-babel, fastapi, celery, Bootstrap-Flask, Authlib, webauthn, flask-migrate, boto3
2025-10-08T16:23:49.2687511Z 
2025-10-08T16:23:49.2827733Z Successfully installed Authlib-1.5.2 Babel-2.17.0 Bootstrap-Flask-2.5.0 Flask-3.1.1 Flask-Limiter-4.0.0 Mako-1.3.10 Pillow-11.3.0 SQLAlchemy-Searchable-2.1.0 SQLAlchemy-Utils-0.41.1 Werkzeug-3.1.3 alembic-1.16.5 amqp-5.3.1 annotated-types-0.7.0 anyio-4.11.0 apispec-6.8.4 arrow-1.2.3 asgiref-3.9.1 asn1crypto-1.5.1 attrs-25.4.0 bcrypt-5.0.0 beautifulsoup4-4.12.2 billiard-4.2.2 blinker-1.9.0 boto3-1.39.17 botocore-1.39.17 cachelib-0.13.0 cachetools-6.2.0 captcha-0.7.1 cbor2-5.7.0 celery-5.3.6 certifi-2025.10.5 cffi-2.0.0 charset_normalizer-3.4.3 click-8.3.0 click-didyoumean-0.3.1 click-plugins-1.1.1.2 click-repl-0.3.0 cryptography-44.0.2 dateparser-1.2.2 deprecated-1.2.18 dnspython-2.8.0 email-validator-2.0.0 fastapi-0.118.2 feedgen-0.9.0 flask-babel-4.0.0 flask-bcrypt-1.0.1 flask-caching-2.3.1 flask-login-0.6.3 flask-mail-0.10.0 flask-migrate-4.1.0 flask-smorest-0.46.2 flask-sqlalchemy-3.1.1 flask-wtf-1.2.2 frozendict-2.4.6 furl-2.1.3 greenlet-3.2.4 h11-0.16.0 h2-4.3.0 hpack-4.1.0 httpcore-1.0.9 httptools-0.6.4 httpx-0.28.1 hyperframe-6.1.0 ics-0.7.2 idna-3.10 iniconfig-2.1.0 itsdangerous-2.2.0 jinja2-3.1.6 jmespath-1.0.1 kombu-5.5.4 ldap3-2.9.1 limits-5.6.0 lxml-6.0.2 markdown-it-py-4.0.0 markdown2-2.5.3 markupsafe-3.0.3 marshmallow-4.0.1 mdurl-0.1.2 ordered-set-4.1.0 orderedmultidict-1.0.1 orjson-3.10.18 packaging-25.0 pillow-avif-plugin-1.5.2 pillow-heif-1.1.1 pluggy-1.6.0 prompt-toolkit-3.0.52 psycopg2-binary-2.9.10 pyOpenSSL-25.1.0 pyasn1-0.6.1 pycparser-2.23 pydantic-2.12.0 pydantic-core-2.41.1 pygments-2.19.2 pyjwt-2.8.0 pyld-2.0.4 pytesseract-0.3.10 pytest-8.4.2 python-dateutil-2.9.0.post0 python-dotenv-1.0.0 python-slugify-8.0.4 pytz-2025.2 pyyaml-6.0.3 redis-5.2.1 regex-2025.9.18 requests-2.32.5 rich-14.1.0 s3transfer-0.13.1 sentry-sdk-2.27.0 six-1.17.0 sniffio-1.3.1 soupsieve-2.8 sqlakeyset-2.0.1746777265 sqlalchemy-2.0.43 starlette-0.48.0 stripe-12.0.1 tatsu-5.13.2 text-unidecode-1.3 typing-inspection-0.4.2 typing_extensions-4.15.0 tzdata-2025.2 tzlocal-5.3.1 ua-parser-1.0.1 ua-parser-builtins-0.18.0.post1 ua-parser-rs-0.1.3 urllib3-1.26.20 uvicorn-0.35.0 uvloop-0.21.0 vine-5.1.0 watchfiles-1.1.0 wcwidth-0.2.14 webargs-8.7.0 webauthn-2.5.3 websockets-15.0.1 wrapt-1.17.3 wtforms-3.2.1
2025-10-08T16:23:50.3456823Z Requirement already satisfied: pytest in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (8.4.2)
2025-10-08T16:23:50.3476528Z Requirement already satisfied: iniconfig>=1 in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (from pytest) (2.1.0)
2025-10-08T16:23:50.3482523Z Requirement already satisfied: packaging>=20 in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (from pytest) (25.0)
2025-10-08T16:23:50.3488657Z Requirement already satisfied: pluggy<2,>=1.5 in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (from pytest) (1.6.0)
2025-10-08T16:23:50.3494605Z Requirement already satisfied: pygments>=2.7.2 in /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages (from pytest) (2.19.2)
2025-10-08T16:23:50.5475027Z ##[group]Run echo "🔒 Testing database schema immutability"
2025-10-08T16:23:50.5475471Z [36;1mecho "🔒 Testing database schema immutability"[0m
2025-10-08T16:23:50.5493388Z [36;1mpython -m pytest tests/test_field_consistency_simple.py -v[0m
2025-10-08T16:23:50.5526881Z shell: /usr/bin/bash -e {0}
2025-10-08T16:23:50.5527124Z env:
2025-10-08T16:23:50.5527382Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:50.5527802Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:23:50.5528234Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:50.5528608Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:50.5528981Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:50.5529551Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:23:50.5529875Z   SERVER_NAME: test.localhost
2025-10-08T16:23:50.5530148Z   SECRET_KEY: test-secret-key-for-ci
2025-10-08T16:23:50.5530417Z   DATABASE_URL: sqlite:///memory:test.db
2025-10-08T16:23:50.5530673Z   CACHE_TYPE: NullCache
2025-10-08T16:23:50.5530887Z   CACHE_REDIS_URL: memory://
2025-10-08T16:23:50.5531104Z   TESTING: true
2025-10-08T16:23:50.5531287Z ##[endgroup]
2025-10-08T16:23:50.5582979Z 🔒 Testing database schema immutability
2025-10-08T16:23:51.6081874Z ============================= test session starts ==============================
2025-10-08T16:23:51.6083041Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:23:51.6083623Z cachedir: .pytest_cache
2025-10-08T16:23:51.6083928Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:23:51.6084300Z plugins: anyio-4.11.0
2025-10-08T16:23:51.6303754Z collecting ... collected 4 items
2025-10-08T16:23:51.6304092Z 
2025-10-08T16:23:53.2892882Z tests/test_field_consistency_simple.py::test_user_model_columns_exist PASSED [ 25%]
2025-10-08T16:23:53.2900613Z tests/test_field_consistency_simple.py::test_user_name_field_consistency PASSED [ 50%]
2025-10-08T16:23:53.2907238Z tests/test_field_consistency_simple.py::test_post_model_columns_exist PASSED [ 75%]
2025-10-08T16:23:53.5070657Z tests/test_field_consistency_simple.py::test_community_model_columns_exist PASSED [100%]
2025-10-08T16:23:53.5071455Z 
2025-10-08T16:23:53.5071691Z ============================== 4 passed in 1.69s ===============================
2025-10-08T16:23:53.7122042Z ##[group]Run echo "🧹 Testing HTML sanitization and processing"
2025-10-08T16:23:53.7122492Z [36;1mecho "🧹 Testing HTML sanitization and processing"[0m
2025-10-08T16:23:53.7122852Z [36;1mpython -m pytest tests/test_allowlist_html.py -v[0m
2025-10-08T16:23:53.7155369Z shell: /usr/bin/bash -e {0}
2025-10-08T16:23:53.7155592Z env:
2025-10-08T16:23:53.7155837Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:53.7156236Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:23:53.7156627Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:53.7156989Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:53.7157330Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:53.7157674Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:23:53.7157981Z   SERVER_NAME: test.localhost
2025-10-08T16:23:53.7158265Z   SECRET_KEY: test-secret-key-for-ci
2025-10-08T16:23:53.7158523Z   DATABASE_URL: sqlite:///memory:test.db
2025-10-08T16:23:53.7158775Z   CACHE_TYPE: NullCache
2025-10-08T16:23:53.7158987Z   CACHE_REDIS_URL: memory://
2025-10-08T16:23:53.7159388Z   TESTING: true
2025-10-08T16:23:53.7159568Z ##[endgroup]
2025-10-08T16:23:53.7212021Z 🧹 Testing HTML sanitization and processing
2025-10-08T16:23:53.9332678Z ============================= test session starts ==============================
2025-10-08T16:23:53.9333638Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:23:53.9334496Z cachedir: .pytest_cache
2025-10-08T16:23:53.9334945Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:23:53.9335443Z plugins: anyio-4.11.0
2025-10-08T16:23:55.2368223Z collecting ... collected 20 items
2025-10-08T16:23:55.2368514Z 
2025-10-08T16:23:55.2395030Z tests/test_allowlist_html.py::TestAllowlistHtml::test_angle_brackets_in_blockquote PASSED [  5%]
2025-10-08T16:23:55.2404912Z tests/test_allowlist_html.py::TestAllowlistHtml::test_angle_brackets_in_text PASSED [ 10%]
2025-10-08T16:23:55.2413983Z tests/test_allowlist_html.py::TestAllowlistHtml::test_attributes PASSED  [ 15%]
2025-10-08T16:23:55.2422857Z tests/test_allowlist_html.py::TestAllowlistHtml::test_basic_html PASSED  [ 20%]
2025-10-08T16:23:55.2431249Z tests/test_allowlist_html.py::TestAllowlistHtml::test_community_link_basic_html PASSED [ 25%]
2025-10-08T16:23:55.2438500Z tests/test_allowlist_html.py::TestAllowlistHtml::test_community_link_code_block PASSED [ 30%]
2025-10-08T16:23:55.2445836Z tests/test_allowlist_html.py::TestAllowlistHtml::test_community_link_markdown_link PASSED [ 35%]
2025-10-08T16:23:55.2453147Z tests/test_allowlist_html.py::TestAllowlistHtml::test_community_link_masto_link PASSED [ 40%]
2025-10-08T16:23:55.2463323Z tests/test_allowlist_html.py::TestAllowlistHtml::test_disallowed_tags PASSED [ 45%]
2025-10-08T16:23:55.2470447Z tests/test_allowlist_html.py::TestAllowlistHtml::test_empty_input PASSED [ 50%]
2025-10-08T16:23:55.2478048Z tests/test_allowlist_html.py::TestAllowlistHtml::test_feed_link_basic_html PASSED [ 55%]
2025-10-08T16:23:55.2485534Z tests/test_allowlist_html.py::TestAllowlistHtml::test_feed_link_code_block PASSED [ 60%]
2025-10-08T16:23:55.2492954Z tests/test_allowlist_html.py::TestAllowlistHtml::test_feed_link_markdown_link PASSED [ 65%]
2025-10-08T16:23:55.2500328Z tests/test_allowlist_html.py::TestAllowlistHtml::test_feed_link_masto_link PASSED [ 70%]
2025-10-08T16:23:55.2509431Z tests/test_allowlist_html.py::TestAllowlistHtml::test_nested_tags PASSED [ 75%]
2025-10-08T16:23:55.2517268Z tests/test_allowlist_html.py::TestAllowlistHtml::test_person_link_basic_html PASSED [ 80%]
2025-10-08T16:23:55.2524644Z tests/test_allowlist_html.py::TestAllowlistHtml::test_person_link_code_block PASSED [ 85%]
2025-10-08T16:23:55.2532154Z tests/test_allowlist_html.py::TestAllowlistHtml::test_person_link_markdown_link PASSED [ 90%]
2025-10-08T16:23:55.2539800Z tests/test_allowlist_html.py::TestAllowlistHtml::test_person_link_masto_link PASSED [ 95%]
2025-10-08T16:23:55.5509776Z tests/test_allowlist_html.py::TestAllowlistHtml::test_plain_text_urls PASSED [100%]
2025-10-08T16:23:55.5510358Z 
2025-10-08T16:23:55.5510571Z ============================== 20 passed in 1.33s ==============================
2025-10-08T16:23:55.8253705Z ##[group]Run echo "🗄️ Testing database migration consistency"
2025-10-08T16:23:55.8254168Z [36;1mecho "🗄️ Testing database migration consistency"[0m
2025-10-08T16:23:55.8254550Z [36;1mpython -m pytest tests/test_migration_heads.py -v[0m
2025-10-08T16:23:55.8287111Z shell: /usr/bin/bash -e {0}
2025-10-08T16:23:55.8287343Z env:
2025-10-08T16:23:55.8287598Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:55.8288018Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:23:55.8288428Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:55.8288795Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:55.8289270Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:23:55.8289633Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:23:55.8289939Z   SERVER_NAME: test.localhost
2025-10-08T16:23:55.8290222Z   SECRET_KEY: test-secret-key-for-ci
2025-10-08T16:23:55.8290500Z   DATABASE_URL: sqlite:///memory:test.db
2025-10-08T16:23:55.8290754Z   CACHE_TYPE: NullCache
2025-10-08T16:23:55.8290969Z   CACHE_REDIS_URL: memory://
2025-10-08T16:23:55.8291216Z   CELERY_BROKER_URL: memory://localhost/
2025-10-08T16:23:55.8291469Z   TESTING: true
2025-10-08T16:23:55.8291655Z ##[endgroup]
2025-10-08T16:23:55.8343693Z 🗄️ Testing database migration consistency
2025-10-08T16:23:56.0537127Z ============================= test session starts ==============================
2025-10-08T16:23:56.0538062Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:23:56.0538652Z cachedir: .pytest_cache
2025-10-08T16:23:56.0538962Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:23:56.0539617Z plugins: anyio-4.11.0
2025-10-08T16:23:57.1160839Z collecting ... collected 2 items
2025-10-08T16:23:57.1161279Z 
2025-10-08T16:24:00.7321731Z tests/test_migration_heads.py::test_single_migration_head PASSED         [ 50%]
2025-10-08T16:24:03.7836365Z tests/test_migration_heads.py::test_migration_history_linear PASSED      [100%]
2025-10-08T16:24:03.7837036Z 
2025-10-08T16:24:03.7837308Z =============================== warnings summary ===============================
2025-10-08T16:24:03.7838075Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:24:03.7840345Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:03.7842500Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:03.7842992Z 
2025-10-08T16:24:03.7843374Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:24:03.7845709Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:03.7847640Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:03.7848034Z 
2025-10-08T16:24:03.7848299Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:24:03.7849918Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:03.7851493Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:03.7852090Z 
2025-10-08T16:24:03.7852453Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:24:03.7853883Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:03.7855937Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:03.7856765Z 
2025-10-08T16:24:03.7857131Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:03.7857812Z ======================== 2 passed, 4 warnings in 7.26s =========================
2025-10-08T16:24:04.2515338Z ##[group]Run echo "🔍 Testing explore page rendering and content"
2025-10-08T16:24:04.2515804Z [36;1mecho "🔍 Testing explore page rendering and content"[0m
2025-10-08T16:24:04.2516152Z [36;1mpython tests/test_explore_ci_real_world.py[0m
2025-10-08T16:24:04.2548779Z shell: /usr/bin/bash -e {0}
2025-10-08T16:24:04.2549013Z env:
2025-10-08T16:24:04.2549454Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.2549894Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:24:04.2550308Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.2550658Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.2551003Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.2551372Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:24:04.2551678Z   SERVER_NAME: test.localhost
2025-10-08T16:24:04.2551952Z   SECRET_KEY: test-secret-key-for-ci
2025-10-08T16:24:04.2552218Z   DATABASE_URL: sqlite:///memory:test.db
2025-10-08T16:24:04.2552472Z   CACHE_TYPE: NullCache
2025-10-08T16:24:04.2552682Z   CACHE_REDIS_URL: memory://
2025-10-08T16:24:04.2552935Z   CELERY_BROKER_URL: memory://localhost/
2025-10-08T16:24:04.2553181Z   TESTING: true
2025-10-08T16:24:04.2553365Z ##[endgroup]
2025-10-08T16:24:04.2604101Z 🔍 Testing explore page rendering and content
2025-10-08T16:24:04.4445694Z ============================================================
2025-10-08T16:24:04.4446572Z 🧪 REAL-WORLD EXPLORE PAGE TESTS (CI/CD Compatible)
2025-10-08T16:24:04.4446939Z ============================================================
2025-10-08T16:24:04.4447152Z 
2025-10-08T16:24:04.4447261Z Running: Template Compilation
2025-10-08T16:24:04.4447555Z ----------------------------------------
2025-10-08T16:24:04.4447898Z ✅ Template compiles successfully
2025-10-08T16:24:04.4448191Z    Correct syntax found: topics|length
2025-10-08T16:24:04.4448388Z 
2025-10-08T16:24:04.4448507Z Running: Render Empty Data
2025-10-08T16:24:04.4448757Z ----------------------------------------
2025-10-08T16:24:04.4449323Z ✅ Empty state renders correctly
2025-10-08T16:24:04.4449618Z 
2025-10-08T16:24:04.4449787Z Running: Render With Topics
2025-10-08T16:24:04.4450219Z ----------------------------------------
2025-10-08T16:24:04.4450797Z ✅ Topics render correctly
2025-10-08T16:24:04.4451253Z    Found: Technology, Science, Programming
2025-10-08T16:24:04.4451770Z    Links are properly formatted
2025-10-08T16:24:04.4452064Z 
2025-10-08T16:24:04.4452222Z Running: No Syntax Leakage
2025-10-08T16:24:04.4452626Z ----------------------------------------
2025-10-08T16:24:04.4453223Z ✅ No template syntax leaked to output
2025-10-08T16:24:04.4453563Z 
2025-10-08T16:24:04.4453767Z ============================================================
2025-10-08T16:24:04.4454259Z 📊 TEST SUMMARY
2025-10-08T16:24:04.4454476Z ============================================================
2025-10-08T16:24:04.4454802Z ✅ PASS: Template Compilation
2025-10-08T16:24:04.4455133Z ✅ PASS: Render Empty Data
2025-10-08T16:24:04.4455420Z ✅ PASS: Render With Topics
2025-10-08T16:24:04.4456036Z ✅ PASS: No Syntax Leakage
2025-10-08T16:24:04.4456377Z 
2025-10-08T16:24:04.4456781Z 🎉 All tests passed! The explore page is working correctly.
2025-10-08T16:24:04.4622578Z ##[group]Run echo "📝 Running additional core logic tests"
2025-10-08T16:24:04.4622981Z [36;1mecho "📝 Running additional core logic tests"[0m
2025-10-08T16:24:04.4623280Z [36;1m# Run any other fast unit tests[0m
2025-10-08T16:24:04.4623631Z [36;1m# NOTE: Removed || true to ensure test failures actually fail CI[0m
2025-10-08T16:24:04.4624399Z [36;1mfind tests/ -name "test_*.py" -not -name "test_startup_validation.py" -not -name "test_field_consistency_simple.py" -not -name "test_allowlist_html.py" -exec python -m pytest {} -v \;[0m
2025-10-08T16:24:04.4657365Z shell: /usr/bin/bash -e {0}
2025-10-08T16:24:04.4657612Z env:
2025-10-08T16:24:04.4657867Z   pythonLocation: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.4658288Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib/pkgconfig
2025-10-08T16:24:04.4658698Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.4659321Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.4659686Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.13.7/x64
2025-10-08T16:24:04.4660041Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.13.7/x64/lib
2025-10-08T16:24:04.4660351Z   SERVER_NAME: test.localhost
2025-10-08T16:24:04.4660589Z   SECRET_KEY: test-secret-key-for-ci
2025-10-08T16:24:04.4660857Z   DATABASE_URL: sqlite:///memory:test.db
2025-10-08T16:24:04.4661110Z   CACHE_TYPE: NullCache
2025-10-08T16:24:04.4661316Z   CACHE_REDIS_URL: memory://
2025-10-08T16:24:04.4661538Z   TESTING: true
2025-10-08T16:24:04.4661721Z ##[endgroup]
2025-10-08T16:24:04.4713657Z 📝 Running additional core logic tests
2025-10-08T16:24:04.6899956Z ============================= test session starts ==============================
2025-10-08T16:24:04.6900905Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:04.6901740Z cachedir: .pytest_cache
2025-10-08T16:24:04.6902180Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:04.6902695Z plugins: anyio-4.11.0
2025-10-08T16:24:04.8656168Z collecting ... collected 13 items
2025-10-08T16:24:04.8656529Z 
2025-10-08T16:24:05.8113768Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationHealthEndpoint::test_health_check_success SKIPPED [  7%]
2025-10-08T16:24:05.8137116Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationHealthEndpoint::test_health_check_invalid_secret SKIPPED [ 15%]
2025-10-08T16:24:05.8158463Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationHealthEndpoint::test_health_check_no_secret SKIPPED [ 23%]
2025-10-08T16:24:05.8179369Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationHealthEndpoint::test_health_check_feature_disabled SKIPPED [ 30%]
2025-10-08T16:24:05.8203910Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationEndpoint::test_private_registration_success SKIPPED [ 38%]
2025-10-08T16:24:05.8224741Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationEndpoint::test_private_registration_generated_password SKIPPED [ 46%]
2025-10-08T16:24:05.8245378Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationEndpoint::test_private_registration_duplicate_user SKIPPED [ 53%]
2025-10-08T16:24:05.8266014Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationEndpoint::test_private_registration_invalid_data SKIPPED [ 61%]
2025-10-08T16:24:05.8286678Z tests/test_private_registration_endpoints.py::TestPrivateRegistrationEndpoint::test_private_registration_unauthorized_ip SKIPPED [ 69%]
2025-10-08T16:24:05.8307327Z tests/test_private_registration_endpoints.py::TestUserValidationEndpoint::test_user_validation_available SKIPPED [ 76%]
2025-10-08T16:24:05.8327967Z tests/test_private_registration_endpoints.py::TestUserValidationEndpoint::test_user_validation_taken SKIPPED [ 84%]
2025-10-08T16:24:05.8348777Z tests/test_private_registration_endpoints.py::TestEnvironmentConfiguration::test_feature_disabled_via_env SKIPPED [ 92%]
2025-10-08T16:24:06.0772378Z tests/test_private_registration_endpoints.py::TestEnvironmentConfiguration::test_secret_from_environment SKIPPED [100%]
2025-10-08T16:24:06.0773269Z 
2025-10-08T16:24:06.0773476Z ============================= 13 skipped in 1.16s ==============================
2025-10-08T16:24:06.5142976Z ============================= test session starts ==============================
2025-10-08T16:24:06.5144118Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:06.5145412Z cachedir: .pytest_cache
2025-10-08T16:24:06.5145897Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:06.5146466Z plugins: anyio-4.11.0
2025-10-08T16:24:07.9217844Z collecting ... collected 1 item
2025-10-08T16:24:07.9218180Z 
2025-10-08T16:24:09.2772546Z tests/test_activitypub_util.py::test_find_actor_or_create FAILED         [100%]
2025-10-08T16:24:09.2773167Z 
2025-10-08T16:24:09.2773378Z =================================== FAILURES ===================================
2025-10-08T16:24:09.2774000Z __________________________ test_find_actor_or_create ___________________________
2025-10-08T16:24:09.2774276Z 
2025-10-08T16:24:09.2774598Z self = <sqlalchemy.engine.base.Connection object at 0x7fbb97b1f820>
2025-10-08T16:24:09.2775549Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fbb9dc557f0>
2025-10-08T16:24:09.2776656Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fbb97720690>
2025-10-08T16:24:09.2777712Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7fbb97d2c440>
2025-10-08T16:24:09.2778278Z parameters = [('use_allowlist', 1, 0)]
2025-10-08T16:24:09.2778480Z 
2025-10-08T16:24:09.2778577Z     def _exec_single_context(
2025-10-08T16:24:09.2778818Z         self,
2025-10-08T16:24:09.2779017Z         dialect: Dialect,
2025-10-08T16:24:09.2779693Z         context: ExecutionContext,
2025-10-08T16:24:09.2780163Z         statement: Union[str, Compiled],
2025-10-08T16:24:09.2780721Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:24:09.2781251Z     ) -> CursorResult[Any]:
2025-10-08T16:24:09.2781737Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:24:09.2782324Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:24:09.2782770Z     
2025-10-08T16:24:09.2783033Z         """
2025-10-08T16:24:09.2783412Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:24:09.2783880Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:24:09.2784190Z     
2025-10-08T16:24:09.2784379Z             if generic_setinputsizes:
2025-10-08T16:24:09.2784623Z                 try:
2025-10-08T16:24:09.2784833Z                     dialect.do_set_input_sizes(
2025-10-08T16:24:09.2785140Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:24:09.2785428Z                     )
2025-10-08T16:24:09.2785639Z                 except BaseException as e:
2025-10-08T16:24:09.2785922Z                     self._handle_dbapi_exception(
2025-10-08T16:24:09.2786222Z                         e, str(statement), parameters, None, context
2025-10-08T16:24:09.2786490Z                     )
2025-10-08T16:24:09.2786665Z     
2025-10-08T16:24:09.2786856Z         cursor, str_statement, parameters = (
2025-10-08T16:24:09.2787116Z             context.cursor,
2025-10-08T16:24:09.2787335Z             context.statement,
2025-10-08T16:24:09.2787571Z             context.parameters,
2025-10-08T16:24:09.2787788Z         )
2025-10-08T16:24:09.2787942Z     
2025-10-08T16:24:09.2788166Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:24:09.2788445Z     
2025-10-08T16:24:09.2788618Z         if not context.executemany:
2025-10-08T16:24:09.2788894Z             effective_parameters = parameters[0]
2025-10-08T16:24:09.2789379Z         else:
2025-10-08T16:24:09.2789576Z             effective_parameters = parameters
2025-10-08T16:24:09.2789822Z     
2025-10-08T16:24:09.2790259Z         if self._has_events or self.engine._has_events:
2025-10-08T16:24:09.2790595Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:24:09.2790902Z                 str_statement, effective_parameters = fn(
2025-10-08T16:24:09.2791166Z                     self,
2025-10-08T16:24:09.2791368Z                     cursor,
2025-10-08T16:24:09.2791575Z                     str_statement,
2025-10-08T16:24:09.2791818Z                     effective_parameters,
2025-10-08T16:24:09.2792200Z                     context,
2025-10-08T16:24:09.2792420Z                     context.executemany,
2025-10-08T16:24:09.2792655Z                 )
2025-10-08T16:24:09.2792830Z     
2025-10-08T16:24:09.2792990Z         if self._echo:
2025-10-08T16:24:09.2793202Z             self._log_info(str_statement)
2025-10-08T16:24:09.2793433Z     
2025-10-08T16:24:09.2793609Z             stats = context._get_cache_stats()
2025-10-08T16:24:09.2793845Z     
2025-10-08T16:24:09.2794034Z             if not self.engine.hide_parameters:
2025-10-08T16:24:09.2794290Z                 self._log_info(
2025-10-08T16:24:09.2794499Z                     "[%s] %r",
2025-10-08T16:24:09.2794709Z                     stats,
2025-10-08T16:24:09.2794922Z                     sql_util._repr_params(
2025-10-08T16:24:09.2795172Z                         effective_parameters,
2025-10-08T16:24:09.2795422Z                         batches=10,
2025-10-08T16:24:09.2795676Z                         ismulti=context.executemany,
2025-10-08T16:24:09.2795931Z                     ),
2025-10-08T16:24:09.2796113Z                 )
2025-10-08T16:24:09.2796289Z             else:
2025-10-08T16:24:09.2796468Z                 self._log_info(
2025-10-08T16:24:09.2796755Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:24:09.2797061Z                     stats,
2025-10-08T16:24:09.2797263Z                 )
2025-10-08T16:24:09.2797434Z     
2025-10-08T16:24:09.2797608Z         evt_handled: bool = False
2025-10-08T16:24:09.2797842Z         try:
2025-10-08T16:24:09.2798085Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:24:09.2798404Z                 effective_parameters = cast(
2025-10-08T16:24:09.2798709Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:24:09.2798981Z                 )
2025-10-08T16:24:09.2799431Z                 if self.dialect._has_events:
2025-10-08T16:24:09.2799735Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:24:09.2800021Z                         if fn(
2025-10-08T16:24:09.2800239Z                             cursor,
2025-10-08T16:24:09.2800470Z                             str_statement,
2025-10-08T16:24:09.2800750Z                             effective_parameters,
2025-10-08T16:24:09.2801004Z                             context,
2025-10-08T16:24:09.2801228Z                         ):
2025-10-08T16:24:09.2801446Z                             evt_handled = True
2025-10-08T16:24:09.2801684Z                             break
2025-10-08T16:24:09.2801908Z                 if not evt_handled:
2025-10-08T16:24:09.2802159Z                     self.dialect.do_executemany(
2025-10-08T16:24:09.2802407Z                         cursor,
2025-10-08T16:24:09.2802629Z                         str_statement,
2025-10-08T16:24:09.2802879Z                         effective_parameters,
2025-10-08T16:24:09.2803123Z                         context,
2025-10-08T16:24:09.2803330Z                     )
2025-10-08T16:24:09.2803589Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:24:09.2803911Z                 if self.dialect._has_events:
2025-10-08T16:24:09.2804212Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:24:09.2804550Z                         if fn(cursor, str_statement, context):
2025-10-08T16:24:09.2804831Z                             evt_handled = True
2025-10-08T16:24:09.2805066Z                             break
2025-10-08T16:24:09.2805454Z                 if not evt_handled:
2025-10-08T16:24:09.2805721Z                     self.dialect.do_execute_no_params(
2025-10-08T16:24:09.2805996Z                         cursor, str_statement, context
2025-10-08T16:24:09.2806234Z                     )
2025-10-08T16:24:09.2806414Z             else:
2025-10-08T16:24:09.2806611Z                 effective_parameters = cast(
2025-10-08T16:24:09.2806905Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:24:09.2807306Z                 )
2025-10-08T16:24:09.2807503Z                 if self.dialect._has_events:
2025-10-08T16:24:09.2807780Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:24:09.2808056Z                         if fn(
2025-10-08T16:24:09.2808266Z                             cursor,
2025-10-08T16:24:09.2808488Z                             str_statement,
2025-10-08T16:24:09.2808740Z                             effective_parameters,
2025-10-08T16:24:09.2808997Z                             context,
2025-10-08T16:24:09.2809428Z                         ):
2025-10-08T16:24:09.2809643Z                             evt_handled = True
2025-10-08T16:24:09.2809886Z                             break
2025-10-08T16:24:09.2810109Z                 if not evt_handled:
2025-10-08T16:24:09.2810342Z >                   self.dialect.do_execute(
2025-10-08T16:24:09.2810642Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:24:09.2810934Z                     )
2025-10-08T16:24:09.2811057Z 
2025-10-08T16:24:09.2811353Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:24:09.2811865Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:09.2812077Z 
2025-10-08T16:24:09.2812349Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fbb9dc557f0>
2025-10-08T16:24:09.2812809Z cursor = <sqlite3.Cursor object at 0x7fbb97760540>
2025-10-08T16:24:09.2813404Z statement = 'SELECT settings.name AS settings_name, settings.value AS settings_value \nFROM settings \nWHERE settings.name = ?\n LIMIT ? OFFSET ?'
2025-10-08T16:24:09.2813973Z parameters = ('use_allowlist', 1, 0)
2025-10-08T16:24:09.2814392Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fbb97720690>
2025-10-08T16:24:09.2814743Z 
2025-10-08T16:24:09.2814905Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:09.2815254Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:09.2815567Z E       sqlite3.OperationalError: no such table: settings
2025-10-08T16:24:09.2815777Z 
2025-10-08T16:24:09.2816123Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:09.2816674Z 
2025-10-08T16:24:09.2816844Z The above exception was the direct cause of the following exception:
2025-10-08T16:24:09.2817101Z 
2025-10-08T16:24:09.2817179Z app = <Flask 'app'>
2025-10-08T16:24:09.2817307Z 
2025-10-08T16:24:09.2817408Z     def test_find_actor_or_create(app):
2025-10-08T16:24:09.2817659Z         with app.app_context():
2025-10-08T16:24:09.2817912Z             server_name = app.config['SERVER_NAME']
2025-10-08T16:24:09.2818302Z             user_name = 'rimu'  # Note to others: change this to your login before running this test
2025-10-08T16:24:09.2818672Z     
2025-10-08T16:24:09.2818927Z             # Test with a local URL
2025-10-08T16:24:09.2819664Z >           local_user = find_actor_or_create(f"https://{server_name}/u/{user_name}", create_if_not_found=False)
2025-10-08T16:24:09.2820167Z                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2820549Z 
2025-10-08T16:24:09.2820677Z tests/test_activitypub_util.py:29: 
2025-10-08T16:24:09.2821086Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:09.2821457Z app/activitypub/util.py:269: in find_actor_or_create
2025-10-08T16:24:09.2822067Z     if not validate_remote_actor(actor_url):
2025-10-08T16:24:09.2822428Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2822858Z app/activitypub/actor.py:41: in validate_remote_actor
2025-10-08T16:24:09.2833479Z     if get_setting('use_allowlist', False):
2025-10-08T16:24:09.2833931Z        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2834793Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:899: in decorated_function
2025-10-08T16:24:09.2835556Z     rv = self._call_fn(f, *args, **kwargs)
2025-10-08T16:24:09.2835820Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2836294Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:185: in _call_fn
2025-10-08T16:24:09.2836790Z     return ensure_sync(fn)(*args, **kwargs)
2025-10-08T16:24:09.2837044Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2837297Z app/utils.py:181: in get_setting
2025-10-08T16:24:09.2837624Z     setting = db.session.query(Settings).filter_by(name=name).first()
2025-10-08T16:24:09.2837964Z               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2838434Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:2759: in first
2025-10-08T16:24:09.2838945Z     return self.limit(1)._iter().first()  # type: ignore
2025-10-08T16:24:09.2839470Z            ^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:09.2839931Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:2857: in _iter
2025-10-08T16:24:09.2840502Z     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
2025-10-08T16:24:09.2841071Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:24:09.2841551Z     return self._execute_internal(
2025-10-08T16:24:09.2842085Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:24:09.7887605Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:24:09.7888706Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:24:09.7889870Z     result = conn.execute(
2025-10-08T16:24:09.7890519Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:24:09.7891221Z     return meth(
2025-10-08T16:24:09.7891894Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:24:09.7892687Z     return connection._execute_clauseelement(
2025-10-08T16:24:09.7893516Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:24:09.7894295Z     ret = self._execute_context(
2025-10-08T16:24:09.7895002Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:24:09.7895737Z     return self._exec_single_context(
2025-10-08T16:24:09.7896478Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:24:09.7897231Z     self._handle_dbapi_exception(
2025-10-08T16:24:09.7897975Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:24:09.7898796Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:24:09.7899583Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:24:09.7900127Z     self.dialect.do_execute(
2025-10-08T16:24:09.7900395Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:09.7900608Z 
2025-10-08T16:24:09.7901238Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fbb9dc557f0>
2025-10-08T16:24:09.7901721Z cursor = <sqlite3.Cursor object at 0x7fbb97760540>
2025-10-08T16:24:09.7902308Z statement = 'SELECT settings.name AS settings_name, settings.value AS settings_value \nFROM settings \nWHERE settings.name = ?\n LIMIT ? OFFSET ?'
2025-10-08T16:24:09.7902872Z parameters = ('use_allowlist', 1, 0)
2025-10-08T16:24:09.7903305Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fbb97720690>
2025-10-08T16:24:09.7903788Z 
2025-10-08T16:24:09.7903962Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:09.7904304Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:09.7904731Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: settings
2025-10-08T16:24:09.7905249Z E       [SQL: SELECT settings.name AS settings_name, settings.value AS settings_value 
2025-10-08T16:24:09.7905610Z E       FROM settings 
2025-10-08T16:24:09.7905822Z E       WHERE settings.name = ?
2025-10-08T16:24:09.7906052Z E        LIMIT ? OFFSET ?]
2025-10-08T16:24:09.7906284Z E       [parameters: ('use_allowlist', 1, 0)]
2025-10-08T16:24:09.7906633Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:09.7906882Z 
2025-10-08T16:24:09.7907241Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:09.7907844Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:24:09.7908178Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:09.7908504Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:09.7908915Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:09.7909384Z =============================== warnings summary ===============================
2025-10-08T16:24:09.7909876Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32
2025-10-08T16:24:09.7910977Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:09.7911897Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:09.7912097Z 
2025-10-08T16:24:09.7912389Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36
2025-10-08T16:24:09.7913451Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:09.7914349Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:09.7914564Z 
2025-10-08T16:24:09.7914853Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952
2025-10-08T16:24:09.7915739Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:09.7916571Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:09.7916886Z 
2025-10-08T16:24:09.7917174Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952
2025-10-08T16:24:09.7918078Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:09.7918911Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:09.7919314Z 
2025-10-08T16:24:09.7919660Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:09.7920054Z =========================== short test summary info ============================
2025-10-08T16:24:09.7920718Z FAILED tests/test_activitypub_util.py::test_find_actor_or_create - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: settings
2025-10-08T16:24:09.7921417Z [SQL: SELECT settings.name AS settings_name, settings.value AS settings_value 
2025-10-08T16:24:09.7921766Z FROM settings 
2025-10-08T16:24:09.7922061Z WHERE settings.name = ?
2025-10-08T16:24:09.7922271Z  LIMIT ? OFFSET ?]
2025-10-08T16:24:09.7922480Z [parameters: ('use_allowlist', 1, 0)]
2025-10-08T16:24:09.7922800Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:09.7923162Z ======================== 1 failed, 4 warnings in 2.77s =========================
2025-10-08T16:24:10.4970927Z ============================= test session starts ==============================
2025-10-08T16:24:10.4971968Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:10.4972807Z cachedir: .pytest_cache
2025-10-08T16:24:10.4973220Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:10.4973676Z plugins: anyio-4.11.0
2025-10-08T16:24:10.5329389Z collecting ... collected 4 items
2025-10-08T16:24:10.5329777Z 
2025-10-08T16:24:12.4301774Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_calls_finalize_user_setup PASSED [ 25%]
2025-10-08T16:24:12.8205507Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_skips_finalize_when_not_activated PASSED [ 50%]
2025-10-08T16:24:13.2377270Z tests/test_private_registration_activitypub.py::TestFinalizeUserSetupBehavior::test_finalize_user_setup_preserves_existing_keys PASSED [ 75%]
2025-10-08T16:24:14.0403661Z tests/test_private_registration_activitypub.py::TestFinalizeUserSetupBehavior::test_finalize_user_setup_sets_activitypub_fields PASSED [100%]
2025-10-08T16:24:14.0404470Z 
2025-10-08T16:24:14.0404654Z =============================== warnings summary ===============================
2025-10-08T16:24:14.0405599Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_calls_finalize_user_setup
2025-10-08T16:24:14.0407386Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:14.0408712Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:14.0408949Z 
2025-10-08T16:24:14.0409793Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_calls_finalize_user_setup
2025-10-08T16:24:14.0411254Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:14.0412314Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:14.0412550Z 
2025-10-08T16:24:14.0413058Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_calls_finalize_user_setup
2025-10-08T16:24:14.0414261Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:14.0415224Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:14.0415587Z 
2025-10-08T16:24:14.0416095Z tests/test_private_registration_activitypub.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_calls_finalize_user_setup
2025-10-08T16:24:14.0417601Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:14.0418573Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:14.0418905Z 
2025-10-08T16:24:14.0419249Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:14.0419661Z ======================== 4 passed, 4 warnings in 3.05s =========================
2025-10-08T16:24:14.7132148Z ============================= test session starts ==============================
2025-10-08T16:24:14.7132857Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:14.7133420Z cachedir: .pytest_cache
2025-10-08T16:24:14.7133717Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:14.7134060Z plugins: anyio-4.11.0
2025-10-08T16:24:15.7765667Z collecting ... collected 1 item
2025-10-08T16:24:15.7765952Z 
2025-10-08T16:24:17.3393241Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks FAILED       [100%]
2025-10-08T16:24:17.3394031Z 
2025-10-08T16:24:17.3394228Z =================================== FAILURES ===================================
2025-10-08T16:24:17.3394827Z ___________________________ test_api_reply_bookmarks ___________________________
2025-10-08T16:24:17.3395200Z 
2025-10-08T16:24:17.3395499Z self = <sqlalchemy.engine.base.Connection object at 0x7fd5c0cc3ce0>
2025-10-08T16:24:17.3396427Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fd5ca5742f0>
2025-10-08T16:24:17.3397524Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fd5c0728a50>
2025-10-08T16:24:17.3398536Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7fd5c0d29400>
2025-10-08T16:24:17.3399430Z parameters = [(1,)]
2025-10-08T16:24:17.3399649Z 
2025-10-08T16:24:17.3399795Z     def _exec_single_context(
2025-10-08T16:24:17.3400175Z         self,
2025-10-08T16:24:17.3400366Z         dialect: Dialect,
2025-10-08T16:24:17.3400603Z         context: ExecutionContext,
2025-10-08T16:24:17.3400865Z         statement: Union[str, Compiled],
2025-10-08T16:24:17.3401173Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:24:17.3401479Z     ) -> CursorResult[Any]:
2025-10-08T16:24:17.3401773Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:24:17.3402118Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:24:17.3402398Z     
2025-10-08T16:24:17.3402560Z         """
2025-10-08T16:24:17.3402797Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:24:17.3403166Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:24:17.3403473Z     
2025-10-08T16:24:17.3403655Z             if generic_setinputsizes:
2025-10-08T16:24:17.3403884Z                 try:
2025-10-08T16:24:17.3404099Z                     dialect.do_set_input_sizes(
2025-10-08T16:24:17.3404404Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:24:17.3404673Z                     )
2025-10-08T16:24:17.3404884Z                 except BaseException as e:
2025-10-08T16:24:17.3405154Z                     self._handle_dbapi_exception(
2025-10-08T16:24:17.3405449Z                         e, str(statement), parameters, None, context
2025-10-08T16:24:17.3405707Z                     )
2025-10-08T16:24:17.3405883Z     
2025-10-08T16:24:17.3406071Z         cursor, str_statement, parameters = (
2025-10-08T16:24:17.3406352Z             context.cursor,
2025-10-08T16:24:17.3406578Z             context.statement,
2025-10-08T16:24:17.3406811Z             context.parameters,
2025-10-08T16:24:17.3407017Z         )
2025-10-08T16:24:17.3407180Z     
2025-10-08T16:24:17.3407408Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:24:17.3407681Z     
2025-10-08T16:24:17.3407862Z         if not context.executemany:
2025-10-08T16:24:17.3408127Z             effective_parameters = parameters[0]
2025-10-08T16:24:17.3408574Z         else:
2025-10-08T16:24:17.3408785Z             effective_parameters = parameters
2025-10-08T16:24:17.3409312Z     
2025-10-08T16:24:17.3409565Z         if self._has_events or self.engine._has_events:
2025-10-08T16:24:17.3409891Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:24:17.3410204Z                 str_statement, effective_parameters = fn(
2025-10-08T16:24:17.3410464Z                     self,
2025-10-08T16:24:17.3410817Z                     cursor,
2025-10-08T16:24:17.3411028Z                     str_statement,
2025-10-08T16:24:17.3411261Z                     effective_parameters,
2025-10-08T16:24:17.3411507Z                     context,
2025-10-08T16:24:17.3411731Z                     context.executemany,
2025-10-08T16:24:17.3411962Z                 )
2025-10-08T16:24:17.3412129Z     
2025-10-08T16:24:17.3412292Z         if self._echo:
2025-10-08T16:24:17.3412499Z             self._log_info(str_statement)
2025-10-08T16:24:17.3412756Z     
2025-10-08T16:24:17.3412944Z             stats = context._get_cache_stats()
2025-10-08T16:24:17.3413181Z     
2025-10-08T16:24:17.3413360Z             if not self.engine.hide_parameters:
2025-10-08T16:24:17.3413624Z                 self._log_info(
2025-10-08T16:24:17.3413847Z                     "[%s] %r",
2025-10-08T16:24:17.3414054Z                     stats,
2025-10-08T16:24:17.3414271Z                     sql_util._repr_params(
2025-10-08T16:24:17.3414531Z                         effective_parameters,
2025-10-08T16:24:17.3414795Z                         batches=10,
2025-10-08T16:24:17.3415050Z                         ismulti=context.executemany,
2025-10-08T16:24:17.3415303Z                     ),
2025-10-08T16:24:17.3415487Z                 )
2025-10-08T16:24:17.3415656Z             else:
2025-10-08T16:24:17.3415841Z                 self._log_info(
2025-10-08T16:24:17.3416122Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:24:17.3416414Z                     stats,
2025-10-08T16:24:17.3416611Z                 )
2025-10-08T16:24:17.3416781Z     
2025-10-08T16:24:17.3416953Z         evt_handled: bool = False
2025-10-08T16:24:17.3417173Z         try:
2025-10-08T16:24:17.3417415Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:24:17.3417727Z                 effective_parameters = cast(
2025-10-08T16:24:17.3418026Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:24:17.3418302Z                 )
2025-10-08T16:24:17.3418502Z                 if self.dialect._has_events:
2025-10-08T16:24:17.3418784Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:24:17.3419181Z                         if fn(
2025-10-08T16:24:17.3419395Z                             cursor,
2025-10-08T16:24:17.3419621Z                             str_statement,
2025-10-08T16:24:17.3419881Z                             effective_parameters,
2025-10-08T16:24:17.3420134Z                             context,
2025-10-08T16:24:17.3420353Z                         ):
2025-10-08T16:24:17.3420568Z                             evt_handled = True
2025-10-08T16:24:17.3420807Z                             break
2025-10-08T16:24:17.3421030Z                 if not evt_handled:
2025-10-08T16:24:17.3421272Z                     self.dialect.do_executemany(
2025-10-08T16:24:17.3421524Z                         cursor,
2025-10-08T16:24:17.3421744Z                         str_statement,
2025-10-08T16:24:17.3421983Z                         effective_parameters,
2025-10-08T16:24:17.3422237Z                         context,
2025-10-08T16:24:17.3422447Z                     )
2025-10-08T16:24:17.3422697Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:24:17.3423009Z                 if self.dialect._has_events:
2025-10-08T16:24:17.3423320Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:24:17.3423647Z                         if fn(cursor, str_statement, context):
2025-10-08T16:24:17.3424041Z                             evt_handled = True
2025-10-08T16:24:17.3424290Z                             break
2025-10-08T16:24:17.3424512Z                 if not evt_handled:
2025-10-08T16:24:17.3424757Z                     self.dialect.do_execute_no_params(
2025-10-08T16:24:17.3425031Z                         cursor, str_statement, context
2025-10-08T16:24:17.3425275Z                     )
2025-10-08T16:24:17.3425449Z             else:
2025-10-08T16:24:17.3425650Z                 effective_parameters = cast(
2025-10-08T16:24:17.3426051Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:24:17.3426320Z                 )
2025-10-08T16:24:17.3426510Z                 if self.dialect._has_events:
2025-10-08T16:24:17.3426794Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:24:17.3427068Z                         if fn(
2025-10-08T16:24:17.3427275Z                             cursor,
2025-10-08T16:24:17.3427508Z                             str_statement,
2025-10-08T16:24:17.3427760Z                             effective_parameters,
2025-10-08T16:24:17.3428012Z                             context,
2025-10-08T16:24:17.3428233Z                         ):
2025-10-08T16:24:17.3428448Z                             evt_handled = True
2025-10-08T16:24:17.3428681Z                             break
2025-10-08T16:24:17.3428899Z                 if not evt_handled:
2025-10-08T16:24:17.3429252Z >                   self.dialect.do_execute(
2025-10-08T16:24:17.3429555Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:24:17.3429844Z                     )
2025-10-08T16:24:17.3429964Z 
2025-10-08T16:24:17.3430255Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:24:17.3430742Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:17.3430945Z 
2025-10-08T16:24:17.3431218Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fd5ca5742f0>
2025-10-08T16:24:17.3431689Z cursor = <sqlite3.Cursor object at 0x7fd5c0708640>
2025-10-08T16:24:17.3432503Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:17.3433307Z parameters = (1,)
2025-10-08T16:24:17.3433680Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fd5c0728a50>
2025-10-08T16:24:17.3434035Z 
2025-10-08T16:24:17.3434197Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:17.3434539Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:17.3434840Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:24:17.3435040Z 
2025-10-08T16:24:17.3435395Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:17.3435841Z 
2025-10-08T16:24:17.3436013Z The above exception was the direct cause of the following exception:
2025-10-08T16:24:17.3436268Z 
2025-10-08T16:24:17.3436347Z app = <Flask 'app'>
2025-10-08T16:24:17.3436465Z 
2025-10-08T16:24:17.3436568Z     def test_api_reply_bookmarks(app):
2025-10-08T16:24:17.3436818Z         with app.app_context():
2025-10-08T16:24:17.3437110Z             from app.api.alpha.utils.reply import put_reply_save
2025-10-08T16:24:17.3437400Z     
2025-10-08T16:24:17.3437559Z             user_id = 1
2025-10-08T16:24:17.3437775Z >           user = User.query.get(user_id)
2025-10-08T16:24:17.3438023Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:17.3438176Z 
2025-10-08T16:24:17.3438280Z tests/test_api_reply_bookmarks.py:29: 
2025-10-08T16:24:17.3438555Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:17.3438826Z <string>:2: in get
2025-10-08T16:24:17.3439008Z     ???
2025-10-08T16:24:17.3439742Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:24:17.3440306Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:24:17.3440598Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:17.3441021Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:24:17.3441526Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:24:17.3441939Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:17.3442425Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:24:17.3442898Z     return self.session._get_impl(
2025-10-08T16:24:17.3443365Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:24:17.3443834Z     return db_load_fn(
2025-10-08T16:24:17.3444306Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:24:17.3444806Z     session.execute(
2025-10-08T16:24:17.3445224Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:24:17.3445690Z     return self._execute_internal(
2025-10-08T16:24:17.3446175Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:24:17.3446746Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:24:17.3447333Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:24:17.3447844Z     result = conn.execute(
2025-10-08T16:24:17.3448270Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:24:17.3448722Z     return meth(
2025-10-08T16:24:17.3449302Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:24:17.3449849Z     return connection._execute_clauseelement(
2025-10-08T16:24:17.3450407Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:24:17.3450933Z     ret = self._execute_context(
2025-10-08T16:24:17.3451415Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:24:17.3451927Z     return self._exec_single_context(
2025-10-08T16:24:17.3452434Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:24:17.3452957Z     self._handle_dbapi_exception(
2025-10-08T16:24:17.3453475Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:24:17.3454072Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:24:17.3454644Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:24:17.3455159Z     self.dialect.do_execute(
2025-10-08T16:24:17.3455415Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:17.3455616Z 
2025-10-08T16:24:17.3455879Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fd5ca5742f0>
2025-10-08T16:24:17.3456343Z cursor = <sqlite3.Cursor object at 0x7fd5c0708640>
2025-10-08T16:24:17.3457155Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:17.3457920Z parameters = (1,)
2025-10-08T16:24:17.3458437Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fd5c0728a50>
2025-10-08T16:24:17.3458798Z 
2025-10-08T16:24:17.3458962Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:17.3459404Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:17.3459810Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:17.3474813Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:17.3490756Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:17.3491431Z E       WHERE user.id = ?]
2025-10-08T16:24:17.3491656Z E       [parameters: (1,)]
2025-10-08T16:24:17.3491962Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:17.3492212Z 
2025-10-08T16:24:17.3492569Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:17.3493159Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:24:17.3493488Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:17.3493819Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:17.3494222Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:17.3494578Z =============================== warnings summary ===============================
2025-10-08T16:24:17.3494942Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks
2025-10-08T16:24:17.3495877Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:17.3496774Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:17.3496980Z 
2025-10-08T16:24:17.3497123Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks
2025-10-08T16:24:17.3498032Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:17.8729850Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:17.8730160Z 
2025-10-08T16:24:17.8730362Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks
2025-10-08T16:24:17.8731225Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:17.8732422Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:17.8732770Z 
2025-10-08T16:24:17.8732940Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks
2025-10-08T16:24:17.8733759Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:17.8734672Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:17.8735137Z 
2025-10-08T16:24:17.8735302Z tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks
2025-10-08T16:24:17.8736586Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_reply_bookmarks.py:29: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:24:17.8737802Z     user = User.query.get(user_id)
2025-10-08T16:24:17.8737978Z 
2025-10-08T16:24:17.8738173Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:17.8738586Z =========================== short test summary info ============================
2025-10-08T16:24:17.8739612Z FAILED tests/test_api_reply_bookmarks.py::test_api_reply_bookmarks - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:17.8754821Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:17.8770395Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:17.8771055Z WHERE user.id = ?]
2025-10-08T16:24:17.8771255Z [parameters: (1,)]
2025-10-08T16:24:17.8771564Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:17.8771936Z ======================== 1 failed, 5 warnings in 2.64s =========================
2025-10-08T16:24:18.6629966Z ============================= test session starts ==============================
2025-10-08T16:24:18.6630969Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:18.6631855Z cachedir: .pytest_cache
2025-10-08T16:24:18.6632285Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:18.6632756Z plugins: anyio-4.11.0
2025-10-08T16:24:19.7361233Z collecting ... collected 4 items
2025-10-08T16:24:19.7361639Z 
2025-10-08T16:24:20.6438101Z tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered FAILED [ 25%]
2025-10-08T16:24:20.9592432Z tests/test_api_blueprint_registration.py::test_api_routes_accessible PASSED [ 50%]
2025-10-08T16:24:21.3692657Z tests/test_api_blueprint_registration.py::test_blueprint_route_coverage PASSED [ 75%]
2025-10-08T16:24:21.9394165Z tests/test_api_blueprint_registration.py::test_api_blueprint_imports PASSED [100%]
2025-10-08T16:24:21.9394870Z 
2025-10-08T16:24:21.9395081Z =================================== FAILURES ===================================
2025-10-08T16:24:21.9395669Z ______________________ test_all_api_blueprints_registered ______________________
2025-10-08T16:24:21.9396545Z 
2025-10-08T16:24:21.9396717Z     def test_all_api_blueprints_registered():
2025-10-08T16:24:21.9397257Z         """Verify all defined API blueprints are properly registered."""
2025-10-08T16:24:21.9397752Z         app = create_app()
2025-10-08T16:24:21.9398057Z     
2025-10-08T16:24:21.9398389Z         # Expected API blueprints that should be registered
2025-10-08T16:24:21.9398839Z         expected_api_blueprints = {
2025-10-08T16:24:21.9399511Z             'Site',           # site_bp
2025-10-08T16:24:21.9399890Z             'Misc',           # misc_bp
2025-10-08T16:24:21.9400259Z             'Community',      # comm_bp
2025-10-08T16:24:21.9400611Z             'Feed',           # feed_bp
2025-10-08T16:24:21.9400976Z             'Topic',          # topic_bp
2025-10-08T16:24:21.9401339Z             'User',           # user_bp
2025-10-08T16:24:21.9401687Z             'Comment',        # reply_bp
2025-10-08T16:24:21.9402065Z             'Post',           # post_bp
2025-10-08T16:24:21.9402476Z             'Private Message',# private_message_bp
2025-10-08T16:24:21.9402880Z             'Upload',         # upload_bp
2025-10-08T16:24:21.9403338Z             'Admin',          # admin_bp (special case with different prefix)
2025-10-08T16:24:21.9403779Z         }
2025-10-08T16:24:21.9404018Z     
2025-10-08T16:24:21.9404375Z         # Get all registered blueprints from the Flask-Smorest API
2025-10-08T16:24:21.9404854Z         registered_blueprints = set()
2025-10-08T16:24:21.9405292Z         if hasattr(app.extensions, 'smorest'):
2025-10-08T16:24:21.9405713Z             api = app.extensions.get('smorest')
2025-10-08T16:24:21.9406120Z             if api and hasattr(api, '_app'):
2025-10-08T16:24:21.9406544Z                 for bp in api._app.blueprints.values():
2025-10-08T16:24:21.9407013Z                     if hasattr(bp, 'name') and bp.name != 'api_alpha':
2025-10-08T16:24:21.9407479Z                         registered_blueprints.add(bp.name)
2025-10-08T16:24:21.9407859Z     
2025-10-08T16:24:21.9408181Z         # Check if all expected blueprints are registered
2025-10-08T16:24:21.9408764Z         missing_blueprints = expected_api_blueprints - registered_blueprints
2025-10-08T16:24:21.9409421Z     
2025-10-08T16:24:21.9409879Z >       assert not missing_blueprints, f"Missing API blueprints: {missing_blueprints}"
2025-10-08T16:24:21.9410919Z E       AssertionError: Missing API blueprints: {'Community', 'User', 'Admin', 'Upload', 'Feed', 'Private Message', 'Misc', 'Comment', 'Post', 'Site', 'Topic'}
2025-10-08T16:24:21.9411873Z E       assert not {'Admin', 'Comment', 'Community', 'Feed', 'Misc', 'Post', ...}
2025-10-08T16:24:21.9412270Z 
2025-10-08T16:24:21.9412492Z tests/test_api_blueprint_registration.py:43: AssertionError
2025-10-08T16:24:21.9413083Z ------------------------------ Captured log call -------------------------------
2025-10-08T16:24:21.9413583Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:21.9414077Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:21.9414709Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:21.9415240Z =============================== warnings summary ===============================
2025-10-08T16:24:21.9415875Z tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered
2025-10-08T16:24:21.9417689Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:21.9419298Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:21.9419606Z 
2025-10-08T16:24:21.9419925Z tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered
2025-10-08T16:24:21.9421456Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:21.9423088Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:21.9423406Z 
2025-10-08T16:24:21.9423713Z tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered
2025-10-08T16:24:21.9424979Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:21.9426300Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:21.9426784Z 
2025-10-08T16:24:21.9427090Z tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered
2025-10-08T16:24:21.9428354Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:21.9429794Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:21.9430307Z 
2025-10-08T16:24:21.9430583Z tests/test_api_blueprint_registration.py::test_api_routes_accessible
2025-10-08T16:24:21.9432193Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_api_blueprint_registration.py::test_api_routes_accessible returned <class 'bool'>.
2025-10-08T16:24:21.9433709Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:24:21.9434412Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:24:21.9435054Z     warnings.warn(
2025-10-08T16:24:21.9435241Z 
2025-10-08T16:24:21.9435524Z tests/test_api_blueprint_registration.py::test_blueprint_route_coverage
2025-10-08T16:24:21.9437141Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_api_blueprint_registration.py::test_blueprint_route_coverage returned <class 'bool'>.
2025-10-08T16:24:21.9438650Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:24:21.9439504Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:24:21.9440128Z     warnings.warn(
2025-10-08T16:24:21.9440300Z 
2025-10-08T16:24:21.9440562Z tests/test_api_blueprint_registration.py::test_api_blueprint_imports
2025-10-08T16:24:21.9442146Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_api_blueprint_registration.py::test_api_blueprint_imports returned <class 'bool'>.
2025-10-08T16:24:21.9443662Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:24:21.9444327Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:24:21.9444977Z     warnings.warn(
2025-10-08T16:24:21.9445150Z 
2025-10-08T16:24:21.9445424Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:21.9446022Z =========================== short test summary info ============================
2025-10-08T16:24:21.9447442Z FAILED tests/test_api_blueprint_registration.py::test_all_api_blueprints_registered - AssertionError: Missing API blueprints: {'Community', 'User', 'Admin', 'Upload', 'Feed', 'Private Message', 'Misc', 'Comment', 'Post', 'Site', 'Topic'}
2025-10-08T16:24:21.9449299Z assert not {'Admin', 'Comment', 'Community', 'Feed', 'Misc', 'Post', ...}
2025-10-08T16:24:21.9449912Z =================== 1 failed, 3 passed, 7 warnings in 2.72s ====================
2025-10-08T16:24:22.7345532Z ============================= test session starts ==============================
2025-10-08T16:24:22.7346530Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:22.7347416Z cachedir: .pytest_cache
2025-10-08T16:24:22.7348167Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:22.7348635Z plugins: anyio-4.11.0
2025-10-08T16:24:24.2499915Z collecting ... collected 11 items
2025-10-08T16:24:24.2500209Z 
2025-10-08T16:24:24.5907494Z tests/test_field_consistency.py::TestFieldConsistency::test_user_model_has_required_fields PASSED [  9%]
2025-10-08T16:24:24.8832920Z tests/test_field_consistency.py::TestFieldConsistency::test_api_schema_matches_model_fields PASSED [ 18%]
2025-10-08T16:24:25.2836706Z tests/test_field_consistency.py::TestFieldConsistency::test_user_view_field_mapping PASSED [ 27%]
2025-10-08T16:24:25.5770519Z tests/test_field_consistency.py::TestFieldConsistency::test_no_username_vs_user_name_confusion PASSED [ 36%]
2025-10-08T16:24:25.9774968Z tests/test_field_consistency.py::TestBaselineFunctionality::test_user_model_instantiation PASSED [ 45%]
2025-10-08T16:24:26.2728685Z tests/test_field_consistency.py::TestBaselineFunctionality::test_api_schema_validation PASSED [ 54%]
2025-10-08T16:24:26.5725385Z tests/test_field_consistency.py::TestAPIEndpointImmutability::test_critical_api_endpoints_exist PASSED [ 63%]
2025-10-08T16:24:26.8686817Z tests/test_field_consistency.py::TestAPIEndpointImmutability::test_api_response_field_names_unchanged PASSED [ 72%]
2025-10-08T16:24:27.3437547Z tests/test_field_consistency.py::TestDatabaseSchemaImmutability::test_user_table_columns_unchanged PASSED [ 81%]
2025-10-08T16:24:27.6366939Z tests/test_field_consistency.py::TestDatabaseSchemaImmutability::test_post_table_columns_unchanged PASSED [ 90%]
2025-10-08T16:24:28.4370921Z tests/test_field_consistency.py::TestDatabaseSchemaImmutability::test_community_table_columns_unchanged PASSED [100%]
2025-10-08T16:24:28.4371895Z 
2025-10-08T16:24:28.4372135Z =============================== warnings summary ===============================
2025-10-08T16:24:28.4373030Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32
2025-10-08T16:24:28.4374811Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:28.4376290Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:28.4376605Z 
2025-10-08T16:24:28.4377065Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36
2025-10-08T16:24:28.4378758Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:28.4380548Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:28.4380879Z 
2025-10-08T16:24:28.4381317Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952
2025-10-08T16:24:28.4382743Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:28.4384063Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:28.4384559Z 
2025-10-08T16:24:28.4385002Z ../../../../../opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952
2025-10-08T16:24:28.4386767Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:28.4388101Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:28.4388583Z 
2025-10-08T16:24:28.4388891Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:28.4389668Z ======================== 11 passed, 4 warnings in 5.20s ========================
2025-10-08T16:24:29.0818382Z ============================= test session starts ==============================
2025-10-08T16:24:29.0819015Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:29.0819717Z cachedir: .pytest_cache
2025-10-08T16:24:29.0820002Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:29.0820305Z plugins: anyio-4.11.0
2025-10-08T16:24:29.1191540Z collecting ... collected 16 items
2025-10-08T16:24:29.1191796Z 
2025-10-08T16:24:30.1280675Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_client_identifier_fallback_to_ip PASSED [  6%]
2025-10-08T16:24:30.1290350Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_client_identifier_generation PASSED [ 12%]
2025-10-08T16:24:30.2610436Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_fallback_rate_limiting FAILED [ 18%]
2025-10-08T16:24:30.2618505Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_get_rate_limit_key_generation PASSED [ 25%]
2025-10-08T16:24:30.2626337Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_parse_rate_limit_formats PASSED [ 31%]
2025-10-08T16:24:30.2641169Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_redis_rate_limiting_allowed PASSED [ 37%]
2025-10-08T16:24:30.2654611Z tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_redis_rate_limiting_exceeded PASSED [ 43%]
2025-10-08T16:24:30.2664640Z tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_fallback_without_redis PASSED [ 50%]
2025-10-08T16:24:30.2672656Z tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_get_performance_stats PASSED [ 56%]
2025-10-08T16:24:30.2968315Z tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_get_redis_key_caching FAILED [ 62%]
2025-10-08T16:24:30.2975921Z tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_record_request_basic PASSED [ 68%]
2025-10-08T16:24:30.4333251Z tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_redis_metrics_storage FAILED [ 75%]
2025-10-08T16:24:30.5258846Z tests/test_monitoring_simple.py::TestMonitoringDecorators::test_check_advanced_rate_limit_allowed FAILED [ 81%]
2025-10-08T16:24:30.6183808Z tests/test_monitoring_simple.py::TestMonitoringDecorators::test_check_advanced_rate_limit_exceeded FAILED [ 87%]
2025-10-08T16:24:30.6772527Z tests/test_monitoring_simple.py::TestMonitoringDecorators::test_track_admin_request_decorator FAILED [ 93%]
2025-10-08T16:24:30.6794157Z tests/test_monitoring_simple.py::TestIntegration::test_monitoring_system_initialization PASSED [100%]
2025-10-08T16:24:30.6794938Z 
2025-10-08T16:24:30.6795142Z =================================== FAILURES ===================================
2025-10-08T16:24:30.6795897Z _____________ TestAdvancedRateLimiter.test_fallback_rate_limiting ______________
2025-10-08T16:24:30.6796468Z 
2025-10-08T16:24:30.6797047Z self = <tests.test_monitoring_simple.TestAdvancedRateLimiter testMethod=test_fallback_rate_limiting>
2025-10-08T16:24:30.6797755Z 
2025-10-08T16:24:30.6797948Z     def test_fallback_rate_limiting(self):
2025-10-08T16:24:30.6798477Z         """Test fallback rate limiting without Redis"""
2025-10-08T16:24:30.6799405Z         from app.api.admin.monitoring import AdvancedRateLimiter
2025-10-08T16:24:30.6799956Z     
2025-10-08T16:24:30.6800285Z         limiter = AdvancedRateLimiter()
2025-10-08T16:24:30.6800712Z     
2025-10-08T16:24:30.6801041Z         # Mock g object for in-memory cache
2025-10-08T16:24:30.6801858Z >       with patch('app.api.admin.monitoring.g') as mock_g:
2025-10-08T16:24:30.6802421Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6802735Z 
2025-10-08T16:24:30.6802922Z tests/test_monitoring_simple.py:55: 
2025-10-08T16:24:30.6803429Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6804238Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:30.6805006Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:30.6805718Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6806363Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:30.6807083Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:30.6807439Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6808091Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:30.6808818Z     obj = instance._get_current_object()
2025-10-08T16:24:30.6809397Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6809798Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6810105Z 
2025-10-08T16:24:30.6810241Z     def _get_current_object() -> T:
2025-10-08T16:24:30.6810586Z         try:
2025-10-08T16:24:30.6810859Z             obj = local.get()
2025-10-08T16:24:30.6811194Z         except LookupError:
2025-10-08T16:24:30.6811574Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:30.6812099Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:30.6812534Z E           
2025-10-08T16:24:30.6812971Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.6813680Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:30.6814327Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.6814708Z 
2025-10-08T16:24:30.6815153Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:30.6816024Z ________________ TestAdminAPIMonitor.test_get_redis_key_caching ________________
2025-10-08T16:24:30.6816456Z 
2025-10-08T16:24:30.6816863Z args = (<app.api.admin.monitoring.AdminAPIMonitor object at 0x7f29d8b4b5c0>, 'request', 'test_id')
2025-10-08T16:24:30.6817512Z kwargs = {}
2025-10-08T16:24:30.6817662Z 
2025-10-08T16:24:30.6817794Z     @functools.wraps(f)
2025-10-08T16:24:30.6818135Z     def decorated_function(*args, **kwargs):
2025-10-08T16:24:30.6818519Z         #: bypass cache
2025-10-08T16:24:30.6818859Z         if self._bypass_cache(unless, f, *args, **kwargs):
2025-10-08T16:24:30.6819454Z             return self._call_fn(f, *args, **kwargs)
2025-10-08T16:24:30.6819826Z     
2025-10-08T16:24:30.6820083Z         nonlocal source_check
2025-10-08T16:24:30.6820422Z         if source_check is None:
2025-10-08T16:24:30.6820789Z             source_check = self.source_check
2025-10-08T16:24:30.6821141Z     
2025-10-08T16:24:30.6821372Z         try:
2025-10-08T16:24:30.6821763Z >           cache_key = decorated_function.make_cache_key(f, *args, **kwargs)
2025-10-08T16:24:30.6822280Z                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6822553Z 
2025-10-08T16:24:30.6822993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:861: 
2025-10-08T16:24:30.6823736Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6824538Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:618: in make_cache_key
2025-10-08T16:24:30.6825331Z     fname, version_data = self._memoize_version(
2025-10-08T16:24:30.6826155Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:568: in _memoize_version
2025-10-08T16:24:30.6827206Z     version_data_list = list(self.cache.get_many(*fetch_keys))
2025-10-08T16:24:30.6827697Z                              ^^^^^^^^^^
2025-10-08T16:24:30.6828101Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6828405Z 
2025-10-08T16:24:30.6828588Z self = <flask_caching.Cache object at 0x7f29d3b523c0>
2025-10-08T16:24:30.6828918Z 
2025-10-08T16:24:30.6829234Z     @property
2025-10-08T16:24:30.6829539Z     def cache(self) -> SimpleCache:
2025-10-08T16:24:30.6829916Z >       app = current_app or self.app
2025-10-08T16:24:30.6830457Z                              ^^^^^^^^
2025-10-08T16:24:30.6830892Z E       AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:30.6831223Z 
2025-10-08T16:24:30.6831754Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:190: AttributeError
2025-10-08T16:24:30.6832403Z 
2025-10-08T16:24:30.6832659Z During handling of the above exception, another exception occurred:
2025-10-08T16:24:30.6833054Z 
2025-10-08T16:24:30.6833456Z self = <tests.test_monitoring_simple.TestAdminAPIMonitor testMethod=test_get_redis_key_caching>
2025-10-08T16:24:30.6833998Z 
2025-10-08T16:24:30.6834132Z     def test_get_redis_key_caching(self):
2025-10-08T16:24:30.6834543Z         """Test Redis key generation and caching"""
2025-10-08T16:24:30.6835013Z         from app.api.admin.monitoring import AdminAPIMonitor
2025-10-08T16:24:30.6835431Z     
2025-10-08T16:24:30.6835687Z         monitor = AdminAPIMonitor()
2025-10-08T16:24:30.6836017Z     
2025-10-08T16:24:30.6836288Z         # Should generate consistent keys
2025-10-08T16:24:30.6836739Z >       key1 = monitor.get_redis_key('request', 'test_id')
2025-10-08T16:24:30.6837164Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6837426Z 
2025-10-08T16:24:30.6837574Z tests/test_monitoring_simple.py:223: 
2025-10-08T16:24:30.6837998Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6838299Z 
2025-10-08T16:24:30.6838726Z args = (<app.api.admin.monitoring.AdminAPIMonitor object at 0x7f29d8b4b5c0>, 'request', 'test_id')
2025-10-08T16:24:30.6839610Z kwargs = {}
2025-10-08T16:24:30.6839763Z 
2025-10-08T16:24:30.6839881Z     @functools.wraps(f)
2025-10-08T16:24:30.6840212Z     def decorated_function(*args, **kwargs):
2025-10-08T16:24:30.6840595Z         #: bypass cache
2025-10-08T16:24:30.6840944Z         if self._bypass_cache(unless, f, *args, **kwargs):
2025-10-08T16:24:30.6841387Z             return self._call_fn(f, *args, **kwargs)
2025-10-08T16:24:30.6841765Z     
2025-10-08T16:24:30.6842005Z         nonlocal source_check
2025-10-08T16:24:30.6842347Z         if source_check is None:
2025-10-08T16:24:30.6842701Z             source_check = self.source_check
2025-10-08T16:24:30.6843062Z     
2025-10-08T16:24:30.6843293Z         try:
2025-10-08T16:24:30.6843675Z             cache_key = decorated_function.make_cache_key(f, *args, **kwargs)
2025-10-08T16:24:30.6844168Z     
2025-10-08T16:24:30.6844409Z             if (
2025-10-08T16:24:30.6844699Z                 callable(forced_update)
2025-10-08T16:24:30.6845056Z                 and (
2025-10-08T16:24:30.6845366Z                     forced_update(*args, **kwargs)
2025-10-08T16:24:30.6845766Z                     if wants_args(forced_update)
2025-10-08T16:24:30.6846191Z                     else forced_update()
2025-10-08T16:24:30.6846538Z                 )
2025-10-08T16:24:30.6846798Z                 is True
2025-10-08T16:24:30.6847072Z             ):
2025-10-08T16:24:30.6847337Z                 rv = None
2025-10-08T16:24:30.6847636Z                 found = False
2025-10-08T16:24:30.6847948Z             else:
2025-10-08T16:24:30.6848235Z                 rv = self.cache.get(cache_key)
2025-10-08T16:24:30.6848607Z                 found = True
2025-10-08T16:24:30.6848917Z     
2025-10-08T16:24:30.6849368Z                 # If the value returned by cache.get() is None, it
2025-10-08T16:24:30.6849858Z                 # might be because the key is not found in the cache
2025-10-08T16:24:30.6850502Z                 # or because the cached value is actually None
2025-10-08T16:24:30.6850954Z                 if rv is None:
2025-10-08T16:24:30.6851334Z                     # If we're sure we don't need to cache None values
2025-10-08T16:24:30.6851813Z                     # (cache_none=False), don't bother checking for
2025-10-08T16:24:30.6852306Z                     # key existence, as it can lead to false positives
2025-10-08T16:24:30.6852775Z                     # if a concurrent call already cached the
2025-10-08T16:24:30.6853396Z                     # key between steps. This would cause us to
2025-10-08T16:24:30.6853822Z                     # return None when we shouldn't
2025-10-08T16:24:30.6854209Z                     if not cache_none:
2025-10-08T16:24:30.6854554Z                         found = False
2025-10-08T16:24:30.6854894Z                     else:
2025-10-08T16:24:30.6855227Z                         found = self.cache.has(cache_key)
2025-10-08T16:24:30.6855620Z         except Exception:
2025-10-08T16:24:30.6855942Z >           if self.app.debug:
2025-10-08T16:24:30.6856267Z                ^^^^^^^^
2025-10-08T16:24:30.6856633Z E           AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:30.6856983Z 
2025-10-08T16:24:30.6857493Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:893: AttributeError
2025-10-08T16:24:30.6858410Z ________________ TestAdminAPIMonitor.test_redis_metrics_storage ________________
2025-10-08T16:24:30.6859317Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:30.6859948Z     with self.decoration_helper(patched,
2025-10-08T16:24:30.6860554Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:30.6861170Z     return next(self.gen)
2025-10-08T16:24:30.6861468Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:30.6862073Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:30.6862804Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:30.6863193Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6863784Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:30.6864397Z     result = _enter(cm)
2025-10-08T16:24:30.6864677Z              ^^^^^^^^^^
2025-10-08T16:24:30.6865203Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:30.6865891Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:30.6866318Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6866978Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:30.6867622Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:30.6868006Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6868660Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:30.6869505Z     obj = instance._get_current_object()
2025-10-08T16:24:30.6869862Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.6870260Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.6870567Z 
2025-10-08T16:24:30.6870702Z     def _get_current_object() -> T:
2025-10-08T16:24:30.6871040Z         try:
2025-10-08T16:24:30.6871304Z             obj = local.get()
2025-10-08T16:24:30.6871643Z         except LookupError:
2025-10-08T16:24:30.6872008Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:30.6872522Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:30.6872952Z E           
2025-10-08T16:24:30.6873360Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.6874070Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:30.6874913Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.6875310Z 
2025-10-08T16:24:30.8937024Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:30.8938430Z _______ TestMonitoringDecorators.test_check_advanced_rate_limit_allowed ________
2025-10-08T16:24:30.8939586Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:30.8940128Z     with self.decoration_helper(patched,
2025-10-08T16:24:30.8941022Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:30.8941523Z     return next(self.gen)
2025-10-08T16:24:30.8941789Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:30.8942284Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:30.8942870Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:30.8943197Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8943727Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:30.8944203Z     result = _enter(cm)
2025-10-08T16:24:30.8944406Z              ^^^^^^^^^^
2025-10-08T16:24:30.8944764Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:30.8945227Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:30.8945518Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8945993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:30.8946429Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:30.8946660Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8947100Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:30.8947589Z     obj = instance._get_current_object()
2025-10-08T16:24:30.8947843Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8948126Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.8948352Z 
2025-10-08T16:24:30.8948449Z     def _get_current_object() -> T:
2025-10-08T16:24:30.8948696Z         try:
2025-10-08T16:24:30.8948878Z             obj = local.get()
2025-10-08T16:24:30.8949262Z         except LookupError:
2025-10-08T16:24:30.8949546Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:30.8949901Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8950208Z E           
2025-10-08T16:24:30.8950510Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8950991Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:30.8951440Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8951710Z 
2025-10-08T16:24:30.8952026Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:30.8952652Z _______ TestMonitoringDecorators.test_check_advanced_rate_limit_exceeded _______
2025-10-08T16:24:30.8953209Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:30.8953651Z     with self.decoration_helper(patched,
2025-10-08T16:24:30.8954208Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:30.8954703Z     return next(self.gen)
2025-10-08T16:24:30.8955154Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:30.8955648Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:30.8956150Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:30.8956583Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8957112Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:30.8957594Z     result = _enter(cm)
2025-10-08T16:24:30.8958024Z              ^^^^^^^^^^
2025-10-08T16:24:30.8958497Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:30.8959174Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:30.8959609Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8960077Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:30.8960575Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:30.8961048Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8970582Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:30.8971202Z     obj = instance._get_current_object()
2025-10-08T16:24:30.8971464Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8971745Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.8971950Z 
2025-10-08T16:24:30.8972066Z     def _get_current_object() -> T:
2025-10-08T16:24:30.8972305Z         try:
2025-10-08T16:24:30.8972500Z             obj = local.get()
2025-10-08T16:24:30.8972738Z         except LookupError:
2025-10-08T16:24:30.8973001Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:30.8973345Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8973641Z E           
2025-10-08T16:24:30.8973933Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8974394Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:30.8974828Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8975077Z 
2025-10-08T16:24:30.8975385Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:30.8975969Z _________ TestMonitoringDecorators.test_track_admin_request_decorator __________
2025-10-08T16:24:30.8976266Z 
2025-10-08T16:24:30.8976569Z self = <tests.test_monitoring_simple.TestMonitoringDecorators testMethod=test_track_admin_request_decorator>
2025-10-08T16:24:30.8976959Z 
2025-10-08T16:24:30.8977073Z     def test_track_admin_request_decorator(self):
2025-10-08T16:24:30.8977363Z         """Test request tracking decorator"""
2025-10-08T16:24:30.8977720Z         from app.api.admin.monitoring import track_admin_request, admin_monitor
2025-10-08T16:24:30.8978056Z     
2025-10-08T16:24:30.8978243Z         # Create a mock function
2025-10-08T16:24:30.8978513Z         @track_admin_request('test_endpoint', 'POST')
2025-10-08T16:24:30.8978789Z         def mock_endpoint():
2025-10-08T16:24:30.8979239Z             time.sleep(0.01)  # Small delay for timing
2025-10-08T16:24:30.8979584Z             return {'success': True}, 201
2025-10-08T16:24:30.8979813Z     
2025-10-08T16:24:30.8979988Z         # Mock request context
2025-10-08T16:24:30.8980304Z >       with patch('app.api.admin.monitoring.request') as mock_request:
2025-10-08T16:24:30.8980637Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8980811Z 
2025-10-08T16:24:30.8980913Z tests/test_monitoring_simple.py:245: 
2025-10-08T16:24:30.8981202Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.8981644Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:30.8982077Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:30.8982361Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8982772Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:30.8983189Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:30.8983420Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8983843Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:30.8984304Z     obj = instance._get_current_object()
2025-10-08T16:24:30.8984727Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:30.8985006Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:30.8985207Z 
2025-10-08T16:24:30.8985306Z     def _get_current_object() -> T:
2025-10-08T16:24:30.8985535Z         try:
2025-10-08T16:24:30.8985721Z             obj = local.get()
2025-10-08T16:24:30.8985953Z         except LookupError:
2025-10-08T16:24:30.8986210Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:30.8986655Z E           RuntimeError: Working outside of request context.
2025-10-08T16:24:30.8986938Z E           
2025-10-08T16:24:30.8987238Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8987667Z E           an active HTTP request. Consult the documentation on testing for
2025-10-08T16:24:30.8988031Z E           information about how to avoid this problem.
2025-10-08T16:24:30.8988227Z 
2025-10-08T16:24:30.8988540Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:30.8989157Z =========================== short test summary info ============================
2025-10-08T16:24:30.8989817Z FAILED tests/test_monitoring_simple.py::TestAdvancedRateLimiter::test_fallback_rate_limiting - RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8990339Z 
2025-10-08T16:24:30.8990523Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8990970Z the current application. To solve this, set up an application context
2025-10-08T16:24:30.8991387Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8992042Z FAILED tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_get_redis_key_caching - AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:30.8992930Z FAILED tests/test_monitoring_simple.py::TestAdminAPIMonitor::test_redis_metrics_storage - RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8993414Z 
2025-10-08T16:24:30.8993596Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8994029Z the current application. To solve this, set up an application context
2025-10-08T16:24:30.8994433Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8995137Z FAILED tests/test_monitoring_simple.py::TestMonitoringDecorators::test_check_advanced_rate_limit_allowed - RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8995685Z 
2025-10-08T16:24:30.8995868Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8996294Z the current application. To solve this, set up an application context
2025-10-08T16:24:30.8996709Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8997423Z FAILED tests/test_monitoring_simple.py::TestMonitoringDecorators::test_check_advanced_rate_limit_exceeded - RuntimeError: Working outside of application context.
2025-10-08T16:24:30.8997968Z 
2025-10-08T16:24:30.8998159Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.8998600Z the current application. To solve this, set up an application context
2025-10-08T16:24:30.8999006Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:30.8999784Z FAILED tests/test_monitoring_simple.py::TestMonitoringDecorators::test_track_admin_request_decorator - RuntimeError: Working outside of request context.
2025-10-08T16:24:30.9000309Z 
2025-10-08T16:24:30.9000495Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:30.9000910Z an active HTTP request. Consult the documentation on testing for
2025-10-08T16:24:30.9001261Z information about how to avoid this problem.
2025-10-08T16:24:30.9001596Z ========================= 6 failed, 10 passed in 1.61s =========================
2025-10-08T16:24:31.3020644Z ============================= test session starts ==============================
2025-10-08T16:24:31.3021357Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:31.3022089Z cachedir: .pytest_cache
2025-10-08T16:24:31.3022363Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:31.3022669Z plugins: anyio-4.11.0
2025-10-08T16:24:32.5355960Z collecting ... collected 9 items
2025-10-08T16:24:32.5356339Z 
2025-10-08T16:24:32.5373240Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_basic_dedupe PASSED [ 11%]
2025-10-08T16:24:32.5382954Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_empty_input PASSED [ 22%]
2025-10-08T16:24:32.5392740Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_low_value_reposter_cross_posts PASSED [ 33%]
2025-10-08T16:24:32.5401734Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_mixed_scenarios PASSED [ 44%]
2025-10-08T16:24:32.5410797Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_no_cross_posts_found PASSED [ 55%]
2025-10-08T16:24:32.5423928Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_performance_with_1000_posts PASSED [ 66%]
2025-10-08T16:24:32.5433863Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_priority_prevents_filtering PASSED [ 77%]
2025-10-08T16:24:32.5443007Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_regular_cross_posts PASSED [ 88%]
2025-10-08T16:24:32.8278397Z tests/test_dedupe_post_ids.py::TestDudupePostIds::test_worst_case_performance PASSED [100%]
2025-10-08T16:24:32.8278891Z 
2025-10-08T16:24:32.8279202Z ============================== 9 passed in 1.28s ===============================
2025-10-08T16:24:33.2891545Z ============================= test session starts ==============================
2025-10-08T16:24:33.2892555Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:33.2893430Z cachedir: .pytest_cache
2025-10-08T16:24:33.2893864Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:33.2894367Z plugins: anyio-4.11.0
2025-10-08T16:24:33.3386856Z collecting ... collected 3 items
2025-10-08T16:24:33.3387343Z 
2025-10-08T16:24:33.4600307Z tests/test_explore_template_render.py::test_explore_template_renders_with_empty_topics FAILED [ 33%]
2025-10-08T16:24:33.5598668Z tests/test_explore_template_render.py::test_explore_template_renders_with_topics FAILED [ 66%]
2025-10-08T16:24:33.5918213Z tests/test_explore_template_render.py::test_explore_template_length_filter_usage PASSED [100%]
2025-10-08T16:24:33.5918768Z 
2025-10-08T16:24:33.5918896Z =================================== FAILURES ===================================
2025-10-08T16:24:33.5919626Z _______________ test_explore_template_renders_with_empty_topics ________________
2025-10-08T16:24:33.5919915Z 
2025-10-08T16:24:33.5920060Z     def test_explore_template_renders_with_empty_topics():
2025-10-08T16:24:33.5920475Z         """Test that explore template renders when topics list is empty."""
2025-10-08T16:24:33.5920864Z         templates_dir = os.path.join(
2025-10-08T16:24:33.5921174Z             os.path.dirname(os.path.dirname(__file__)),
2025-10-08T16:24:33.5921471Z             'app', 'templates'
2025-10-08T16:24:33.5921700Z         )
2025-10-08T16:24:33.5921861Z     
2025-10-08T16:24:33.5922064Z         if not os.path.exists(templates_dir):
2025-10-08T16:24:33.5922382Z             pytest.skip("Templates directory not found")
2025-10-08T16:24:33.5922658Z     
2025-10-08T16:24:33.5922843Z         # Create Jinja2 environment
2025-10-08T16:24:33.5923172Z         env = Environment(loader=FileSystemLoader(templates_dir))
2025-10-08T16:24:33.5923478Z     
2025-10-08T16:24:33.5923683Z         # Mock the custom functions and filters
2025-10-08T16:24:33.5923974Z         def mock_theme():
2025-10-08T16:24:33.5924203Z             return 'piefed'
2025-10-08T16:24:33.5924428Z     
2025-10-08T16:24:33.5924627Z         def mock_file_exists(path):
2025-10-08T16:24:33.5924893Z             return False
2025-10-08T16:24:33.5925100Z     
2025-10-08T16:24:33.5925555Z         def mock_translate(text):
2025-10-08T16:24:33.5925832Z             return text
2025-10-08T16:24:33.5926039Z     
2025-10-08T16:24:33.5926247Z         # Add functions to globals (not filters)
2025-10-08T16:24:33.5926557Z         env.globals['theme'] = mock_theme
2025-10-08T16:24:33.5926872Z         env.globals['file_exists'] = mock_file_exists
2025-10-08T16:24:33.5927188Z         env.globals['_'] = mock_translate
2025-10-08T16:24:33.5927523Z         env.globals['current_user'] = type('MockUser', (), {
2025-10-08T16:24:33.5928002Z             'is_authenticated': False,
2025-10-08T16:24:33.5928284Z             'is_anonymous': True,
2025-10-08T16:24:33.5928549Z             'link': lambda: 'testuser'
2025-10-08T16:24:33.5928797Z         })()
2025-10-08T16:24:33.5928986Z     
2025-10-08T16:24:33.5929322Z         try:
2025-10-08T16:24:33.5929561Z             template = env.get_template('explore.html')
2025-10-08T16:24:33.5929848Z     
2025-10-08T16:24:33.5930044Z             # Test with empty topics
2025-10-08T16:24:33.5930324Z >           rendered = template.render(
2025-10-08T16:24:33.5930592Z                 topics=[],
2025-10-08T16:24:33.5930834Z                 menu_instance_feeds=[],
2025-10-08T16:24:33.5931110Z                 menu_my_feeds=None,
2025-10-08T16:24:33.5931373Z                 menu_subscribed_feeds=None
2025-10-08T16:24:33.5931645Z             )
2025-10-08T16:24:33.5931759Z 
2025-10-08T16:24:33.5931879Z tests/test_explore_template_render.py:49: 
2025-10-08T16:24:33.5932213Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:33.5932786Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/environment.py:1295: in render
2025-10-08T16:24:33.5933338Z     self.environment.handle_exception()
2025-10-08T16:24:33.5933909Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/environment.py:942: in handle_exception
2025-10-08T16:24:33.5934502Z     raise rewrite_traceback_stack(source=source)
2025-10-08T16:24:33.5934871Z app/templates/explore.html:6: in top-level template code
2025-10-08T16:24:33.5935238Z     {% from 'bootstrap5/form.html' import render_form -%}
2025-10-08T16:24:33.5935526Z     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:33.5935775Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:33.5935982Z 
2025-10-08T16:24:33.5936147Z self = <jinja2.loaders.FileSystemLoader object at 0x7f8e7d3e8830>
2025-10-08T16:24:33.5936590Z environment = <jinja2.environment.Environment object at 0x7f8e7d05d550>
2025-10-08T16:24:33.5936948Z template = 'bootstrap5/form.html'
2025-10-08T16:24:33.5937114Z 
2025-10-08T16:24:33.5937191Z     def get_source(
2025-10-08T16:24:33.5937430Z         self, environment: "Environment", template: str
2025-10-08T16:24:33.5937735Z     ) -> t.Tuple[str, str, t.Callable[[], bool]]:
2025-10-08T16:24:33.5938024Z         pieces = split_template_path(template)
2025-10-08T16:24:33.5938275Z     
2025-10-08T16:24:33.5938473Z         for searchpath in self.searchpath:
2025-10-08T16:24:33.5938782Z             # Use posixpath even on Windows to avoid "drive:" or UNC
2025-10-08T16:24:33.5939232Z             # segments breaking out of the search directory.
2025-10-08T16:24:33.5939559Z             filename = posixpath.join(searchpath, *pieces)
2025-10-08T16:24:33.5939828Z     
2025-10-08T16:24:33.5940004Z             if os.path.isfile(filename):
2025-10-08T16:24:33.5940246Z                 break
2025-10-08T16:24:33.5940436Z         else:
2025-10-08T16:24:33.5940675Z             plural = "path" if len(self.searchpath) == 1 else "paths"
2025-10-08T16:24:33.5941038Z             paths_str = ", ".join(repr(p) for p in self.searchpath)
2025-10-08T16:24:33.5941337Z >           raise TemplateNotFound(
2025-10-08T16:24:33.5941568Z                 template,
2025-10-08T16:24:33.5941830Z                 f"{template!r} not found in search {plural}: {paths_str}",
2025-10-08T16:24:33.5942121Z             )
2025-10-08T16:24:33.5942730Z E           jinja2.exceptions.TemplateNotFound: 'bootstrap5/form.html' not found in search path: '/home/runner/work/pyfedi/pyfedi/app/templates'
2025-10-08T16:24:33.5943201Z 
2025-10-08T16:24:33.5943524Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/loaders.py:209: TemplateNotFound
2025-10-08T16:24:33.5944082Z __________________ test_explore_template_renders_with_topics ___________________
2025-10-08T16:24:33.5944338Z 
2025-10-08T16:24:33.5944456Z     def test_explore_template_renders_with_topics():
2025-10-08T16:24:33.5944892Z         """Test that explore template renders when topics exist."""
2025-10-08T16:24:33.5945196Z         templates_dir = os.path.join(
2025-10-08T16:24:33.5945474Z             os.path.dirname(os.path.dirname(__file__)),
2025-10-08T16:24:33.5945749Z             'app', 'templates'
2025-10-08T16:24:33.5945960Z         )
2025-10-08T16:24:33.5946112Z     
2025-10-08T16:24:33.5946301Z         if not os.path.exists(templates_dir):
2025-10-08T16:24:33.5946601Z             pytest.skip("Templates directory not found")
2025-10-08T16:24:33.5946856Z     
2025-10-08T16:24:33.5947024Z         # Mock topic object
2025-10-08T16:24:33.5947239Z         class MockTopic:
2025-10-08T16:24:33.5947445Z             def __init__(self, name):
2025-10-08T16:24:33.5947683Z                 self.name = name
2025-10-08T16:24:33.5947894Z     
2025-10-08T16:24:33.5948054Z             def path(self):
2025-10-08T16:24:33.5948300Z                 return self.name.lower().replace(' ', '-')
2025-10-08T16:24:33.5948564Z     
2025-10-08T16:24:33.5948742Z         # Create mock topic tree structure
2025-10-08T16:24:33.5948989Z         mock_topics = [
2025-10-08T16:24:33.5949287Z             {
2025-10-08T16:24:33.5949482Z                 'topic': MockTopic('Technology'),
2025-10-08T16:24:33.5949737Z                 'children': [
2025-10-08T16:24:33.5949949Z                     {
2025-10-08T16:24:33.5950170Z                         'topic': MockTopic('Programming'),
2025-10-08T16:24:33.5950431Z                         'children': []
2025-10-08T16:24:33.5950663Z                     }
2025-10-08T16:24:33.5950844Z                 ]
2025-10-08T16:24:33.5951013Z             },
2025-10-08T16:24:33.5951184Z             {
2025-10-08T16:24:33.5951411Z                 'topic': MockTopic('Science'),
2025-10-08T16:24:33.5951666Z                 'children': []
2025-10-08T16:24:33.5951871Z             }
2025-10-08T16:24:33.5952038Z         ]
2025-10-08T16:24:33.5952192Z     
2025-10-08T16:24:33.5952367Z         # Create Jinja2 environment
2025-10-08T16:24:33.5952672Z         env = Environment(loader=FileSystemLoader(templates_dir))
2025-10-08T16:24:33.5952956Z     
2025-10-08T16:24:33.5953141Z         # Mock the custom functions and globals
2025-10-08T16:24:33.5953419Z         env.globals['theme'] = lambda: 'piefed'
2025-10-08T16:24:33.5953707Z         env.globals['file_exists'] = lambda path: False
2025-10-08T16:24:33.5953988Z         env.globals['_'] = lambda text: text
2025-10-08T16:24:33.5954287Z         env.globals['current_user'] = type('MockUser', (), {
2025-10-08T16:24:33.5954583Z             'is_authenticated': False,
2025-10-08T16:24:33.5954821Z             'is_anonymous': True,
2025-10-08T16:24:33.5955056Z             'link': lambda: 'testuser'
2025-10-08T16:24:33.5955283Z         })()
2025-10-08T16:24:33.5955445Z     
2025-10-08T16:24:33.5955606Z         try:
2025-10-08T16:24:33.5955817Z             template = env.get_template('explore.html')
2025-10-08T16:24:33.5956066Z     
2025-10-08T16:24:33.5956235Z             # Test with topics
2025-10-08T16:24:33.5956469Z >           rendered = template.render(
2025-10-08T16:24:33.5956717Z                 topics=mock_topics,
2025-10-08T16:24:33.5956948Z                 menu_instance_feeds=[],
2025-10-08T16:24:33.5957189Z                 menu_my_feeds=None,
2025-10-08T16:24:33.5957430Z                 menu_subscribed_feeds=None
2025-10-08T16:24:33.5957658Z             )
2025-10-08T16:24:33.5957765Z 
2025-10-08T16:24:33.5957869Z tests/test_explore_template_render.py:125: 
2025-10-08T16:24:33.5958353Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:33.5958863Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/environment.py:1295: in render
2025-10-08T16:24:33.5959600Z     self.environment.handle_exception()
2025-10-08T16:24:33.5960114Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/environment.py:942: in handle_exception
2025-10-08T16:24:33.5960633Z     raise rewrite_traceback_stack(source=source)
2025-10-08T16:24:33.5961115Z app/templates/explore.html:6: in top-level template code
2025-10-08T16:24:33.5961470Z     {% from 'bootstrap5/form.html' import render_form -%}
2025-10-08T16:24:33.5961753Z     ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:33.5961999Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:33.5962207Z 
2025-10-08T16:24:33.5962371Z self = <jinja2.loaders.FileSystemLoader object at 0x7f8e7d036850>
2025-10-08T16:24:33.5962810Z environment = <jinja2.environment.Environment object at 0x7f8e7d036d50>
2025-10-08T16:24:33.5963170Z template = 'bootstrap5/form.html'
2025-10-08T16:24:33.5963326Z 
2025-10-08T16:24:33.5963400Z     def get_source(
2025-10-08T16:24:33.5963637Z         self, environment: "Environment", template: str
2025-10-08T16:24:33.5963937Z     ) -> t.Tuple[str, str, t.Callable[[], bool]]:
2025-10-08T16:24:33.5964232Z         pieces = split_template_path(template)
2025-10-08T16:24:33.5964475Z     
2025-10-08T16:24:33.5964673Z         for searchpath in self.searchpath:
2025-10-08T16:24:33.5964986Z             # Use posixpath even on Windows to avoid "drive:" or UNC
2025-10-08T16:24:33.5965316Z             # segments breaking out of the search directory.
2025-10-08T16:24:33.5965638Z             filename = posixpath.join(searchpath, *pieces)
2025-10-08T16:24:33.5965912Z     
2025-10-08T16:24:33.5966092Z             if os.path.isfile(filename):
2025-10-08T16:24:33.5966338Z                 break
2025-10-08T16:24:33.5966525Z         else:
2025-10-08T16:24:33.5966772Z             plural = "path" if len(self.searchpath) == 1 else "paths"
2025-10-08T16:24:33.5967132Z             paths_str = ", ".join(repr(p) for p in self.searchpath)
2025-10-08T16:24:33.5967435Z >           raise TemplateNotFound(
2025-10-08T16:24:33.5967668Z                 template,
2025-10-08T16:24:33.5967932Z                 f"{template!r} not found in search {plural}: {paths_str}",
2025-10-08T16:24:33.5968221Z             )
2025-10-08T16:24:33.5968713Z E           jinja2.exceptions.TemplateNotFound: 'bootstrap5/form.html' not found in search path: '/home/runner/work/pyfedi/pyfedi/app/templates'
2025-10-08T16:24:33.5969323Z 
2025-10-08T16:24:33.5969634Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/jinja2/loaders.py:209: TemplateNotFound
2025-10-08T16:24:33.5970156Z =========================== short test summary info ============================
2025-10-08T16:24:33.5971041Z FAILED tests/test_explore_template_render.py::test_explore_template_renders_with_empty_topics - jinja2.exceptions.TemplateNotFound: 'bootstrap5/form.html' not found in search path: '/home/runner/work/pyfedi/pyfedi/app/templates'
2025-10-08T16:24:33.5972436Z FAILED tests/test_explore_template_render.py::test_explore_template_renders_with_topics - jinja2.exceptions.TemplateNotFound: 'bootstrap5/form.html' not found in search path: '/home/runner/work/pyfedi/pyfedi/app/templates'
2025-10-08T16:24:33.5973273Z ========================= 2 failed, 1 passed in 0.28s ==========================
2025-10-08T16:24:33.8344632Z ============================= test session starts ==============================
2025-10-08T16:24:33.8345614Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:33.8346461Z cachedir: .pytest_cache
2025-10-08T16:24:33.8346897Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:33.8347379Z plugins: anyio-4.11.0
2025-10-08T16:24:34.8904589Z collecting ... collected 1 item
2025-10-08T16:24:34.8904867Z 
2025-10-08T16:24:36.4397021Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions FAILED [100%]
2025-10-08T16:24:36.4397644Z 
2025-10-08T16:24:36.4397778Z =================================== FAILURES ===================================
2025-10-08T16:24:36.4398427Z _______________________ test_api_community_subscriptions _______________________
2025-10-08T16:24:36.4398787Z 
2025-10-08T16:24:36.4398990Z self = <sqlalchemy.engine.base.Connection object at 0x7fdae06dfa80>
2025-10-08T16:24:36.4400216Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdae9e842f0>
2025-10-08T16:24:36.4400945Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdae0124e10>
2025-10-08T16:24:36.4401613Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7fdae0739400>
2025-10-08T16:24:36.4402076Z parameters = [(1,)]
2025-10-08T16:24:36.4402217Z 
2025-10-08T16:24:36.4402313Z     def _exec_single_context(
2025-10-08T16:24:36.4402560Z         self,
2025-10-08T16:24:36.4402773Z         dialect: Dialect,
2025-10-08T16:24:36.4403019Z         context: ExecutionContext,
2025-10-08T16:24:36.4403308Z         statement: Union[str, Compiled],
2025-10-08T16:24:36.4403631Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:24:36.4403954Z     ) -> CursorResult[Any]:
2025-10-08T16:24:36.4404275Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:24:36.4404666Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:24:36.4405025Z     
2025-10-08T16:24:36.4405197Z         """
2025-10-08T16:24:36.4405453Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:24:36.4405873Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:24:36.4406215Z     
2025-10-08T16:24:36.4406418Z             if generic_setinputsizes:
2025-10-08T16:24:36.4406692Z                 try:
2025-10-08T16:24:36.4406937Z                     dialect.do_set_input_sizes(
2025-10-08T16:24:36.4407284Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:24:36.4407603Z                     )
2025-10-08T16:24:36.4407839Z                 except BaseException as e:
2025-10-08T16:24:36.4408125Z                     self._handle_dbapi_exception(
2025-10-08T16:24:36.4408434Z                         e, str(statement), parameters, None, context
2025-10-08T16:24:36.4408716Z                     )
2025-10-08T16:24:36.4408893Z     
2025-10-08T16:24:36.4409238Z         cursor, str_statement, parameters = (
2025-10-08T16:24:36.4409501Z             context.cursor,
2025-10-08T16:24:36.4409728Z             context.statement,
2025-10-08T16:24:36.4409950Z             context.parameters,
2025-10-08T16:24:36.4410164Z         )
2025-10-08T16:24:36.4410324Z     
2025-10-08T16:24:36.4410536Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:24:36.4410816Z     
2025-10-08T16:24:36.4410986Z         if not context.executemany:
2025-10-08T16:24:36.4411253Z             effective_parameters = parameters[0]
2025-10-08T16:24:36.4411504Z         else:
2025-10-08T16:24:36.4411697Z             effective_parameters = parameters
2025-10-08T16:24:36.4411938Z     
2025-10-08T16:24:36.4412142Z         if self._has_events or self.engine._has_events:
2025-10-08T16:24:36.4412452Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:24:36.4412763Z                 str_statement, effective_parameters = fn(
2025-10-08T16:24:36.4413026Z                     self,
2025-10-08T16:24:36.4413227Z                     cursor,
2025-10-08T16:24:36.4413431Z                     str_statement,
2025-10-08T16:24:36.4413679Z                     effective_parameters,
2025-10-08T16:24:36.4413924Z                     context,
2025-10-08T16:24:36.4414148Z                     context.executemany,
2025-10-08T16:24:36.4414375Z                 )
2025-10-08T16:24:36.4414551Z     
2025-10-08T16:24:36.4414716Z         if self._echo:
2025-10-08T16:24:36.4414920Z             self._log_info(str_statement)
2025-10-08T16:24:36.4415280Z     
2025-10-08T16:24:36.4415473Z             stats = context._get_cache_stats()
2025-10-08T16:24:36.4415707Z     
2025-10-08T16:24:36.4415897Z             if not self.engine.hide_parameters:
2025-10-08T16:24:36.4416153Z                 self._log_info(
2025-10-08T16:24:36.4416360Z                     "[%s] %r",
2025-10-08T16:24:36.4416567Z                     stats,
2025-10-08T16:24:36.4416779Z                     sql_util._repr_params(
2025-10-08T16:24:36.4417144Z                         effective_parameters,
2025-10-08T16:24:36.4417384Z                         batches=10,
2025-10-08T16:24:36.4417631Z                         ismulti=context.executemany,
2025-10-08T16:24:36.4417883Z                     ),
2025-10-08T16:24:36.4418062Z                 )
2025-10-08T16:24:36.4418238Z             else:
2025-10-08T16:24:36.4418418Z                 self._log_info(
2025-10-08T16:24:36.4418690Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:24:36.4418995Z                     stats,
2025-10-08T16:24:36.4419288Z                 )
2025-10-08T16:24:36.4419454Z     
2025-10-08T16:24:36.4419624Z         evt_handled: bool = False
2025-10-08T16:24:36.4419844Z         try:
2025-10-08T16:24:36.4420080Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:24:36.4420400Z                 effective_parameters = cast(
2025-10-08T16:24:36.4420705Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:24:36.4420988Z                 )
2025-10-08T16:24:36.4421180Z                 if self.dialect._has_events:
2025-10-08T16:24:36.4421475Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:24:36.4421758Z                         if fn(
2025-10-08T16:24:36.4421969Z                             cursor,
2025-10-08T16:24:36.4422200Z                             str_statement,
2025-10-08T16:24:36.4422455Z                             effective_parameters,
2025-10-08T16:24:36.4422709Z                             context,
2025-10-08T16:24:36.4422925Z                         ):
2025-10-08T16:24:36.4423141Z                             evt_handled = True
2025-10-08T16:24:36.4423386Z                             break
2025-10-08T16:24:36.4423601Z                 if not evt_handled:
2025-10-08T16:24:36.4423848Z                     self.dialect.do_executemany(
2025-10-08T16:24:36.4424097Z                         cursor,
2025-10-08T16:24:36.4424305Z                         str_statement,
2025-10-08T16:24:36.4424559Z                         effective_parameters,
2025-10-08T16:24:36.4424802Z                         context,
2025-10-08T16:24:36.4425006Z                     )
2025-10-08T16:24:36.4425262Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:24:36.4425576Z                 if self.dialect._has_events:
2025-10-08T16:24:36.4425877Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:24:36.4426201Z                         if fn(cursor, str_statement, context):
2025-10-08T16:24:36.4426477Z                             evt_handled = True
2025-10-08T16:24:36.4426716Z                             break
2025-10-08T16:24:36.4426931Z                 if not evt_handled:
2025-10-08T16:24:36.4427185Z                     self.dialect.do_execute_no_params(
2025-10-08T16:24:36.4427459Z                         cursor, str_statement, context
2025-10-08T16:24:36.4427701Z                     )
2025-10-08T16:24:36.4427880Z             else:
2025-10-08T16:24:36.4428083Z                 effective_parameters = cast(
2025-10-08T16:24:36.4428375Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:24:36.4428643Z                 )
2025-10-08T16:24:36.4428837Z                 if self.dialect._has_events:
2025-10-08T16:24:36.4429272Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:24:36.4429628Z                         if fn(
2025-10-08T16:24:36.4429846Z                             cursor,
2025-10-08T16:24:36.4430206Z                             str_statement,
2025-10-08T16:24:36.4430464Z                             effective_parameters,
2025-10-08T16:24:36.4430716Z                             context,
2025-10-08T16:24:36.4430937Z                         ):
2025-10-08T16:24:36.4431151Z                             evt_handled = True
2025-10-08T16:24:36.4431391Z                             break
2025-10-08T16:24:36.4431616Z                 if not evt_handled:
2025-10-08T16:24:36.4431958Z >                   self.dialect.do_execute(
2025-10-08T16:24:36.4432253Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:24:36.4432544Z                     )
2025-10-08T16:24:36.4432659Z 
2025-10-08T16:24:36.4432957Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:24:36.4433446Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:36.4433646Z 
2025-10-08T16:24:36.4433916Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdae9e842f0>
2025-10-08T16:24:36.4434380Z cursor = <sqlite3.Cursor object at 0x7fdae01198c0>
2025-10-08T16:24:36.4435196Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:36.4435968Z parameters = (1,)
2025-10-08T16:24:36.4436346Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdae0124e10>
2025-10-08T16:24:36.4436708Z 
2025-10-08T16:24:36.4436872Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:36.4437224Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:36.4437520Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:24:36.4437728Z 
2025-10-08T16:24:36.4438081Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:36.4438524Z 
2025-10-08T16:24:36.4438698Z The above exception was the direct cause of the following exception:
2025-10-08T16:24:36.4438949Z 
2025-10-08T16:24:36.4439177Z app = <Flask 'app'>
2025-10-08T16:24:36.4439356Z 
2025-10-08T16:24:36.4439525Z     def test_api_community_subscriptions(app):
2025-10-08T16:24:36.4439796Z         with app.app_context():
2025-10-08T16:24:36.4440120Z             from app.api.alpha.utils.community import put_community_subscribe
2025-10-08T16:24:36.4440451Z     
2025-10-08T16:24:36.4440614Z             user_id = 1
2025-10-08T16:24:36.4440832Z >           user = User.query.get(user_id)
2025-10-08T16:24:36.4441077Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:36.4441230Z 
2025-10-08T16:24:36.4441343Z tests/test_api_community_subscriptions.py:29: 
2025-10-08T16:24:36.4441646Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:36.4441955Z <string>:2: in get
2025-10-08T16:24:36.4442133Z     ???
2025-10-08T16:24:36.4442550Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:24:36.4443107Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:24:36.4443399Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:36.4443823Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:24:36.4444339Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:24:36.4444657Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:36.4445135Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:24:36.4445612Z     return self.session._get_impl(
2025-10-08T16:24:36.4446076Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:24:36.4446672Z     return db_load_fn(
2025-10-08T16:24:36.4447143Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:24:36.4447648Z     session.execute(
2025-10-08T16:24:36.4448069Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:24:36.4448543Z     return self._execute_internal(
2025-10-08T16:24:36.4449166Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:24:36.4449899Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:24:36.4450491Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:24:36.4451008Z     result = conn.execute(
2025-10-08T16:24:36.4451452Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:24:36.4451911Z     return meth(
2025-10-08T16:24:36.4452381Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:24:36.4452924Z     return connection._execute_clauseelement(
2025-10-08T16:24:36.4453473Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:24:36.4453997Z     ret = self._execute_context(
2025-10-08T16:24:36.4454492Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:24:36.4454998Z     return self._exec_single_context(
2025-10-08T16:24:36.4455518Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:24:36.4456041Z     self._handle_dbapi_exception(
2025-10-08T16:24:36.4456563Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:24:36.4457156Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:24:36.4457740Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:24:36.4458263Z     self.dialect.do_execute(
2025-10-08T16:24:36.4458522Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:36.4458733Z 
2025-10-08T16:24:36.4458998Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdae9e842f0>
2025-10-08T16:24:36.4459580Z cursor = <sqlite3.Cursor object at 0x7fdae01198c0>
2025-10-08T16:24:36.4460393Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:36.4461152Z parameters = (1,)
2025-10-08T16:24:36.4461534Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdae0124e10>
2025-10-08T16:24:36.4461879Z 
2025-10-08T16:24:36.4462048Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:36.4462392Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:36.4462794Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:36.4477916Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:36.4493575Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:36.4494241Z E       WHERE user.id = ?]
2025-10-08T16:24:36.4494459Z E       [parameters: (1,)]
2025-10-08T16:24:36.4494766Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:36.4495009Z 
2025-10-08T16:24:36.4495364Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:36.4495955Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:24:36.4496307Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:36.4496638Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:36.4497037Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:36.4497392Z =============================== warnings summary ===============================
2025-10-08T16:24:36.4497806Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions
2025-10-08T16:24:36.4498796Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:36.4499791Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:36.4500001Z 
2025-10-08T16:24:36.4500200Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions
2025-10-08T16:24:36.4501165Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:36.9667669Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:36.9668198Z 
2025-10-08T16:24:36.9668667Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions
2025-10-08T16:24:36.9670396Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:36.9671618Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:36.9672071Z 
2025-10-08T16:24:36.9672367Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions
2025-10-08T16:24:36.9673562Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:36.9674791Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:36.9675244Z 
2025-10-08T16:24:36.9675531Z tests/test_api_community_subscriptions.py::test_api_community_subscriptions
2025-10-08T16:24:36.9677617Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_community_subscriptions.py:29: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:24:36.9678964Z     user = User.query.get(user_id)
2025-10-08T16:24:36.9679331Z 
2025-10-08T16:24:36.9679538Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:36.9679982Z =========================== short test summary info ============================
2025-10-08T16:24:36.9680950Z FAILED tests/test_api_community_subscriptions.py::test_api_community_subscriptions - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:36.9697306Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:36.9712891Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:36.9713548Z WHERE user.id = ?]
2025-10-08T16:24:36.9713746Z [parameters: (1,)]
2025-10-08T16:24:36.9714015Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:36.9714414Z ======================== 1 failed, 5 warnings in 2.61s =========================
2025-10-08T16:24:37.7108012Z ============================= test session starts ==============================
2025-10-08T16:24:37.7109002Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:37.7110136Z cachedir: .pytest_cache
2025-10-08T16:24:37.7110579Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:37.7111029Z plugins: anyio-4.11.0
2025-10-08T16:24:37.7502237Z collecting ... collected 15 items
2025-10-08T16:24:37.7502607Z 
2025-10-08T16:24:39.1272393Z tests/test_user_management_simple.py::TestUserManagementLogic::test_ban_already_banned_user FAILED [  6%]
2025-10-08T16:24:39.1292960Z tests/test_user_management_simple.py::TestUserManagementLogic::test_ban_user_success PASSED [ 13%]
2025-10-08T16:24:39.1302395Z tests/test_user_management_simple.py::TestUserManagementLogic::test_bulk_operations_basic PASSED [ 20%]
2025-10-08T16:24:39.1311745Z tests/test_user_management_simple.py::TestUserManagementLogic::test_bulk_operations_partial_failure PASSED [ 26%]
2025-10-08T16:24:39.1318384Z tests/test_user_management_simple.py::TestUserManagementLogic::test_bulk_operations_too_many_users PASSED [ 33%]
2025-10-08T16:24:39.2327578Z tests/test_user_management_simple.py::TestUserManagementLogic::test_disable_user_success FAILED [ 40%]
2025-10-08T16:24:39.3265640Z tests/test_user_management_simple.py::TestUserManagementLogic::test_soft_delete_user FAILED [ 46%]
2025-10-08T16:24:39.3290127Z tests/test_user_management_simple.py::TestUserManagementLogic::test_update_user_email_conflict PASSED [ 53%]
2025-10-08T16:24:39.3305272Z tests/test_user_management_simple.py::TestUserManagementLogic::test_update_user_not_found PASSED [ 60%]
2025-10-08T16:24:39.4240985Z tests/test_user_management_simple.py::TestUserManagementLogic::test_update_user_success FAILED [ 66%]
2025-10-08T16:24:39.4757378Z tests/test_user_management_simple.py::TestUserStatistics::test_export_user_data_basic FAILED [ 73%]
2025-10-08T16:24:39.4864794Z tests/test_user_management_simple.py::TestUserStatistics::test_get_registration_statistics FAILED [ 80%]
2025-10-08T16:24:39.4980213Z tests/test_user_management_simple.py::TestUserStatistics::test_get_user_statistics FAILED [ 86%]
2025-10-08T16:24:39.4990192Z tests/test_user_management_simple.py::TestInputValidation::test_bulk_operation_validation PASSED [ 93%]
2025-10-08T16:24:39.5362466Z tests/test_user_management_simple.py::TestInputValidation::test_unknown_action_validation FAILED [100%]
2025-10-08T16:24:39.5363398Z 
2025-10-08T16:24:39.5363663Z =================================== FAILURES ===================================
2025-10-08T16:24:39.5364310Z _____________ TestUserManagementLogic.test_ban_already_banned_user _____________
2025-10-08T16:24:39.5364699Z 
2025-10-08T16:24:39.5365099Z self = <tests.test_user_management_simple.TestUserManagementLogic testMethod=test_ban_already_banned_user>
2025-10-08T16:24:39.5365675Z mock_user_class = <MagicMock name='User' id='140657531664240'>
2025-10-08T16:24:39.5365910Z 
2025-10-08T16:24:39.5366046Z     @patch('app.api.admin.user_management.User')
2025-10-08T16:24:39.5366413Z     def test_ban_already_banned_user(self, mock_user_class):
2025-10-08T16:24:39.5366775Z         """Test banning already banned user"""
2025-10-08T16:24:39.5367130Z         from app.api.admin.user_management import perform_user_action
2025-10-08T16:24:39.5367455Z     
2025-10-08T16:24:39.5367633Z         # Mock already banned user
2025-10-08T16:24:39.5367882Z         mock_user = MagicMock()
2025-10-08T16:24:39.5368114Z         mock_user.id = 123
2025-10-08T16:24:39.5368336Z         mock_user.banned = True
2025-10-08T16:24:39.5368698Z         mock_user_class.query.filter_by.return_value.first.return_value = mock_user
2025-10-08T16:24:39.5369330Z     
2025-10-08T16:24:39.5369557Z         with self.assertRaises(ValueError) as context:
2025-10-08T16:24:39.5369872Z >           perform_user_action(123, 'ban')
2025-10-08T16:24:39.5370062Z 
2025-10-08T16:24:39.5370171Z tests/test_user_management_simple.py:108: 
2025-10-08T16:24:39.5370478Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5371001Z app/api/admin/user_management.py:186: in perform_user_action
2025-10-08T16:24:39.5371601Z     db.session.rollback()
2025-10-08T16:24:39.5372404Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/scoping.py:1793: in rollback
2025-10-08T16:24:39.5373055Z     return self._proxied.rollback()
2025-10-08T16:24:39.5373307Z            ^^^^^^^^^^^^^
2025-10-08T16:24:39.5373772Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/scoping.py:197: in _proxied
2025-10-08T16:24:39.5374280Z     return self.registry()
2025-10-08T16:24:39.5374493Z            ^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5374978Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_collections.py:634: in __call__
2025-10-08T16:24:39.5375526Z     key = self.scopefunc()
2025-10-08T16:24:39.5375734Z           ^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5376191Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/session.py:111: in _app_ctx_id
2025-10-08T16:24:39.5376782Z     return id(app_ctx._get_current_object())  # type: ignore[attr-defined]
2025-10-08T16:24:39.5377119Z               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5377386Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5377594Z 
2025-10-08T16:24:39.5377689Z     def _get_current_object() -> T:
2025-10-08T16:24:39.5377920Z         try:
2025-10-08T16:24:39.5378306Z             obj = local.get()
2025-10-08T16:24:39.5378541Z         except LookupError:
2025-10-08T16:24:39.5378795Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:39.5379302Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:39.5379592Z E           
2025-10-08T16:24:39.5379876Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.5380325Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:39.5380885Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.5381137Z 
2025-10-08T16:24:39.5381426Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:39.5381986Z ______________ TestUserManagementLogic.test_disable_user_success _______________
2025-10-08T16:24:39.5382490Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:39.5382898Z     with self.decoration_helper(patched,
2025-10-08T16:24:39.5383287Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:39.5383669Z     return next(self.gen)
2025-10-08T16:24:39.5383867Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:39.5384247Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:39.5384697Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:39.5384952Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5385340Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:39.5385734Z     result = _enter(cm)
2025-10-08T16:24:39.5385927Z              ^^^^^^^^^^
2025-10-08T16:24:39.5386266Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:39.5386697Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:39.5386973Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5387366Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:39.5387773Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:39.5387997Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5388414Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:39.5388864Z     obj = instance._get_current_object()
2025-10-08T16:24:39.5389317Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5389643Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5389843Z 
2025-10-08T16:24:39.5389933Z     def _get_current_object() -> T:
2025-10-08T16:24:39.5390162Z         try:
2025-10-08T16:24:39.5390342Z             obj = local.get()
2025-10-08T16:24:39.5390562Z         except LookupError:
2025-10-08T16:24:39.5390812Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:39.5391146Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:39.5391432Z E           
2025-10-08T16:24:39.5391710Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.5392156Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:39.5392580Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.5392831Z 
2025-10-08T16:24:39.5393126Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:39.5393676Z ________________ TestUserManagementLogic.test_soft_delete_user _________________
2025-10-08T16:24:39.5394168Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:39.5394571Z     with self.decoration_helper(patched,
2025-10-08T16:24:39.5395089Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:39.5395478Z     return next(self.gen)
2025-10-08T16:24:39.5395681Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:39.5396062Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:39.5396493Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:39.5396741Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5397124Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:39.5397618Z     result = _enter(cm)
2025-10-08T16:24:39.5397808Z              ^^^^^^^^^^
2025-10-08T16:24:39.5398149Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:39.5398564Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:39.5398830Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5399344Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:39.5399754Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:39.5399971Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5400377Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:39.5400825Z     obj = instance._get_current_object()
2025-10-08T16:24:39.5401066Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5401332Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5401541Z 
2025-10-08T16:24:39.5401629Z     def _get_current_object() -> T:
2025-10-08T16:24:39.5401857Z         try:
2025-10-08T16:24:39.5402032Z             obj = local.get()
2025-10-08T16:24:39.5402252Z         except LookupError:
2025-10-08T16:24:39.5402503Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:39.5402832Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:39.5403116Z E           
2025-10-08T16:24:39.5403401Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.5403844Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:39.5404262Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.5404514Z 
2025-10-08T16:24:39.5404801Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:39.5405368Z _______________ TestUserManagementLogic.test_update_user_success _______________
2025-10-08T16:24:39.5405863Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1423: in patched
2025-10-08T16:24:39.5406273Z     with self.decoration_helper(patched,
2025-10-08T16:24:39.5406663Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:141: in __enter__
2025-10-08T16:24:39.5407042Z     return next(self.gen)
2025-10-08T16:24:39.5407238Z            ^^^^^^^^^^^^^^
2025-10-08T16:24:39.5407619Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1405: in decoration_helper
2025-10-08T16:24:39.5408060Z     arg = exit_stack.enter_context(patching)
2025-10-08T16:24:39.5408309Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5408691Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/contextlib.py:530: in enter_context
2025-10-08T16:24:39.5409205Z     result = _enter(cm)
2025-10-08T16:24:39.5409404Z              ^^^^^^^^^^
2025-10-08T16:24:39.5409751Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1524: in __enter__
2025-10-08T16:24:39.5410180Z     elif spec is None and _is_async_obj(original):
2025-10-08T16:24:39.5410462Z                           ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5410857Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:58: in _is_async_obj
2025-10-08T16:24:39.5411271Z     if hasattr(obj, '__func__'):
2025-10-08T16:24:39.5411511Z        ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5412031Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:24:39.5412495Z     obj = instance._get_current_object()
2025-10-08T16:24:39.5412742Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5413006Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5413208Z 
2025-10-08T16:24:39.5413298Z     def _get_current_object() -> T:
2025-10-08T16:24:39.5413633Z         try:
2025-10-08T16:24:39.5413815Z             obj = local.get()
2025-10-08T16:24:39.5414038Z         except LookupError:
2025-10-08T16:24:39.5414290Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:39.5414625Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:39.5414910Z E           
2025-10-08T16:24:39.5415194Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.5415646Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:39.5416068Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.5416314Z 
2025-10-08T16:24:39.5416601Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:39.5417193Z ________________ TestUserStatistics.test_export_user_data_basic ________________
2025-10-08T16:24:39.5417458Z 
2025-10-08T16:24:39.5417737Z self = <tests.test_user_management_simple.TestUserStatistics testMethod=test_export_user_data_basic>
2025-10-08T16:24:39.5418087Z 
2025-10-08T16:24:39.5418185Z     def test_export_user_data_basic(self):
2025-10-08T16:24:39.5418450Z         """Test basic user data export"""
2025-10-08T16:24:39.5418771Z         from app.api.admin.user_management import export_user_data
2025-10-08T16:24:39.5419173Z     
2025-10-08T16:24:39.5419355Z         # Mock the list_users function
2025-10-08T16:24:39.5419603Z         mock_users_data = [
2025-10-08T16:24:39.5419864Z             {'id': 1, 'username': 'user1', 'email': 'user1@test.com'},
2025-10-08T16:24:39.5420188Z             {'id': 2, 'username': 'user2', 'email': 'user2@test.com'}
2025-10-08T16:24:39.5420460Z         ]
2025-10-08T16:24:39.5420623Z     
2025-10-08T16:24:39.5420884Z >       with patch('app.api.admin.user_management.list_users') as mock_list:
2025-10-08T16:24:39.5421229Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5421431Z 
2025-10-08T16:24:39.5421537Z tests/test_user_management_simple.py:269: 
2025-10-08T16:24:39.5421830Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5422273Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1497: in __enter__
2025-10-08T16:24:39.5422688Z     original, local = self.get_original()
2025-10-08T16:24:39.5422934Z                       ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5423201Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5423395Z 
2025-10-08T16:24:39.5423523Z self = <unittest.mock._patch object at 0x7fed61d01b20>
2025-10-08T16:24:39.5423738Z 
2025-10-08T16:24:39.5423821Z     def get_original(self):
2025-10-08T16:24:39.5424044Z         target = self.getter()
2025-10-08T16:24:39.5424272Z         name = self.attribute
2025-10-08T16:24:39.5424472Z     
2025-10-08T16:24:39.5424637Z         original = DEFAULT
2025-10-08T16:24:39.5424841Z         local = False
2025-10-08T16:24:39.5425020Z     
2025-10-08T16:24:39.5425181Z         try:
2025-10-08T16:24:39.5425372Z             original = target.__dict__[name]
2025-10-08T16:24:39.5425631Z         except (AttributeError, KeyError):
2025-10-08T16:24:39.5425905Z             original = getattr(target, name, DEFAULT)
2025-10-08T16:24:39.5426157Z         else:
2025-10-08T16:24:39.5426327Z             local = True
2025-10-08T16:24:39.5426520Z     
2025-10-08T16:24:39.5426743Z         if name in _builtins and isinstance(target, ModuleType):
2025-10-08T16:24:39.5436542Z             self.create = True
2025-10-08T16:24:39.5436812Z     
2025-10-08T16:24:39.5437028Z         if not self.create and original is DEFAULT:
2025-10-08T16:24:39.5437326Z >           raise AttributeError(
2025-10-08T16:24:39.5437620Z                 "%s does not have the attribute %r" % (target, name)
2025-10-08T16:24:39.5437903Z             )
2025-10-08T16:24:39.5438539Z E           AttributeError: <module 'app.api.admin.user_management' from '/home/runner/work/pyfedi/pyfedi/app/api/admin/user_management.py'> does not have the attribute 'list_users'
2025-10-08T16:24:39.5439409Z 
2025-10-08T16:24:39.5439675Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1467: AttributeError
2025-10-08T16:24:39.5440219Z _____________ TestUserStatistics.test_get_registration_statistics ______________
2025-10-08T16:24:39.5440496Z 
2025-10-08T16:24:39.5440792Z self = <tests.test_user_management_simple.TestUserStatistics testMethod=test_get_registration_statistics>
2025-10-08T16:24:39.5441308Z mock_utcnow = <MagicMock name='utcnow' id='140657646904256'>
2025-10-08T16:24:39.5441677Z mock_user_class = <MagicMock name='User' id='140657646590944'>
2025-10-08T16:24:39.5441895Z 
2025-10-08T16:24:39.5442023Z     @patch('app.api.admin.user_management.User')
2025-10-08T16:24:39.5442345Z     @patch('app.api.admin.user_management.utcnow')
2025-10-08T16:24:39.5442723Z     def test_get_registration_statistics(self, mock_utcnow, mock_user_class):
2025-10-08T16:24:39.5443106Z         """Test getting registration statistics"""
2025-10-08T16:24:39.5443465Z         from app.api.admin.user_management import get_registration_statistics
2025-10-08T16:24:39.5443794Z     
2025-10-08T16:24:39.5443983Z         mock_time = datetime(2025, 1, 1, 12, 0, 0)
2025-10-08T16:24:39.5444256Z         mock_utcnow.return_value = mock_time
2025-10-08T16:24:39.5444490Z     
2025-10-08T16:24:39.5444664Z         # Mock database query
2025-10-08T16:24:39.5444987Z         mock_user_class.query.filter.return_value.count.return_value = 50
2025-10-08T16:24:39.5445312Z     
2025-10-08T16:24:39.5445558Z >       result = get_registration_statistics(days=7, include_hourly=True)
2025-10-08T16:24:39.5445894Z                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5446070Z 
2025-10-08T16:24:39.5446182Z tests/test_user_management_simple.py:250: 
2025-10-08T16:24:39.5446471Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5446675Z 
2025-10-08T16:24:39.5446788Z days = 7, include_hourly = True
2025-10-08T16:24:39.5446950Z 
2025-10-08T16:24:39.5447108Z     def get_registration_statistics(days=30, include_hourly=False):
2025-10-08T16:24:39.5447418Z         """
2025-10-08T16:24:39.5447643Z         Get detailed registration statistics over time.
2025-10-08T16:24:39.5447917Z     
2025-10-08T16:24:39.5448084Z         Args:
2025-10-08T16:24:39.5448285Z             days (int): Number of days to analyze
2025-10-08T16:24:39.5448588Z             include_hourly (bool): Include hourly breakdown
2025-10-08T16:24:39.5448857Z     
2025-10-08T16:24:39.5449012Z         Returns:
2025-10-08T16:24:39.5449345Z             dict: Registration statistics
2025-10-08T16:24:39.5449587Z         """
2025-10-08T16:24:39.5449756Z         now = utcnow()
2025-10-08T16:24:39.5449982Z         start_date = now - timedelta(days=days)
2025-10-08T16:24:39.5450229Z     
2025-10-08T16:24:39.5450409Z         # Total registrations in period
2025-10-08T16:24:39.5450852Z >       total_registrations = User.query.filter(and_(User.deleted is False, User.created >= start_date)).count()
2025-10-08T16:24:39.5451327Z                                                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5451754Z E       TypeError: '>=' not supported between instances of 'MagicMock' and 'datetime.datetime'
2025-10-08T16:24:39.5452059Z 
2025-10-08T16:24:39.5452182Z app/api/admin/user_management.py:300: TypeError
2025-10-08T16:24:39.5452709Z _________________ TestUserStatistics.test_get_user_statistics __________________
2025-10-08T16:24:39.5452990Z 
2025-10-08T16:24:39.5453252Z self = <tests.test_user_management_simple.TestUserStatistics testMethod=test_get_user_statistics>
2025-10-08T16:24:39.5453739Z mock_utcnow = <MagicMock name='utcnow' id='140657531034928'>
2025-10-08T16:24:39.5454090Z mock_user_class = <MagicMock name='User' id='140657531034592'>
2025-10-08T16:24:39.5454313Z 
2025-10-08T16:24:39.5454430Z     @patch('app.api.admin.user_management.User')
2025-10-08T16:24:39.5454855Z     @patch('app.api.admin.user_management.utcnow')
2025-10-08T16:24:39.5455216Z     def test_get_user_statistics(self, mock_utcnow, mock_user_class):
2025-10-08T16:24:39.5455546Z         """Test getting user statistics"""
2025-10-08T16:24:39.5455871Z         from app.api.admin.user_management import get_user_statistics
2025-10-08T16:24:39.5456170Z     
2025-10-08T16:24:39.5456349Z         mock_time = datetime(2025, 1, 1, 12, 0, 0)
2025-10-08T16:24:39.5456624Z         mock_utcnow.return_value = mock_time
2025-10-08T16:24:39.5456867Z     
2025-10-08T16:24:39.5457032Z         # Mock database queries
2025-10-08T16:24:39.5457362Z         mock_user_class.query.filter_by.return_value.count.return_value = 100
2025-10-08T16:24:39.5457794Z         mock_user_class.query.filter.return_value.count.return_value = 25
2025-10-08T16:24:39.5458112Z     
2025-10-08T16:24:39.5458284Z >       result = get_user_statistics()
2025-10-08T16:24:39.5458525Z                  ^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5458736Z 
2025-10-08T16:24:39.5458846Z tests/test_user_management_simple.py:230: 
2025-10-08T16:24:39.5459240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5459446Z 
2025-10-08T16:24:39.5459535Z     def get_user_statistics():
2025-10-08T16:24:39.5459748Z         """
2025-10-08T16:24:39.5459938Z         Get comprehensive user statistics.
2025-10-08T16:24:39.5460173Z     
2025-10-08T16:24:39.5460343Z         Returns:
2025-10-08T16:24:39.5460543Z             dict: User statistics
2025-10-08T16:24:39.5460767Z         """
2025-10-08T16:24:39.5460942Z         now = utcnow()
2025-10-08T16:24:39.5461167Z         day_ago = now - timedelta(days=1)
2025-10-08T16:24:39.5461431Z         week_ago = now - timedelta(days=7)
2025-10-08T16:24:39.5461706Z         month_ago = now - timedelta(days=30)
2025-10-08T16:24:39.5461950Z     
2025-10-08T16:24:39.5462113Z         # Base statistics
2025-10-08T16:24:39.5462390Z         total_users = User.query.filter_by(deleted=False).count()
2025-10-08T16:24:39.5462804Z         local_users = User.query.filter_by(deleted=False, instance_id=1).count()
2025-10-08T16:24:39.5463174Z         remote_users = total_users - local_users
2025-10-08T16:24:39.5463541Z         verified_users = User.query.filter_by(deleted=False, verified=True).count()
2025-10-08T16:24:39.5463994Z         banned_users = User.query.filter_by(deleted=False, banned=True).count()
2025-10-08T16:24:39.5464324Z     
2025-10-08T16:24:39.5464493Z         # Activity statistics
2025-10-08T16:24:39.5464881Z >       active_24h = User.query.filter(and_(User.deleted is False, User.last_seen >= day_ago)).count()
2025-10-08T16:24:39.5465318Z                                                                    ^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5465736Z E       TypeError: '>=' not supported between instances of 'MagicMock' and 'datetime.datetime'
2025-10-08T16:24:39.5466038Z 
2025-10-08T16:24:39.5466158Z app/api/admin/user_management.py:256: TypeError
2025-10-08T16:24:39.5466548Z ______________ TestInputValidation.test_unknown_action_validation ______________
2025-10-08T16:24:39.5466858Z 
2025-10-08T16:24:39.5467149Z self = <tests.test_user_management_simple.TestInputValidation testMethod=test_unknown_action_validation>
2025-10-08T16:24:39.5467517Z 
2025-10-08T16:24:39.5467630Z     def test_unknown_action_validation(self):
2025-10-08T16:24:39.5467917Z         """Test that unknown actions are rejected"""
2025-10-08T16:24:39.5468269Z         from app.api.admin.user_management import perform_user_action
2025-10-08T16:24:39.5468688Z     
2025-10-08T16:24:39.5468951Z         with patch('app.api.admin.user_management.User') as mock_user_class:
2025-10-08T16:24:39.5469449Z             mock_user = MagicMock()
2025-10-08T16:24:39.5469809Z             mock_user_class.query.filter_by.return_value.first.return_value = mock_user
2025-10-08T16:24:39.5470163Z     
2025-10-08T16:24:39.5470367Z             with self.assertRaises(ValueError) as context:
2025-10-08T16:24:39.5470679Z >               perform_user_action(123, 'invalid_action')
2025-10-08T16:24:39.5471037Z 
2025-10-08T16:24:39.5471150Z tests/test_user_management_simple.py:293: 
2025-10-08T16:24:39.5471437Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5471790Z app/api/admin/user_management.py:186: in perform_user_action
2025-10-08T16:24:39.5472109Z     db.session.rollback()
2025-10-08T16:24:39.5472561Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/scoping.py:1793: in rollback
2025-10-08T16:24:39.5473066Z     return self._proxied.rollback()
2025-10-08T16:24:39.5473309Z            ^^^^^^^^^^^^^
2025-10-08T16:24:39.5473746Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/scoping.py:197: in _proxied
2025-10-08T16:24:39.5474217Z     return self.registry()
2025-10-08T16:24:39.5474428Z            ^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5474880Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/_collections.py:634: in __call__
2025-10-08T16:24:39.5475376Z     key = self.scopefunc()
2025-10-08T16:24:39.5475582Z           ^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5476043Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/session.py:111: in _app_ctx_id
2025-10-08T16:24:39.5476627Z     return id(app_ctx._get_current_object())  # type: ignore[attr-defined]
2025-10-08T16:24:39.5476960Z               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:39.5477240Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:39.5477442Z 
2025-10-08T16:24:39.5477542Z     def _get_current_object() -> T:
2025-10-08T16:24:39.5477768Z         try:
2025-10-08T16:24:39.5477957Z             obj = local.get()
2025-10-08T16:24:39.5478184Z         except LookupError:
2025-10-08T16:24:39.5478442Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:39.5478782Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:39.5479193Z E           
2025-10-08T16:24:39.5479484Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8273817Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:39.8274747Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8275154Z 
2025-10-08T16:24:39.8275619Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:39.8276444Z =========================== short test summary info ============================
2025-10-08T16:24:39.8277499Z FAILED tests/test_user_management_simple.py::TestUserManagementLogic::test_ban_already_banned_user - RuntimeError: Working outside of application context.
2025-10-08T16:24:39.8278336Z 
2025-10-08T16:24:39.8278611Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8279709Z the current application. To solve this, set up an application context
2025-10-08T16:24:39.8280371Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8281254Z FAILED tests/test_user_management_simple.py::TestUserManagementLogic::test_disable_user_success - RuntimeError: Working outside of application context.
2025-10-08T16:24:39.8281906Z 
2025-10-08T16:24:39.8282131Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8282661Z the current application. To solve this, set up an application context
2025-10-08T16:24:39.8283465Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8284302Z FAILED tests/test_user_management_simple.py::TestUserManagementLogic::test_soft_delete_user - RuntimeError: Working outside of application context.
2025-10-08T16:24:39.8284938Z 
2025-10-08T16:24:39.8285165Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8285695Z the current application. To solve this, set up an application context
2025-10-08T16:24:39.8286323Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8287159Z FAILED tests/test_user_management_simple.py::TestUserManagementLogic::test_update_user_success - RuntimeError: Working outside of application context.
2025-10-08T16:24:39.8287805Z 
2025-10-08T16:24:39.8288020Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8288559Z the current application. To solve this, set up an application context
2025-10-08T16:24:39.8289193Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8290516Z FAILED tests/test_user_management_simple.py::TestUserStatistics::test_export_user_data_basic - AttributeError: <module 'app.api.admin.user_management' from '/home/runner/work/pyfedi/pyfedi/app/api/admin/user_management.py'> does not have the attribute 'list_users'
2025-10-08T16:24:39.8292061Z FAILED tests/test_user_management_simple.py::TestUserStatistics::test_get_registration_statistics - TypeError: '>=' not supported between instances of 'MagicMock' and 'datetime.datetime'
2025-10-08T16:24:39.8293182Z FAILED tests/test_user_management_simple.py::TestUserStatistics::test_get_user_statistics - TypeError: '>=' not supported between instances of 'MagicMock' and 'datetime.datetime'
2025-10-08T16:24:39.8294184Z FAILED tests/test_user_management_simple.py::TestInputValidation::test_unknown_action_validation - RuntimeError: Working outside of application context.
2025-10-08T16:24:39.8294700Z 
2025-10-08T16:24:39.8294882Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:39.8295317Z the current application. To solve this, set up an application context
2025-10-08T16:24:39.8295720Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:39.8296098Z ========================= 8 failed, 7 passed in 1.84s ==========================
2025-10-08T16:24:40.3053918Z ============================= test session starts ==============================
2025-10-08T16:24:40.3054569Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:40.3055085Z cachedir: .pytest_cache
2025-10-08T16:24:40.3055345Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:40.3055647Z plugins: anyio-4.11.0
2025-10-08T16:24:41.5990650Z collecting ... collected 35 items
2025-10-08T16:24:41.5991050Z 
2025-10-08T16:24:41.6008402Z tests/test_private_registration.py::TestSecurityFunctions::test_validate_registration_secret_success PASSED [  2%]
2025-10-08T16:24:41.6021976Z tests/test_private_registration.py::TestSecurityFunctions::test_validate_registration_secret_failure PASSED [  5%]
2025-10-08T16:24:41.7667076Z tests/test_private_registration.py::TestSecurityFunctions::test_validate_registration_secret_empty FAILED [  8%]
2025-10-08T16:24:41.7680348Z tests/test_private_registration.py::TestSecurityFunctions::test_ip_whitelist_validation_allowed PASSED [ 11%]
2025-10-08T16:24:41.7689894Z tests/test_private_registration.py::TestSecurityFunctions::test_ip_whitelist_validation_denied PASSED [ 14%]
2025-10-08T16:24:41.7698183Z tests/test_private_registration.py::TestSecurityFunctions::test_ip_whitelist_no_restrictions PASSED [ 17%]
2025-10-08T16:24:41.7705026Z tests/test_private_registration.py::TestSecurityFunctions::test_generate_secure_password PASSED [ 20%]
2025-10-08T16:24:41.7723526Z tests/test_private_registration.py::TestSecurityFunctions::test_generate_username_suggestions SKIPPED [ 22%]
2025-10-08T16:24:41.7738801Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_validate_user_availability_success SKIPPED [ 25%]
2025-10-08T16:24:41.7753064Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_validate_user_availability_username_taken SKIPPED [ 28%]
2025-10-08T16:24:41.7766865Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_validate_user_availability_email_taken SKIPPED [ 31%]
2025-10-08T16:24:41.7781115Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_create_private_user_success SKIPPED [ 34%]
2025-10-08T16:24:41.7795023Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_create_private_user_with_generated_password SKIPPED [ 37%]
2025-10-08T16:24:41.7812837Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_create_private_user_duplicate_username SKIPPED [ 40%]
2025-10-08T16:24:41.7826447Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_get_user_by_lookup_found SKIPPED [ 42%]
2025-10-08T16:24:41.7840556Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_get_user_by_lookup_not_found SKIPPED [ 45%]
2025-10-08T16:24:41.7854115Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_list_users_basic SKIPPED [ 48%]
2025-10-08T16:24:41.7867780Z tests/test_private_registration.py::TestPrivateRegistrationLogic::test_list_users_filtering SKIPPED [ 51%]
2025-10-08T16:24:41.7881846Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_private_registration_success SKIPPED [ 54%]
2025-10-08T16:24:41.7895602Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_private_registration_invalid_secret SKIPPED [ 57%]
2025-10-08T16:24:41.7909537Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_private_registration_disabled SKIPPED [ 60%]
2025-10-08T16:24:41.7926930Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_private_registration_missing_secret SKIPPED [ 62%]
2025-10-08T16:24:41.7940935Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_user_validation_endpoint SKIPPED [ 65%]
2025-10-08T16:24:41.7954575Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_user_list_endpoint SKIPPED [ 68%]
2025-10-08T16:24:41.7968287Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_user_lookup_endpoint SKIPPED [ 71%]
2025-10-08T16:24:41.7982523Z tests/test_private_registration.py::TestPrivateRegistrationAPI::test_health_check_endpoint SKIPPED [ 74%]
2025-10-08T16:24:41.7996270Z tests/test_private_registration.py::TestSecurityProtections::test_input_sanitization SKIPPED [ 77%]
2025-10-08T16:24:41.8010128Z tests/test_private_registration.py::TestSecurityProtections::test_sql_injection_protection SKIPPED [ 80%]
2025-10-08T16:24:41.8023739Z tests/test_private_registration.py::TestSecurityProtections::test_rate_limiting_simulation SKIPPED [ 82%]
2025-10-08T16:24:41.8041169Z tests/test_private_registration.py::TestCaseConflictValidation::test_case_insensitive_username_conflict SKIPPED [ 85%]
2025-10-08T16:24:41.8055198Z tests/test_private_registration.py::TestCaseConflictValidation::test_activitypub_profile_conflict SKIPPED [ 88%]
2025-10-08T16:24:41.8068988Z tests/test_private_registration.py::TestCaseConflictValidation::test_exact_case_match_still_works SKIPPED [ 91%]
2025-10-08T16:24:41.8082966Z tests/test_private_registration.py::TestCaseConflictValidation::test_case_preserved_in_suggestions SKIPPED [ 94%]
2025-10-08T16:24:41.8096683Z tests/test_private_registration.py::TestCaseConflictValidation::test_no_false_positives_for_available_usernames SKIPPED [ 97%]
2025-10-08T16:24:42.0989824Z tests/test_private_registration.py::TestCaseConflictValidation::test_deleted_user_case_conflict SKIPPED [100%]
2025-10-08T16:24:42.0990771Z 
2025-10-08T16:24:42.0991004Z =================================== FAILURES ===================================
2025-10-08T16:24:42.0991596Z ________ TestSecurityFunctions.test_validate_registration_secret_empty _________
2025-10-08T16:24:42.0992337Z 
2025-10-08T16:24:42.0992518Z args = ('PRIVATE_REGISTRATION_SECRET', ''), kwargs = {}
2025-10-08T16:24:42.0992805Z 
2025-10-08T16:24:42.0992913Z     @functools.wraps(f)
2025-10-08T16:24:42.0993200Z     def decorated_function(*args, **kwargs):
2025-10-08T16:24:42.0993471Z         #: bypass cache
2025-10-08T16:24:42.0993716Z         if self._bypass_cache(unless, f, *args, **kwargs):
2025-10-08T16:24:42.0994030Z             return self._call_fn(f, *args, **kwargs)
2025-10-08T16:24:42.0994446Z     
2025-10-08T16:24:42.0994634Z         nonlocal source_check
2025-10-08T16:24:42.0994868Z         if source_check is None:
2025-10-08T16:24:42.0995230Z             source_check = self.source_check
2025-10-08T16:24:42.0995537Z     
2025-10-08T16:24:42.0995696Z         try:
2025-10-08T16:24:42.0995966Z >           cache_key = decorated_function.make_cache_key(f, *args, **kwargs)
2025-10-08T16:24:42.0996320Z                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:42.0996514Z 
2025-10-08T16:24:42.0996824Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:861: 
2025-10-08T16:24:42.0997332Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:42.0997924Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:618: in make_cache_key
2025-10-08T16:24:42.0998680Z     fname, version_data = self._memoize_version(
2025-10-08T16:24:42.0999569Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:568: in _memoize_version
2025-10-08T16:24:42.1000332Z     version_data_list = list(self.cache.get_many(*fetch_keys))
2025-10-08T16:24:42.1000651Z                              ^^^^^^^^^^
2025-10-08T16:24:42.1000925Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:42.1001134Z 
2025-10-08T16:24:42.1001264Z self = <flask_caching.Cache object at 0x7fdb51b8da90>
2025-10-08T16:24:42.1001490Z 
2025-10-08T16:24:42.1001569Z     @property
2025-10-08T16:24:42.1001777Z     def cache(self) -> SimpleCache:
2025-10-08T16:24:42.1002039Z >       app = current_app or self.app
2025-10-08T16:24:42.1002289Z                              ^^^^^^^^
2025-10-08T16:24:42.1002588Z E       AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:42.1002821Z 
2025-10-08T16:24:42.1003174Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:190: AttributeError
2025-10-08T16:24:42.1003622Z 
2025-10-08T16:24:42.1003796Z During handling of the above exception, another exception occurred:
2025-10-08T16:24:42.1004065Z 
2025-10-08T16:24:42.1004296Z self = <tests.test_private_registration.TestSecurityFunctions object at 0x7fdb4fc9d480>
2025-10-08T16:24:42.1004626Z 
2025-10-08T16:24:42.1004755Z     def test_validate_registration_secret_empty(self):
2025-10-08T16:24:42.1005062Z         """Test validation with empty secrets"""
2025-10-08T16:24:42.1005357Z >       assert validate_registration_secret('') == False
2025-10-08T16:24:42.1005637Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:42.1005799Z 
2025-10-08T16:24:42.1005907Z tests/test_private_registration.py:93: 
2025-10-08T16:24:42.1006198Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:42.1006557Z app/api/admin/security.py:30: in validate_registration_secret
2025-10-08T16:24:42.1006905Z     expected = get_private_registration_secret()
2025-10-08T16:24:42.1007174Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:42.1007453Z app/utils.py:3540: in get_private_registration_secret
2025-10-08T16:24:42.1007783Z     return get_setting('PRIVATE_REGISTRATION_SECRET', '')
2025-10-08T16:24:42.1008078Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:42.1008344Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:42.1008544Z 
2025-10-08T16:24:42.1008837Z args = ('PRIVATE_REGISTRATION_SECRET', ''), kwargs = {}
2025-10-08T16:24:42.1009189Z 
2025-10-08T16:24:42.1009276Z     @functools.wraps(f)
2025-10-08T16:24:42.1009507Z     def decorated_function(*args, **kwargs):
2025-10-08T16:24:42.1009754Z         #: bypass cache
2025-10-08T16:24:42.1009995Z         if self._bypass_cache(unless, f, *args, **kwargs):
2025-10-08T16:24:42.1010294Z             return self._call_fn(f, *args, **kwargs)
2025-10-08T16:24:42.1010531Z     
2025-10-08T16:24:42.1010853Z         nonlocal source_check
2025-10-08T16:24:42.1011082Z         if source_check is None:
2025-10-08T16:24:42.1011324Z             source_check = self.source_check
2025-10-08T16:24:42.1011554Z     
2025-10-08T16:24:42.1011710Z         try:
2025-10-08T16:24:42.1011966Z             cache_key = decorated_function.make_cache_key(f, *args, **kwargs)
2025-10-08T16:24:42.1012266Z     
2025-10-08T16:24:42.1012420Z             if (
2025-10-08T16:24:42.1012613Z                 callable(forced_update)
2025-10-08T16:24:42.1012847Z                 and (
2025-10-08T16:24:42.1013062Z                     forced_update(*args, **kwargs)
2025-10-08T16:24:42.1013331Z                     if wants_args(forced_update)
2025-10-08T16:24:42.1013581Z                     else forced_update()
2025-10-08T16:24:42.1013809Z                 )
2025-10-08T16:24:42.1013987Z                 is True
2025-10-08T16:24:42.1014165Z             ):
2025-10-08T16:24:42.1014340Z                 rv = None
2025-10-08T16:24:42.1014540Z                 found = False
2025-10-08T16:24:42.1014748Z             else:
2025-10-08T16:24:42.1014940Z                 rv = self.cache.get(cache_key)
2025-10-08T16:24:42.1015184Z                 found = True
2025-10-08T16:24:42.1015384Z     
2025-10-08T16:24:42.1015595Z                 # If the value returned by cache.get() is None, it
2025-10-08T16:24:42.1015923Z                 # might be because the key is not found in the cache
2025-10-08T16:24:42.1016240Z                 # or because the cached value is actually None
2025-10-08T16:24:42.1016510Z                 if rv is None:
2025-10-08T16:24:42.1016765Z                     # If we're sure we don't need to cache None values
2025-10-08T16:24:42.1017077Z                     # (cache_none=False), don't bother checking for
2025-10-08T16:24:42.1017392Z                     # key existence, as it can lead to false positives
2025-10-08T16:24:42.1017694Z                     # if a concurrent call already cached the
2025-10-08T16:24:42.1017994Z                     # key between steps. This would cause us to
2025-10-08T16:24:42.1018281Z                     # return None when we shouldn't
2025-10-08T16:24:42.1018535Z                     if not cache_none:
2025-10-08T16:24:42.1018771Z                         found = False
2025-10-08T16:24:42.1018999Z                     else:
2025-10-08T16:24:42.1019349Z                         found = self.cache.has(cache_key)
2025-10-08T16:24:42.1019609Z         except Exception:
2025-10-08T16:24:42.1019821Z >           if self.app.debug:
2025-10-08T16:24:42.1020035Z                ^^^^^^^^
2025-10-08T16:24:42.1020284Z E           AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:42.1020509Z 
2025-10-08T16:24:42.1020845Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_caching/__init__.py:893: AttributeError
2025-10-08T16:24:42.1021380Z =========================== short test summary info ============================
2025-10-08T16:24:42.1022068Z FAILED tests/test_private_registration.py::TestSecurityFunctions::test_validate_registration_secret_empty - AttributeError: 'Cache' object has no attribute 'app'
2025-10-08T16:24:42.1022753Z =================== 1 failed, 6 passed, 28 skipped in 1.52s ====================
2025-10-08T16:24:42.5958321Z ============================= test session starts ==============================
2025-10-08T16:24:42.5959776Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:42.5960753Z cachedir: .pytest_cache
2025-10-08T16:24:42.5961551Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:42.5961987Z plugins: anyio-4.11.0
2025-10-08T16:24:43.6632460Z collecting ... collected 1 item
2025-10-08T16:24:43.6632867Z 
2025-10-08T16:24:45.2652247Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions FAILED [100%]
2025-10-08T16:24:45.2652912Z 
2025-10-08T16:24:45.2653148Z =================================== FAILURES ===================================
2025-10-08T16:24:45.2653774Z _________________________ test_api_user_subscriptions __________________________
2025-10-08T16:24:45.2654540Z 
2025-10-08T16:24:45.2654856Z self = <sqlalchemy.engine.base.Connection object at 0x7fdc03cdfbb0>
2025-10-08T16:24:45.2655803Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdc0d58c2f0>
2025-10-08T16:24:45.2656919Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdc03720e10>
2025-10-08T16:24:45.2657609Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7fdc03d41400>
2025-10-08T16:24:45.2658072Z parameters = [(1,)]
2025-10-08T16:24:45.2658206Z 
2025-10-08T16:24:45.2658304Z     def _exec_single_context(
2025-10-08T16:24:45.2658544Z         self,
2025-10-08T16:24:45.2658749Z         dialect: Dialect,
2025-10-08T16:24:45.2658991Z         context: ExecutionContext,
2025-10-08T16:24:45.2659509Z         statement: Union[str, Compiled],
2025-10-08T16:24:45.2659843Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:24:45.2660176Z     ) -> CursorResult[Any]:
2025-10-08T16:24:45.2660501Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:24:45.2660892Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:24:45.2661185Z     
2025-10-08T16:24:45.2661359Z         """
2025-10-08T16:24:45.2661616Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:24:45.2662031Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:24:45.2662373Z     
2025-10-08T16:24:45.2662574Z             if generic_setinputsizes:
2025-10-08T16:24:45.2662839Z                 try:
2025-10-08T16:24:45.2663052Z                     dialect.do_set_input_sizes(
2025-10-08T16:24:45.2663367Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:24:45.2663663Z                     )
2025-10-08T16:24:45.2663881Z                 except BaseException as e:
2025-10-08T16:24:45.2664143Z                     self._handle_dbapi_exception(
2025-10-08T16:24:45.2664446Z                         e, str(statement), parameters, None, context
2025-10-08T16:24:45.2664714Z                     )
2025-10-08T16:24:45.2664887Z     
2025-10-08T16:24:45.2665077Z         cursor, str_statement, parameters = (
2025-10-08T16:24:45.2665335Z             context.cursor,
2025-10-08T16:24:45.2665554Z             context.statement,
2025-10-08T16:24:45.2665776Z             context.parameters,
2025-10-08T16:24:45.2665993Z         )
2025-10-08T16:24:45.2666152Z     
2025-10-08T16:24:45.2666370Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:24:45.2666650Z     
2025-10-08T16:24:45.2666825Z         if not context.executemany:
2025-10-08T16:24:45.2667081Z             effective_parameters = parameters[0]
2025-10-08T16:24:45.2667327Z         else:
2025-10-08T16:24:45.2667527Z             effective_parameters = parameters
2025-10-08T16:24:45.2667757Z     
2025-10-08T16:24:45.2667959Z         if self._has_events or self.engine._has_events:
2025-10-08T16:24:45.2668276Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:24:45.2668575Z                 str_statement, effective_parameters = fn(
2025-10-08T16:24:45.2668842Z                     self,
2025-10-08T16:24:45.2669147Z                     cursor,
2025-10-08T16:24:45.2669361Z                     str_statement,
2025-10-08T16:24:45.2669592Z                     effective_parameters,
2025-10-08T16:24:45.2669829Z                     context,
2025-10-08T16:24:45.2670049Z                     context.executemany,
2025-10-08T16:24:45.2670436Z                 )
2025-10-08T16:24:45.2670626Z     
2025-10-08T16:24:45.2670798Z         if self._echo:
2025-10-08T16:24:45.2671010Z             self._log_info(str_statement)
2025-10-08T16:24:45.2671247Z     
2025-10-08T16:24:45.2671431Z             stats = context._get_cache_stats()
2025-10-08T16:24:45.2671664Z     
2025-10-08T16:24:45.2671854Z             if not self.engine.hide_parameters:
2025-10-08T16:24:45.2672116Z                 self._log_info(
2025-10-08T16:24:45.2672456Z                     "[%s] %r",
2025-10-08T16:24:45.2672663Z                     stats,
2025-10-08T16:24:45.2672880Z                     sql_util._repr_params(
2025-10-08T16:24:45.2673141Z                         effective_parameters,
2025-10-08T16:24:45.2673383Z                         batches=10,
2025-10-08T16:24:45.2673639Z                         ismulti=context.executemany,
2025-10-08T16:24:45.2673892Z                     ),
2025-10-08T16:24:45.2674071Z                 )
2025-10-08T16:24:45.2674258Z             else:
2025-10-08T16:24:45.2674445Z                 self._log_info(
2025-10-08T16:24:45.2674721Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:24:45.2675029Z                     stats,
2025-10-08T16:24:45.2675224Z                 )
2025-10-08T16:24:45.2675392Z     
2025-10-08T16:24:45.2675568Z         evt_handled: bool = False
2025-10-08T16:24:45.2675794Z         try:
2025-10-08T16:24:45.2676038Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:24:45.2676357Z                 effective_parameters = cast(
2025-10-08T16:24:45.2676659Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:24:45.2676938Z                 )
2025-10-08T16:24:45.2677130Z                 if self.dialect._has_events:
2025-10-08T16:24:45.2677422Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:24:45.2677699Z                         if fn(
2025-10-08T16:24:45.2677906Z                             cursor,
2025-10-08T16:24:45.2678138Z                             str_statement,
2025-10-08T16:24:45.2678394Z                             effective_parameters,
2025-10-08T16:24:45.2678655Z                             context,
2025-10-08T16:24:45.2678873Z                         ):
2025-10-08T16:24:45.2679230Z                             evt_handled = True
2025-10-08T16:24:45.2679585Z                             break
2025-10-08T16:24:45.2679805Z                 if not evt_handled:
2025-10-08T16:24:45.2680059Z                     self.dialect.do_executemany(
2025-10-08T16:24:45.2680308Z                         cursor,
2025-10-08T16:24:45.2680520Z                         str_statement,
2025-10-08T16:24:45.2680768Z                         effective_parameters,
2025-10-08T16:24:45.2681010Z                         context,
2025-10-08T16:24:45.2681215Z                     )
2025-10-08T16:24:45.2681471Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:24:45.2681793Z                 if self.dialect._has_events:
2025-10-08T16:24:45.2682096Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:24:45.2682423Z                         if fn(cursor, str_statement, context):
2025-10-08T16:24:45.2682701Z                             evt_handled = True
2025-10-08T16:24:45.2682940Z                             break
2025-10-08T16:24:45.2683156Z                 if not evt_handled:
2025-10-08T16:24:45.2683412Z                     self.dialect.do_execute_no_params(
2025-10-08T16:24:45.2683700Z                         cursor, str_statement, context
2025-10-08T16:24:45.2683952Z                     )
2025-10-08T16:24:45.2684134Z             else:
2025-10-08T16:24:45.2684339Z                 effective_parameters = cast(
2025-10-08T16:24:45.2684638Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:24:45.2684910Z                 )
2025-10-08T16:24:45.2685110Z                 if self.dialect._has_events:
2025-10-08T16:24:45.2685528Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:24:45.2685814Z                         if fn(
2025-10-08T16:24:45.2686027Z                             cursor,
2025-10-08T16:24:45.2686256Z                             str_statement,
2025-10-08T16:24:45.2686501Z                             effective_parameters,
2025-10-08T16:24:45.2686751Z                             context,
2025-10-08T16:24:45.2686974Z                         ):
2025-10-08T16:24:45.2687190Z                             evt_handled = True
2025-10-08T16:24:45.2687531Z                             break
2025-10-08T16:24:45.2687767Z                 if not evt_handled:
2025-10-08T16:24:45.2688016Z >                   self.dialect.do_execute(
2025-10-08T16:24:45.2688313Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:24:45.2688606Z                     )
2025-10-08T16:24:45.2688723Z 
2025-10-08T16:24:45.2689150Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:24:45.2689772Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:45.2689976Z 
2025-10-08T16:24:45.2690245Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdc0d58c2f0>
2025-10-08T16:24:45.2690721Z cursor = <sqlite3.Cursor object at 0x7fdc037199c0>
2025-10-08T16:24:45.2691540Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:45.2692319Z parameters = (1,)
2025-10-08T16:24:45.2692703Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdc03720e10>
2025-10-08T16:24:45.2693061Z 
2025-10-08T16:24:45.2693224Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:45.2693567Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:45.2693868Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:24:45.2694080Z 
2025-10-08T16:24:45.2694432Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:45.2694887Z 
2025-10-08T16:24:45.2695064Z The above exception was the direct cause of the following exception:
2025-10-08T16:24:45.2695318Z 
2025-10-08T16:24:45.2695403Z app = <Flask 'app'>
2025-10-08T16:24:45.2695523Z 
2025-10-08T16:24:45.2695629Z     def test_api_user_subscriptions(app):
2025-10-08T16:24:45.2695892Z         with app.app_context():
2025-10-08T16:24:45.2696199Z             from app.api.alpha.utils.user import put_user_subscribe
2025-10-08T16:24:45.2696500Z     
2025-10-08T16:24:45.2696662Z             user_id = 1
2025-10-08T16:24:45.2696878Z >           user = User.query.get(user_id)
2025-10-08T16:24:45.2697125Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:45.2697280Z 
2025-10-08T16:24:45.2697384Z tests/test_api_user_subscriptions.py:29: 
2025-10-08T16:24:45.2697677Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:45.2697956Z <string>:2: in get
2025-10-08T16:24:45.2698139Z     ???
2025-10-08T16:24:45.2698562Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:24:45.2699277Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:24:45.2699585Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:45.2700009Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:24:45.2700527Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:24:45.2700839Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:45.2701312Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:24:45.2701928Z     return self.session._get_impl(
2025-10-08T16:24:45.2702417Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:24:45.2702889Z     return db_load_fn(
2025-10-08T16:24:45.2703354Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:24:45.2703862Z     session.execute(
2025-10-08T16:24:45.2704287Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:24:45.2704869Z     return self._execute_internal(
2025-10-08T16:24:45.2705362Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:24:45.2705934Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:24:45.2706526Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:24:45.2707050Z     result = conn.execute(
2025-10-08T16:24:45.2707521Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:24:45.2707983Z     return meth(
2025-10-08T16:24:45.2708461Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:24:45.2709011Z     return connection._execute_clauseelement(
2025-10-08T16:24:45.2709757Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:24:45.2710288Z     ret = self._execute_context(
2025-10-08T16:24:45.2710774Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:24:45.2711279Z     return self._exec_single_context(
2025-10-08T16:24:45.2711797Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:24:45.2712327Z     self._handle_dbapi_exception(
2025-10-08T16:24:45.2712850Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:24:45.2713441Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:24:45.2714032Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:24:45.2714550Z     self.dialect.do_execute(
2025-10-08T16:24:45.2714805Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:45.2715015Z 
2025-10-08T16:24:45.2715279Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7fdc0d58c2f0>
2025-10-08T16:24:45.2715740Z cursor = <sqlite3.Cursor object at 0x7fdc037199c0>
2025-10-08T16:24:45.2716556Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:45.2717326Z parameters = (1,)
2025-10-08T16:24:45.2717697Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7fdc03720e10>
2025-10-08T16:24:45.2718051Z 
2025-10-08T16:24:45.2718215Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:45.2718562Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:45.2718967Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:45.2734342Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:45.2750010Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:45.2750677Z E       WHERE user.id = ?]
2025-10-08T16:24:45.2750889Z E       [parameters: (1,)]
2025-10-08T16:24:45.2751197Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:45.2751448Z 
2025-10-08T16:24:45.2751807Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:45.2752399Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:24:45.2752735Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:45.2753093Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:45.2753501Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:45.2753864Z =============================== warnings summary ===============================
2025-10-08T16:24:45.2754254Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions
2025-10-08T16:24:45.2755209Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:45.2756112Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:45.2756318Z 
2025-10-08T16:24:45.2756494Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions
2025-10-08T16:24:45.2757419Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:45.8210878Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:45.8211417Z 
2025-10-08T16:24:45.8211843Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions
2025-10-08T16:24:45.8213579Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:45.8215112Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:45.8215546Z 
2025-10-08T16:24:45.8215778Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions
2025-10-08T16:24:45.8216846Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:45.8217959Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:45.8218375Z 
2025-10-08T16:24:45.8218593Z tests/test_api_user_subscriptions.py::test_api_user_subscriptions
2025-10-08T16:24:45.8220801Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_user_subscriptions.py:29: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:24:45.8222383Z     user = User.query.get(user_id)
2025-10-08T16:24:45.8222604Z 
2025-10-08T16:24:45.8222854Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:45.8223428Z =========================== short test summary info ============================
2025-10-08T16:24:45.8224100Z FAILED tests/test_api_user_subscriptions.py::test_api_user_subscriptions - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:45.8239507Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:45.8254964Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:45.8255613Z WHERE user.id = ?]
2025-10-08T16:24:45.8255803Z [parameters: (1,)]
2025-10-08T16:24:45.8256080Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:45.8256457Z ======================== 1 failed, 5 warnings in 2.68s =========================
2025-10-08T16:24:46.6403426Z ============================= test session starts ==============================
2025-10-08T16:24:46.6404306Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:46.6404990Z cachedir: .pytest_cache
2025-10-08T16:24:46.6405334Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:46.6405730Z plugins: anyio-4.11.0
2025-10-08T16:24:46.6784816Z collecting ... collected 14 items
2025-10-08T16:24:46.6785105Z 
2025-10-08T16:24:47.9560355Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationSecurity::test_constant_time_comparison PASSED [  7%]
2025-10-08T16:24:47.9584696Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationSecurity::test_environment_variable_functions PASSED [ 14%]
2025-10-08T16:24:47.9597960Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationSecurity::test_secret_validation_function PASSED [ 21%]
2025-10-08T16:24:47.9605968Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationSecurity::test_secure_password_generation PASSED [ 28%]
2025-10-08T16:24:47.9614716Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationSecurity::test_user_input_sanitization PASSED [ 35%]
2025-10-08T16:24:48.2494808Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_admin_routes_exist PASSED [ 42%]
2025-10-08T16:24:48.2503927Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_private_registration_functions_exist PASSED [ 50%]
2025-10-08T16:24:48.2511877Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_require_private_registration_auth_decorator PASSED [ 57%]
2025-10-08T16:24:48.2519547Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_schema_classes_exist PASSED [ 64%]
2025-10-08T16:24:48.2527674Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_validation_function_components PASSED [ 71%]
2025-10-08T16:24:48.2556591Z tests/test_private_registration_security_simple.py::TestSecurityProtocolCompliance::test_error_handling_security PASSED [ 78%]
2025-10-08T16:24:48.2574251Z tests/test_private_registration_security_simple.py::TestSecurityProtocolCompliance::test_feature_toggle_security PASSED [ 85%]
2025-10-08T16:24:48.2584897Z tests/test_private_registration_security_simple.py::TestSecurityProtocolCompliance::test_ip_whitelist_function_exists PASSED [ 92%]
2025-10-08T16:24:48.7570289Z tests/test_private_registration_security_simple.py::TestSecurityProtocolCompliance::test_secret_environment_priority PASSED [100%]
2025-10-08T16:24:48.7571175Z 
2025-10-08T16:24:48.7571372Z =============================== warnings summary ===============================
2025-10-08T16:24:48.7572231Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_admin_routes_exist
2025-10-08T16:24:48.7574049Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:48.7575496Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:48.7575811Z 
2025-10-08T16:24:48.7576334Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_admin_routes_exist
2025-10-08T16:24:48.7578075Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:48.7579674Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:48.7579998Z 
2025-10-08T16:24:48.7580496Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_admin_routes_exist
2025-10-08T16:24:48.7581974Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:48.7583331Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:48.7583827Z 
2025-10-08T16:24:48.7584339Z tests/test_private_registration_security_simple.py::TestPrivateRegistrationEndpoints::test_admin_routes_exist
2025-10-08T16:24:48.7585767Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:48.7587073Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:48.7587564Z 
2025-10-08T16:24:48.7587859Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:48.7588474Z ======================== 14 passed, 4 warnings in 1.63s ========================
2025-10-08T16:24:49.4421465Z ============================= test session starts ==============================
2025-10-08T16:24:49.4422432Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:49.4423280Z cachedir: .pytest_cache
2025-10-08T16:24:49.4423726Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:49.4424191Z plugins: anyio-4.11.0
2025-10-08T16:24:49.5640821Z collecting ... collected 3 items
2025-10-08T16:24:49.5641117Z 
2025-10-08T16:24:50.7473357Z tests/test_explore_real_world.py::test_explore_page_shows_topics_and_communities ERROR [ 33%]
2025-10-08T16:24:50.8076683Z tests/test_explore_real_world.py::test_explore_page_empty_database ERROR [ 66%]
2025-10-08T16:24:51.1478599Z tests/test_explore_real_world.py::test_explore_template_syntax_not_exposed ERROR [100%]
2025-10-08T16:24:51.1480153Z 
2025-10-08T16:24:51.1480880Z ==================================== ERRORS ====================================
2025-10-08T16:24:51.1481760Z _______ ERROR at setup of test_explore_page_shows_topics_and_communities _______
2025-10-08T16:24:51.1482392Z 
2025-10-08T16:24:51.1482585Z     @pytest.fixture(scope='module')
2025-10-08T16:24:51.1482899Z     def app():
2025-10-08T16:24:51.1483215Z         """Create a fully configured test application with database."""
2025-10-08T16:24:51.1483613Z         from app import create_app, db
2025-10-08T16:24:51.1484001Z         from app.models import Site, Instance, User, Topic, Community
2025-10-08T16:24:51.1484367Z     
2025-10-08T16:24:51.1484673Z         # Patch PostgreSQL-specific functions that don't work in SQLite
2025-10-08T16:24:51.1485142Z >       with patch('app.models.db.engine.execute') as mock_execute:
2025-10-08T16:24:51.1485521Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1485727Z 
2025-10-08T16:24:51.1485838Z tests/test_explore_real_world.py:35: 
2025-10-08T16:24:51.1486182Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1486714Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1481: in __enter__
2025-10-08T16:24:51.1487221Z     self.target = self.getter()
2025-10-08T16:24:51.1487487Z                   ^^^^^^^^^^^^^
2025-10-08T16:24:51.1487912Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/pkgutil.py:528: in resolve_name
2025-10-08T16:24:51.1488391Z     result = getattr(result, p)
2025-10-08T16:24:51.1488653Z              ^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1489380Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:709: in engine
2025-10-08T16:24:51.1489975Z     return self.engines[None]
2025-10-08T16:24:51.1490233Z            ^^^^^^^^^^^^
2025-10-08T16:24:51.1490762Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:687: in engines
2025-10-08T16:24:51.1491456Z     app = current_app._get_current_object()  # type: ignore[attr-defined]
2025-10-08T16:24:51.1491867Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1492191Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1492429Z 
2025-10-08T16:24:51.1492545Z     def _get_current_object() -> T:
2025-10-08T16:24:51.1492821Z         try:
2025-10-08T16:24:51.1493037Z             obj = local.get()
2025-10-08T16:24:51.1493306Z         except LookupError:
2025-10-08T16:24:51.1493606Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:51.1493960Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1494272Z E           
2025-10-08T16:24:51.1494569Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1495029Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:51.1495460Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1495715Z 
2025-10-08T16:24:51.1496022Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:51.1496569Z ______________ ERROR at setup of test_explore_page_empty_database ______________
2025-10-08T16:24:51.1496826Z 
2025-10-08T16:24:51.1496920Z     @pytest.fixture(scope='module')
2025-10-08T16:24:51.1497160Z     def app():
2025-10-08T16:24:51.1497585Z         """Create a fully configured test application with database."""
2025-10-08T16:24:51.1497923Z         from app import create_app, db
2025-10-08T16:24:51.1498239Z         from app.models import Site, Instance, User, Topic, Community
2025-10-08T16:24:51.1498540Z     
2025-10-08T16:24:51.1498789Z         # Patch PostgreSQL-specific functions that don't work in SQLite
2025-10-08T16:24:51.1499294Z >       with patch('app.models.db.engine.execute') as mock_execute:
2025-10-08T16:24:51.1499612Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1499907Z 
2025-10-08T16:24:51.1500012Z tests/test_explore_real_world.py:35: 
2025-10-08T16:24:51.1500290Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1500737Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1481: in __enter__
2025-10-08T16:24:51.1501148Z     self.target = self.getter()
2025-10-08T16:24:51.1501367Z                   ^^^^^^^^^^^^^
2025-10-08T16:24:51.1501744Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/pkgutil.py:528: in resolve_name
2025-10-08T16:24:51.1502131Z     result = getattr(result, p)
2025-10-08T16:24:51.1502343Z              ^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1502782Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:709: in engine
2025-10-08T16:24:51.1503260Z     return self.engines[None]
2025-10-08T16:24:51.1503475Z            ^^^^^^^^^^^^
2025-10-08T16:24:51.1503899Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:687: in engines
2025-10-08T16:24:51.1504479Z     app = current_app._get_current_object()  # type: ignore[attr-defined]
2025-10-08T16:24:51.1504809Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1505080Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1505273Z 
2025-10-08T16:24:51.1505369Z     def _get_current_object() -> T:
2025-10-08T16:24:51.1505604Z         try:
2025-10-08T16:24:51.1505789Z             obj = local.get()
2025-10-08T16:24:51.1506007Z         except LookupError:
2025-10-08T16:24:51.1506258Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:51.1506593Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1506874Z E           
2025-10-08T16:24:51.1507158Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1507604Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:51.1508030Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1508274Z 
2025-10-08T16:24:51.1508568Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:51.1509228Z __________ ERROR at setup of test_explore_template_syntax_not_exposed __________
2025-10-08T16:24:51.1509494Z 
2025-10-08T16:24:51.1509585Z     @pytest.fixture(scope='module')
2025-10-08T16:24:51.1509819Z     def app():
2025-10-08T16:24:51.1510076Z         """Create a fully configured test application with database."""
2025-10-08T16:24:51.1510397Z         from app import create_app, db
2025-10-08T16:24:51.1510709Z         from app.models import Site, Instance, User, Topic, Community
2025-10-08T16:24:51.1511000Z     
2025-10-08T16:24:51.1511249Z         # Patch PostgreSQL-specific functions that don't work in SQLite
2025-10-08T16:24:51.1511635Z >       with patch('app.models.db.engine.execute') as mock_execute:
2025-10-08T16:24:51.1511946Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1512118Z 
2025-10-08T16:24:51.1512210Z tests/test_explore_real_world.py:35: 
2025-10-08T16:24:51.1512481Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1512915Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/unittest/mock.py:1481: in __enter__
2025-10-08T16:24:51.1513310Z     self.target = self.getter()
2025-10-08T16:24:51.1513645Z                   ^^^^^^^^^^^^^
2025-10-08T16:24:51.1514000Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/pkgutil.py:528: in resolve_name
2025-10-08T16:24:51.1514377Z     result = getattr(result, p)
2025-10-08T16:24:51.1514586Z              ^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1515022Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:709: in engine
2025-10-08T16:24:51.1515503Z     return self.engines[None]
2025-10-08T16:24:51.1515711Z            ^^^^^^^^^^^^
2025-10-08T16:24:51.1516247Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask_sqlalchemy/extension.py:687: in engines
2025-10-08T16:24:51.1516809Z     app = current_app._get_current_object()  # type: ignore[attr-defined]
2025-10-08T16:24:51.1517131Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:51.1517396Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:51.1517595Z 
2025-10-08T16:24:51.1517684Z     def _get_current_object() -> T:
2025-10-08T16:24:51.1517913Z         try:
2025-10-08T16:24:51.1518090Z             obj = local.get()
2025-10-08T16:24:51.1518310Z         except LookupError:
2025-10-08T16:24:51.1518564Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:24:51.1518896Z E           RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1519285Z E           
2025-10-08T16:24:51.1519569Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1520029Z E           the current application. To solve this, set up an application context
2025-10-08T16:24:51.1520446Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1520698Z 
2025-10-08T16:24:51.1521007Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:24:51.1521498Z =========================== short test summary info ============================
2025-10-08T16:24:51.1522111Z ERROR tests/test_explore_real_world.py::test_explore_page_shows_topics_and_communities - RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1522588Z 
2025-10-08T16:24:51.1522768Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1523205Z the current application. To solve this, set up an application context
2025-10-08T16:24:51.1523611Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1524201Z ERROR tests/test_explore_real_world.py::test_explore_page_empty_database - RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1524629Z 
2025-10-08T16:24:51.1524808Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1525238Z the current application. To solve this, set up an application context
2025-10-08T16:24:51.1525640Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1526243Z ERROR tests/test_explore_real_world.py::test_explore_template_syntax_not_exposed - RuntimeError: Working outside of application context.
2025-10-08T16:24:51.1526701Z 
2025-10-08T16:24:51.1526880Z This typically means that you attempted to use functionality that needed
2025-10-08T16:24:51.1527303Z the current application. To solve this, set up an application context
2025-10-08T16:24:51.1527698Z with app.app_context(). See the documentation for more information.
2025-10-08T16:24:51.1528046Z ============================== 3 errors in 1.44s ===============================
2025-10-08T16:24:51.6068740Z ============================= test session starts ==============================
2025-10-08T16:24:51.6070132Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:51.6071108Z cachedir: .pytest_cache
2025-10-08T16:24:51.6071595Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:51.6082086Z plugins: anyio-4.11.0
2025-10-08T16:24:52.6671954Z collecting ... collected 1 item
2025-10-08T16:24:52.6672584Z 
2025-10-08T16:24:54.2231890Z tests/test_api_instance_blocks.py::test_api_instance_blocks FAILED       [100%]
2025-10-08T16:24:54.2232552Z 
2025-10-08T16:24:54.2232750Z =================================== FAILURES ===================================
2025-10-08T16:24:54.2233405Z ___________________________ test_api_instance_blocks ___________________________
2025-10-08T16:24:54.2233852Z 
2025-10-08T16:24:54.2234191Z self = <sqlalchemy.engine.base.Connection object at 0x7f841aefba80>
2025-10-08T16:24:54.2235557Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f84247902f0>
2025-10-08T16:24:54.2236729Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f841a940b90>
2025-10-08T16:24:54.2237758Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f841af59400>
2025-10-08T16:24:54.2238440Z parameters = [(1,)]
2025-10-08T16:24:54.2238630Z 
2025-10-08T16:24:54.2238759Z     def _exec_single_context(
2025-10-08T16:24:54.2239346Z         self,
2025-10-08T16:24:54.2239656Z         dialect: Dialect,
2025-10-08T16:24:54.2240005Z         context: ExecutionContext,
2025-10-08T16:24:54.2240385Z         statement: Union[str, Compiled],
2025-10-08T16:24:54.2240830Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:24:54.2241266Z     ) -> CursorResult[Any]:
2025-10-08T16:24:54.2241700Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:24:54.2242238Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:24:54.2242629Z     
2025-10-08T16:24:54.2242868Z         """
2025-10-08T16:24:54.2243214Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:24:54.2243777Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:24:54.2244240Z     
2025-10-08T16:24:54.2244520Z             if generic_setinputsizes:
2025-10-08T16:24:54.2244871Z                 try:
2025-10-08T16:24:54.2245190Z                     dialect.do_set_input_sizes(
2025-10-08T16:24:54.2245663Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:24:54.2246087Z                     )
2025-10-08T16:24:54.2246392Z                 except BaseException as e:
2025-10-08T16:24:54.2246801Z                     self._handle_dbapi_exception(
2025-10-08T16:24:54.2247249Z                         e, str(statement), parameters, None, context
2025-10-08T16:24:54.2247650Z                     )
2025-10-08T16:24:54.2247932Z     
2025-10-08T16:24:54.2248203Z         cursor, str_statement, parameters = (
2025-10-08T16:24:54.2248581Z             context.cursor,
2025-10-08T16:24:54.2248900Z             context.statement,
2025-10-08T16:24:54.2249447Z             context.parameters,
2025-10-08T16:24:54.2249772Z         )
2025-10-08T16:24:54.2250004Z     
2025-10-08T16:24:54.2250329Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:24:54.2250742Z     
2025-10-08T16:24:54.2250993Z         if not context.executemany:
2025-10-08T16:24:54.2251390Z             effective_parameters = parameters[0]
2025-10-08T16:24:54.2251764Z         else:
2025-10-08T16:24:54.2252049Z             effective_parameters = parameters
2025-10-08T16:24:54.2252417Z     
2025-10-08T16:24:54.2252716Z         if self._has_events or self.engine._has_events:
2025-10-08T16:24:54.2253191Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:24:54.2253657Z                 str_statement, effective_parameters = fn(
2025-10-08T16:24:54.2254059Z                     self,
2025-10-08T16:24:54.2254344Z                     cursor,
2025-10-08T16:24:54.2254648Z                     str_statement,
2025-10-08T16:24:54.2254997Z                     effective_parameters,
2025-10-08T16:24:54.2255361Z                     context,
2025-10-08T16:24:54.2255689Z                     context.executemany,
2025-10-08T16:24:54.2256035Z                 )
2025-10-08T16:24:54.2256286Z     
2025-10-08T16:24:54.2256519Z         if self._echo:
2025-10-08T16:24:54.2257072Z             self._log_info(str_statement)
2025-10-08T16:24:54.2257453Z     
2025-10-08T16:24:54.2257717Z             stats = context._get_cache_stats()
2025-10-08T16:24:54.2258074Z     
2025-10-08T16:24:54.2258358Z             if not self.engine.hide_parameters:
2025-10-08T16:24:54.2258734Z                 self._log_info(
2025-10-08T16:24:54.2259205Z                     "[%s] %r",
2025-10-08T16:24:54.2259528Z                     stats,
2025-10-08T16:24:54.2259844Z                     sql_util._repr_params(
2025-10-08T16:24:54.2260415Z                         effective_parameters,
2025-10-08T16:24:54.2260781Z                         batches=10,
2025-10-08T16:24:54.2261141Z                         ismulti=context.executemany,
2025-10-08T16:24:54.2261501Z                     ),
2025-10-08T16:24:54.2261774Z                 )
2025-10-08T16:24:54.2262024Z             else:
2025-10-08T16:24:54.2262284Z                 self._log_info(
2025-10-08T16:24:54.2262725Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:24:54.2263183Z                     stats,
2025-10-08T16:24:54.2263456Z                 )
2025-10-08T16:24:54.2263709Z     
2025-10-08T16:24:54.2263966Z         evt_handled: bool = False
2025-10-08T16:24:54.2264305Z         try:
2025-10-08T16:24:54.2264659Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:24:54.2265137Z                 effective_parameters = cast(
2025-10-08T16:24:54.2265591Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:24:54.2266012Z                 )
2025-10-08T16:24:54.2266300Z                 if self.dialect._has_events:
2025-10-08T16:24:54.2266729Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:24:54.2267140Z                         if fn(
2025-10-08T16:24:54.2267454Z                             cursor,
2025-10-08T16:24:54.2267807Z                             str_statement,
2025-10-08T16:24:54.2268180Z                             effective_parameters,
2025-10-08T16:24:54.2268553Z                             context,
2025-10-08T16:24:54.2268876Z                         ):
2025-10-08T16:24:54.2269400Z                             evt_handled = True
2025-10-08T16:24:54.2269762Z                             break
2025-10-08T16:24:54.2270085Z                 if not evt_handled:
2025-10-08T16:24:54.2270466Z                     self.dialect.do_executemany(
2025-10-08T16:24:54.2270846Z                         cursor,
2025-10-08T16:24:54.2271177Z                         str_statement,
2025-10-08T16:24:54.2271555Z                         effective_parameters,
2025-10-08T16:24:54.2271919Z                         context,
2025-10-08T16:24:54.2272240Z                     )
2025-10-08T16:24:54.2272626Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:24:54.2273100Z                 if self.dialect._has_events:
2025-10-08T16:24:54.2273561Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:24:54.2274063Z                         if fn(cursor, str_statement, context):
2025-10-08T16:24:54.2274481Z                             evt_handled = True
2025-10-08T16:24:54.2274836Z                             break
2025-10-08T16:24:54.2275165Z                 if not evt_handled:
2025-10-08T16:24:54.2275544Z                     self.dialect.do_execute_no_params(
2025-10-08T16:24:54.2275937Z                         cursor, str_statement, context
2025-10-08T16:24:54.2276305Z                     )
2025-10-08T16:24:54.2276590Z             else:
2025-10-08T16:24:54.2276890Z                 effective_parameters = cast(
2025-10-08T16:24:54.2277323Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:24:54.2277759Z                 )
2025-10-08T16:24:54.2278063Z                 if self.dialect._has_events:
2025-10-08T16:24:54.2278485Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:24:54.2278897Z                         if fn(
2025-10-08T16:24:54.2279511Z                             cursor,
2025-10-08T16:24:54.2279884Z                             str_statement,
2025-10-08T16:24:54.2280275Z                             effective_parameters,
2025-10-08T16:24:54.2280648Z                             context,
2025-10-08T16:24:54.2280979Z                         ):
2025-10-08T16:24:54.2281283Z                             evt_handled = True
2025-10-08T16:24:54.2281642Z                             break
2025-10-08T16:24:54.2281969Z                 if not evt_handled:
2025-10-08T16:24:54.2282481Z >                   self.dialect.do_execute(
2025-10-08T16:24:54.2282922Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:24:54.2283353Z                     )
2025-10-08T16:24:54.2283531Z 
2025-10-08T16:24:54.2283968Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:24:54.2284730Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:54.2285052Z 
2025-10-08T16:24:54.2285460Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f84247902f0>
2025-10-08T16:24:54.2286171Z cursor = <sqlite3.Cursor object at 0x7f841a931bc0>
2025-10-08T16:24:54.2287445Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:54.2288669Z parameters = (1,)
2025-10-08T16:24:54.2289433Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f841a940b90>
2025-10-08T16:24:54.2289978Z 
2025-10-08T16:24:54.2290227Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:54.2290732Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:54.2291184Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:24:54.2291491Z 
2025-10-08T16:24:54.2292034Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:54.2292691Z 
2025-10-08T16:24:54.2292949Z The above exception was the direct cause of the following exception:
2025-10-08T16:24:54.2293332Z 
2025-10-08T16:24:54.2293448Z app = <Flask 'app'>
2025-10-08T16:24:54.2293631Z 
2025-10-08T16:24:54.2293767Z     def test_api_instance_blocks(app):
2025-10-08T16:24:54.2294148Z         with app.app_context():
2025-10-08T16:24:54.2294572Z             from app.api.alpha.utils.site import post_site_block
2025-10-08T16:24:54.2295096Z             from app.api.alpha.utils.post import get_post_list
2025-10-08T16:24:54.2295512Z     
2025-10-08T16:24:54.2295753Z             user_id = 1
2025-10-08T16:24:54.2296065Z >           user = User.query.get(user_id)
2025-10-08T16:24:54.2296431Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:54.2296701Z 
2025-10-08T16:24:54.2296849Z tests/test_api_instance_blocks.py:30: 
2025-10-08T16:24:54.2297270Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:54.2297689Z <string>:2: in get
2025-10-08T16:24:54.2297951Z     ???
2025-10-08T16:24:54.2298590Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:24:54.2299613Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:24:54.2300052Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:54.2300704Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:24:54.2301534Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:24:54.2302004Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:24:54.2302789Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:24:54.2303550Z     return self.session._get_impl(
2025-10-08T16:24:54.2304460Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:24:54.2305221Z     return db_load_fn(
2025-10-08T16:24:54.2305936Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:24:54.2306723Z     session.execute(
2025-10-08T16:24:54.2307358Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:24:54.2308234Z     return self._execute_internal(
2025-10-08T16:24:54.2309001Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:24:54.2310036Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:24:54.2310931Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:24:54.2311763Z     result = conn.execute(
2025-10-08T16:24:54.2312439Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:24:54.2313155Z     return meth(
2025-10-08T16:24:54.2313879Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:24:54.2314723Z     return connection._execute_clauseelement(
2025-10-08T16:24:54.2315572Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:24:54.2316388Z     ret = self._execute_context(
2025-10-08T16:24:54.2317137Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:24:54.2317988Z     return self._exec_single_context(
2025-10-08T16:24:54.2318776Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:24:54.2319713Z     self._handle_dbapi_exception(
2025-10-08T16:24:54.2320508Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:24:54.2321405Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:24:54.2322275Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:24:54.2323074Z     self.dialect.do_execute(
2025-10-08T16:24:54.2323456Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:24:54.2323763Z 
2025-10-08T16:24:54.2324173Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f84247902f0>
2025-10-08T16:24:54.2324870Z cursor = <sqlite3.Cursor object at 0x7f841a931bc0>
2025-10-08T16:24:54.2326126Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:24:54.2327363Z parameters = (1,)
2025-10-08T16:24:54.2327934Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f841a940b90>
2025-10-08T16:24:54.2328506Z 
2025-10-08T16:24:54.2328750Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:24:54.2329486Z >       cursor.execute(statement, parameters)
2025-10-08T16:24:54.2330144Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:54.2354749Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:54.2376075Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:54.2376757Z E       WHERE user.id = ?]
2025-10-08T16:24:54.2376982Z E       [parameters: (1,)]
2025-10-08T16:24:54.2377294Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:54.2377551Z 
2025-10-08T16:24:54.2377920Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:24:54.2378537Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:24:54.2378870Z INFO     app:__init__.py:298 Started!
2025-10-08T16:24:54.2379397Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:24:54.2379811Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:24:54.2380165Z =============================== warnings summary ===============================
2025-10-08T16:24:54.2380532Z tests/test_api_instance_blocks.py::test_api_instance_blocks
2025-10-08T16:24:54.2381467Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:54.2382369Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:24:54.2382576Z 
2025-10-08T16:24:54.2382729Z tests/test_api_instance_blocks.py::test_api_instance_blocks
2025-10-08T16:24:54.2383637Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:24:54.7769745Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:24:54.7770363Z 
2025-10-08T16:24:54.7770597Z tests/test_api_instance_blocks.py::test_api_instance_blocks
2025-10-08T16:24:54.7771671Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:24:54.7772827Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:54.7773256Z 
2025-10-08T16:24:54.7773460Z tests/test_api_instance_blocks.py::test_api_instance_blocks
2025-10-08T16:24:54.7774517Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:24:54.7775652Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:24:54.7776069Z 
2025-10-08T16:24:54.7776256Z tests/test_api_instance_blocks.py::test_api_instance_blocks
2025-10-08T16:24:54.7778179Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_instance_blocks.py:30: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:24:54.7779937Z     user = User.query.get(user_id)
2025-10-08T16:24:54.7780153Z 
2025-10-08T16:24:54.7780407Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:24:54.7780917Z =========================== short test summary info ============================
2025-10-08T16:24:54.7781803Z FAILED tests/test_api_instance_blocks.py::test_api_instance_blocks - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:24:54.7798194Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:24:54.7813738Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:24:54.7814395Z WHERE user.id = ?]
2025-10-08T16:24:54.7814591Z [parameters: (1,)]
2025-10-08T16:24:54.7814867Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:24:54.7815240Z ======================== 1 failed, 5 warnings in 2.63s =========================
2025-10-08T16:24:55.5686888Z ============================= test session starts ==============================
2025-10-08T16:24:55.5687877Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:55.5688733Z cachedir: .pytest_cache
2025-10-08T16:24:55.5689622Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:55.5690136Z plugins: anyio-4.11.0
2025-10-08T16:24:55.6752627Z collecting ... collected 5 items
2025-10-08T16:24:55.6753030Z 
2025-10-08T16:24:56.6610863Z tests/test_api_endpoints.py::TestCriticalAPIEndpoints::test_api_site_endpoint_exists SKIPPED [ 20%]
2025-10-08T16:24:56.6628165Z tests/test_api_endpoints.py::TestCriticalAPIEndpoints::test_api_site_response_format SKIPPED [ 40%]
2025-10-08T16:24:56.6643959Z tests/test_api_endpoints.py::TestActivityPubEndpoints::test_community_activitypub_endpoint SKIPPED [ 60%]
2025-10-08T16:24:56.6658983Z tests/test_api_endpoints.py::TestAPIParameterCompatibility::test_pagination_parameters SKIPPED [ 80%]
2025-10-08T16:24:56.9586530Z tests/test_api_endpoints.py::TestResponseFieldConsistency::test_site_response_has_expected_structure SKIPPED [100%]
2025-10-08T16:24:56.9587322Z 
2025-10-08T16:24:56.9587524Z ============================== 5 skipped in 1.11s ==============================
2025-10-08T16:24:57.4497805Z ============================= test session starts ==============================
2025-10-08T16:24:57.4498867Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:57.4500262Z cachedir: .pytest_cache
2025-10-08T16:24:57.4500726Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:57.4501197Z plugins: anyio-4.11.0
2025-10-08T16:24:58.7244084Z collecting ... collected 12 items
2025-10-08T16:24:58.7244473Z 
2025-10-08T16:24:58.7269455Z tests/test_activitypub_setup_edge_cases.py::TestFinalizeUserSetupEdgeCases::test_finalize_user_setup_is_idempotent SKIPPED [  8%]
2025-10-08T16:24:58.7285351Z tests/test_activitypub_setup_edge_cases.py::TestFinalizeUserSetupEdgeCases::test_finalize_user_setup_with_partial_setup SKIPPED [ 16%]
2025-10-08T16:24:58.7300390Z tests/test_activitypub_setup_edge_cases.py::TestFinalizeUserSetupEdgeCases::test_finalize_user_setup_marks_registration_notifications_read SKIPPED [ 25%]
2025-10-08T16:24:58.7315297Z tests/test_activitypub_setup_edge_cases.py::TestFinalizeUserSetupEdgeCases::test_finalize_user_setup_with_plugin_hook SKIPPED [ 33%]
2025-10-08T16:24:58.7330347Z tests/test_activitypub_setup_edge_cases.py::TestStartupValidationErrorHandling::test_validation_continues_after_individual_user_failure SKIPPED [ 41%]
2025-10-08T16:24:58.7345841Z tests/test_activitypub_setup_edge_cases.py::TestStartupValidationErrorHandling::test_validation_handles_database_errors_gracefully SKIPPED [ 50%]
2025-10-08T16:24:58.7360542Z tests/test_activitypub_setup_edge_cases.py::TestStartupValidationErrorHandling::test_validation_logs_errors_for_failed_users SKIPPED [ 58%]
2025-10-08T16:24:58.7378401Z tests/test_activitypub_setup_edge_cases.py::TestActivityPubURLFormatting::test_username_with_special_characters SKIPPED [ 66%]
2025-10-08T16:24:58.7393003Z tests/test_activitypub_setup_edge_cases.py::TestActivityPubURLFormatting::test_username_case_handling_in_urls SKIPPED [ 75%]
2025-10-08T16:24:58.7407237Z tests/test_activitypub_setup_edge_cases.py::TestStartupValidationPerformance::test_validation_with_many_complete_users_is_fast SKIPPED [ 83%]
2025-10-08T16:24:58.7421760Z tests/test_activitypub_setup_edge_cases.py::TestStartupValidationPerformance::test_validation_result_includes_user_summary SKIPPED [ 91%]
2025-10-08T16:24:59.1222432Z tests/test_activitypub_setup_edge_cases.py::TestRegistrationNotificationCleanup::test_finalize_marks_only_registration_notifications SKIPPED [100%]
2025-10-08T16:24:59.1223147Z 
2025-10-08T16:24:59.1223319Z ============================= 12 skipped in 1.30s ==============================
2025-10-08T16:24:59.6704328Z ============================= test session starts ==============================
2025-10-08T16:24:59.6705353Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:24:59.6706217Z cachedir: .pytest_cache
2025-10-08T16:24:59.6706654Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:24:59.6707102Z plugins: anyio-4.11.0
2025-10-08T16:24:59.7887745Z collecting ... collected 3 items
2025-10-08T16:24:59.7888133Z 
2025-10-08T16:25:01.8313363Z tests/test_explore_page_integration.py::test_explore_route_responds FAILED [ 33%]
2025-10-08T16:25:02.3733837Z tests/test_explore_page_integration.py::test_explore_route_with_mock_topics FAILED [ 66%]
2025-10-08T16:25:02.3754482Z tests/test_explore_page_integration.py::test_explore_template_jinja_syntax PASSED [100%]
2025-10-08T16:25:02.3755235Z 
2025-10-08T16:25:02.3755465Z =================================== FAILURES ===================================
2025-10-08T16:25:02.3756140Z _________________________ test_explore_route_responds __________________________
2025-10-08T16:25:02.3756449Z 
2025-10-08T16:25:02.3756602Z     def test_explore_route_responds():
2025-10-08T16:25:02.3756995Z         """Test that the explore route responds without crashing."""
2025-10-08T16:25:02.3757392Z         from app import create_app
2025-10-08T16:25:02.3757670Z     
2025-10-08T16:25:02.3757877Z         app = create_app()
2025-10-08T16:25:02.3758156Z         app.config['TESTING'] = True
2025-10-08T16:25:02.3758496Z         app.config['WTF_CSRF_ENABLED'] = False
2025-10-08T16:25:02.3758835Z     
2025-10-08T16:25:02.3759711Z         with app.test_client() as client:
2025-10-08T16:25:02.3760203Z             # Mock the topic_tree function to return empty list (simulating no topics)
2025-10-08T16:25:02.3760740Z             with patch('app.main.routes.topic_tree') as mock_topic_tree:
2025-10-08T16:25:02.3761167Z                 mock_topic_tree.return_value = []
2025-10-08T16:25:02.3761478Z     
2025-10-08T16:25:02.3761738Z                 # Mock the menu functions to return empty lists
2025-10-08T16:25:02.3762240Z                 with patch('app.main.routes.menu_instance_feeds') as mock_instance_feeds, \
2025-10-08T16:25:02.3762882Z                      patch('app.main.routes.menu_my_feeds') as mock_my_feeds, \
2025-10-08T16:25:02.3763292Z                      patch('app.main.routes.menu_subscribed_feeds') as mock_subscribed_feeds:
2025-10-08T16:25:02.3763625Z     
2025-10-08T16:25:02.3763822Z                     mock_instance_feeds.return_value = []
2025-10-08T16:25:02.3764101Z                     mock_my_feeds.return_value = []
2025-10-08T16:25:02.3764393Z                     mock_subscribed_feeds.return_value = []
2025-10-08T16:25:02.3764643Z     
2025-10-08T16:25:02.3764836Z >                   response = client.get('/explore')
2025-10-08T16:25:02.3765097Z                                ^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3765262Z 
2025-10-08T16:25:02.3765373Z tests/test_explore_page_integration.py:45: 
2025-10-08T16:25:02.3765679Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:02.3766156Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1162: in get
2025-10-08T16:25:02.3766597Z     return self.open(*args, **kw)
2025-10-08T16:25:02.3766830Z            ^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3767236Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/testing.py:235: in open
2025-10-08T16:25:02.3767662Z     response = super().open(
2025-10-08T16:25:02.3768073Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1116: in open
2025-10-08T16:25:02.3768632Z     response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
2025-10-08T16:25:02.3768989Z                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3769610Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:988: in run_wsgi_app
2025-10-08T16:25:02.3770142Z     rv = run_wsgi_app(self.application, environ, buffered=buffered)
2025-10-08T16:25:02.3770465Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3770916Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1264: in run_wsgi_app
2025-10-08T16:25:02.3771388Z     app_rv = app(environ, start_response)
2025-10-08T16:25:02.3771642Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3772062Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1536: in __call__
2025-10-08T16:25:02.3772521Z     return self.wsgi_app(environ, start_response)
2025-10-08T16:25:02.3772794Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3773289Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/middleware/proxy_fix.py:183: in __call__
2025-10-08T16:25:02.3773814Z     return self.app(environ, start_response)
2025-10-08T16:25:02.3774073Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3774495Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1514: in wsgi_app
2025-10-08T16:25:02.3774945Z     response = self.handle_exception(e)
2025-10-08T16:25:02.3775186Z                ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3775594Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1511: in wsgi_app
2025-10-08T16:25:02.3776037Z     response = self.full_dispatch_request()
2025-10-08T16:25:02.3776299Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3776872Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:919: in full_dispatch_request
2025-10-08T16:25:02.3777354Z     rv = self.handle_user_exception(e)
2025-10-08T16:25:02.3777593Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3778041Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:917: in full_dispatch_request
2025-10-08T16:25:02.3778505Z     rv = self.dispatch_request()
2025-10-08T16:25:02.3778730Z          ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3779262Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:902: in dispatch_request
2025-10-08T16:25:02.3780021Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-10-08T16:25:02.3780466Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3780737Z app/utils.py:1081: in decorated_view
2025-10-08T16:25:02.3781239Z     if (g.site.private_instance and current_user.is_authenticated) or is_activitypub_request() or g.site.private_instance is False:
2025-10-08T16:25:02.3781718Z         ^^^^^^
2025-10-08T16:25:02.3781938Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:02.3782133Z 
2025-10-08T16:25:02.3782313Z self = <flask.ctx._AppCtxGlobals object at 0x7f0c2b9f7110>, name = 'site'
2025-10-08T16:25:02.3782571Z 
2025-10-08T16:25:02.3782685Z     def __getattr__(self, name: str) -> t.Any:
2025-10-08T16:25:02.3782930Z         try:
2025-10-08T16:25:02.3783124Z             return self.__dict__[name]
2025-10-08T16:25:02.3783364Z         except KeyError:
2025-10-08T16:25:02.3783591Z >           raise AttributeError(name) from None
2025-10-08T16:25:02.3783851Z E           AttributeError: site
2025-10-08T16:25:02.3783998Z 
2025-10-08T16:25:02.3784288Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/ctx.py:56: AttributeError
2025-10-08T16:25:02.3784802Z ------------------------------ Captured log call -------------------------------
2025-10-08T16:25:02.3785128Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:02.3785454Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:02.3785854Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:02.3786238Z _____________________ test_explore_route_with_mock_topics ______________________
2025-10-08T16:25:02.3786482Z 
2025-10-08T16:25:02.3786582Z     def test_explore_route_with_mock_topics():
2025-10-08T16:25:02.3786900Z         """Test that the explore route works when topics exist."""
2025-10-08T16:25:02.3787204Z         from app import create_app
2025-10-08T16:25:02.3787416Z     
2025-10-08T16:25:02.3787585Z         app = create_app()
2025-10-08T16:25:02.3787807Z         app.config['TESTING'] = True
2025-10-08T16:25:02.3788054Z         app.config['WTF_CSRF_ENABLED'] = False
2025-10-08T16:25:02.3788289Z     
2025-10-08T16:25:02.3788455Z         # Mock topic object
2025-10-08T16:25:02.3788664Z         class MockTopic:
2025-10-08T16:25:02.3788901Z             def __init__(self, name, parent_id=None):
2025-10-08T16:25:02.3789311Z                 self.name = name
2025-10-08T16:25:02.3789541Z                 self.parent_id = parent_id
2025-10-08T16:25:02.3789808Z                 self.id = hash(name)  # Simple ID
2025-10-08T16:25:02.3790047Z     
2025-10-08T16:25:02.3790206Z             def path(self):
2025-10-08T16:25:02.3790448Z                 return self.name.lower().replace(' ', '-')
2025-10-08T16:25:02.3790703Z     
2025-10-08T16:25:02.3790874Z         # Create mock topic tree
2025-10-08T16:25:02.3791091Z         mock_topics = [
2025-10-08T16:25:02.3791282Z             {
2025-10-08T16:25:02.3791478Z                 'topic': MockTopic('Technology'),
2025-10-08T16:25:02.3791728Z                 'children': [
2025-10-08T16:25:02.3791941Z                     {
2025-10-08T16:25:02.3792162Z                         'topic': MockTopic('Programming'),
2025-10-08T16:25:02.3792428Z                         'children': []
2025-10-08T16:25:02.3792778Z                     }
2025-10-08T16:25:02.3792967Z                 ]
2025-10-08T16:25:02.3793138Z             },
2025-10-08T16:25:02.3793307Z             {
2025-10-08T16:25:02.3793505Z                 'topic': MockTopic('Science'),
2025-10-08T16:25:02.3793757Z                 'children': []
2025-10-08T16:25:02.3793954Z             }
2025-10-08T16:25:02.3794118Z         ]
2025-10-08T16:25:02.3794276Z     
2025-10-08T16:25:02.3794449Z         with app.test_client() as client:
2025-10-08T16:25:02.3794887Z             with patch('app.main.routes.topic_tree') as mock_topic_tree:
2025-10-08T16:25:02.3795265Z                 mock_topic_tree.return_value = mock_topics
2025-10-08T16:25:02.3795515Z     
2025-10-08T16:25:02.3795694Z                 # Mock the menu functions
2025-10-08T16:25:02.3796080Z                 with patch('app.main.routes.menu_instance_feeds') as mock_instance_feeds, \
2025-10-08T16:25:02.3796506Z                      patch('app.main.routes.menu_my_feeds') as mock_my_feeds, \
2025-10-08T16:25:02.3796935Z                      patch('app.main.routes.menu_subscribed_feeds') as mock_subscribed_feeds:
2025-10-08T16:25:02.3797269Z     
2025-10-08T16:25:02.3797465Z                     mock_instance_feeds.return_value = []
2025-10-08T16:25:02.3797743Z                     mock_my_feeds.return_value = []
2025-10-08T16:25:02.3798028Z                     mock_subscribed_feeds.return_value = []
2025-10-08T16:25:02.3798276Z     
2025-10-08T16:25:02.3798461Z >                   response = client.get('/explore')
2025-10-08T16:25:02.3798731Z                                ^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3798893Z 
2025-10-08T16:25:02.3799012Z tests/test_explore_page_integration.py:125: 
2025-10-08T16:25:02.3799578Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:02.3800049Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1162: in get
2025-10-08T16:25:02.3800488Z     return self.open(*args, **kw)
2025-10-08T16:25:02.3800727Z            ^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3801122Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/testing.py:235: in open
2025-10-08T16:25:02.3801552Z     response = super().open(
2025-10-08T16:25:02.3801958Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1116: in open
2025-10-08T16:25:02.3802485Z     response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
2025-10-08T16:25:02.3802842Z                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3803311Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:988: in run_wsgi_app
2025-10-08T16:25:02.3803836Z     rv = run_wsgi_app(self.application, environ, buffered=buffered)
2025-10-08T16:25:02.3804147Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3804621Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/test.py:1264: in run_wsgi_app
2025-10-08T16:25:02.3805102Z     app_rv = app(environ, start_response)
2025-10-08T16:25:02.3805356Z              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3805774Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1536: in __call__
2025-10-08T16:25:02.3806242Z     return self.wsgi_app(environ, start_response)
2025-10-08T16:25:02.3806517Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.3807005Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/middleware/proxy_fix.py:183: in __call__
2025-10-08T16:25:02.3807530Z     return self.app(environ, start_response)
2025-10-08T16:25:02.3807787Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8754849Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1514: in wsgi_app
2025-10-08T16:25:02.8755820Z     response = self.handle_exception(e)
2025-10-08T16:25:02.8756205Z                ^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8757245Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:1511: in wsgi_app
2025-10-08T16:25:02.8757958Z     response = self.full_dispatch_request()
2025-10-08T16:25:02.8758341Z                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8759369Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:919: in full_dispatch_request
2025-10-08T16:25:02.8760212Z     rv = self.handle_user_exception(e)
2025-10-08T16:25:02.8760568Z          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8761473Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:917: in full_dispatch_request
2025-10-08T16:25:02.8762178Z     rv = self.dispatch_request()
2025-10-08T16:25:02.8762447Z          ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8762978Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/app.py:902: in dispatch_request
2025-10-08T16:25:02.8763803Z     return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
2025-10-08T16:25:02.8764353Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:02.8764674Z app/utils.py:1081: in decorated_view
2025-10-08T16:25:02.8765291Z     if (g.site.private_instance and current_user.is_authenticated) or is_activitypub_request() or g.site.private_instance is False:
2025-10-08T16:25:02.8765896Z         ^^^^^^
2025-10-08T16:25:02.8766152Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:02.8766403Z 
2025-10-08T16:25:02.8766612Z self = <flask.ctx._AppCtxGlobals object at 0x7f0c2b871810>, name = 'site'
2025-10-08T16:25:02.8766935Z 
2025-10-08T16:25:02.8767058Z     def __getattr__(self, name: str) -> t.Any:
2025-10-08T16:25:02.8767358Z         try:
2025-10-08T16:25:02.8767574Z             return self.__dict__[name]
2025-10-08T16:25:02.8767864Z         except KeyError:
2025-10-08T16:25:02.8768137Z >           raise AttributeError(name) from None
2025-10-08T16:25:02.8768461Z E           AttributeError: site
2025-10-08T16:25:02.8768640Z 
2025-10-08T16:25:02.8768987Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/flask/ctx.py:56: AttributeError
2025-10-08T16:25:02.8769746Z ------------------------------ Captured log call -------------------------------
2025-10-08T16:25:02.8770143Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:02.8770530Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:02.8771021Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:02.8771453Z =============================== warnings summary ===============================
2025-10-08T16:25:02.8771923Z tests/test_explore_page_integration.py::test_explore_route_responds
2025-10-08T16:25:02.8772971Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:02.8773914Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:02.8774123Z 
2025-10-08T16:25:02.8774303Z tests/test_explore_page_integration.py::test_explore_route_responds
2025-10-08T16:25:02.8775260Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:02.8776152Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:02.8776368Z 
2025-10-08T16:25:02.8776541Z tests/test_explore_page_integration.py::test_explore_route_responds
2025-10-08T16:25:02.8777309Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:02.8778143Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:02.8778578Z 
2025-10-08T16:25:02.8778755Z tests/test_explore_page_integration.py::test_explore_route_responds
2025-10-08T16:25:02.8779632Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:02.8780456Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:02.8780759Z 
2025-10-08T16:25:02.8781077Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:02.8781470Z =========================== short test summary info ============================
2025-10-08T16:25:02.8781935Z FAILED tests/test_explore_page_integration.py::test_explore_route_responds - AttributeError: site
2025-10-08T16:25:02.8782552Z FAILED tests/test_explore_page_integration.py::test_explore_route_with_mock_topics - AttributeError: site
2025-10-08T16:25:02.8783057Z =================== 2 failed, 1 passed, 4 warnings in 2.71s ====================
2025-10-08T16:25:03.5960247Z ============================= test session starts ==============================
2025-10-08T16:25:03.5961243Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:03.5961810Z cachedir: .pytest_cache
2025-10-08T16:25:03.5962123Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:03.5962451Z plugins: anyio-4.11.0
2025-10-08T16:25:04.8602331Z collecting ... collected 8 items
2025-10-08T16:25:04.8602634Z 
2025-10-08T16:25:04.8626986Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_session_is_clean_after_startup_validation SKIPPED [ 12%]
2025-10-08T16:25:04.8643606Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_deferred_attributes_load_after_validation SKIPPED [ 25%]
2025-10-08T16:25:04.8658293Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_multiple_queries_after_validation SKIPPED [ 37%]
2025-10-08T16:25:04.8673291Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_session_identity_map_cleared SKIPPED [ 50%]
2025-10-08T16:25:04.8688270Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_validation_with_no_users_to_fix SKIPPED [ 62%]
2025-10-08T16:25:04.8703503Z tests/test_startup_session_cleanup.py::TestStartupSessionCleanup::test_validation_cleanup_handles_errors_gracefully SKIPPED [ 75%]
2025-10-08T16:25:04.8718291Z tests/test_startup_session_cleanup.py::TestSessionCleanupWithAppContext::test_validation_in_app_context_doesnt_pollute_next_context SKIPPED [ 87%]
2025-10-08T16:25:05.2045076Z tests/test_startup_session_cleanup.py::test_session_cleanup_integration SKIPPED [100%]
2025-10-08T16:25:05.2045679Z 
2025-10-08T16:25:05.2045876Z ============================== 8 skipped in 1.29s ==============================
2025-10-08T16:25:05.7349500Z ============================= test session starts ==============================
2025-10-08T16:25:05.7350522Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:05.7351364Z cachedir: .pytest_cache
2025-10-08T16:25:05.7351852Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:05.7352323Z plugins: anyio-4.11.0
2025-10-08T16:25:05.7625542Z collecting ... collected 4 items
2025-10-08T16:25:05.7625895Z 
2025-10-08T16:25:05.8038270Z tests/test_explore_ci_real_world.py::test_explore_template_compiles_correctly PASSED [ 25%]
2025-10-08T16:25:05.8189315Z tests/test_explore_ci_real_world.py::test_explore_renders_with_empty_data PASSED [ 50%]
2025-10-08T16:25:05.8338253Z tests/test_explore_ci_real_world.py::test_explore_renders_with_topics PASSED [ 75%]
2025-10-08T16:25:05.8905022Z tests/test_explore_ci_real_world.py::test_no_template_syntax_in_output PASSED [100%]
2025-10-08T16:25:05.8905412Z 
2025-10-08T16:25:05.8905561Z =============================== warnings summary ===============================
2025-10-08T16:25:05.8906300Z tests/test_explore_ci_real_world.py::test_explore_template_compiles_correctly
2025-10-08T16:25:05.8907567Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_explore_ci_real_world.py::test_explore_template_compiles_correctly returned <class 'bool'>.
2025-10-08T16:25:05.8908741Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:25:05.8909545Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:25:05.8910142Z     warnings.warn(
2025-10-08T16:25:05.8910269Z 
2025-10-08T16:25:05.8910467Z tests/test_explore_ci_real_world.py::test_explore_renders_with_empty_data
2025-10-08T16:25:05.8911513Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_explore_ci_real_world.py::test_explore_renders_with_empty_data returned <class 'bool'>.
2025-10-08T16:25:05.8912472Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:25:05.8912920Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:25:05.8913333Z     warnings.warn(
2025-10-08T16:25:05.8913447Z 
2025-10-08T16:25:05.8913630Z tests/test_explore_ci_real_world.py::test_explore_renders_with_topics
2025-10-08T16:25:05.8914629Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_explore_ci_real_world.py::test_explore_renders_with_topics returned <class 'bool'>.
2025-10-08T16:25:05.8915548Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:25:05.8915986Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:25:05.8916401Z     warnings.warn(
2025-10-08T16:25:05.8916513Z 
2025-10-08T16:25:05.8916698Z tests/test_explore_ci_real_world.py::test_no_template_syntax_in_output
2025-10-08T16:25:05.8917698Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_explore_ci_real_world.py::test_no_template_syntax_in_output returned <class 'bool'>.
2025-10-08T16:25:05.8918628Z   Did you mean to use `assert` instead of `return`?
2025-10-08T16:25:05.8919211Z   See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
2025-10-08T16:25:05.8919639Z     warnings.warn(
2025-10-08T16:25:05.8919750Z 
2025-10-08T16:25:05.8919933Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:05.8920327Z ======================== 4 passed, 4 warnings in 0.14s =========================
2025-10-08T16:25:06.1353388Z ============================= test session starts ==============================
2025-10-08T16:25:06.1354147Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:06.1354721Z cachedir: .pytest_cache
2025-10-08T16:25:06.1355024Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:06.1355356Z plugins: anyio-4.11.0
2025-10-08T16:25:07.1849695Z collecting ... collected 2 items
2025-10-08T16:25:07.1849972Z 
2025-10-08T16:25:10.3930354Z tests/test_migration_heads.py::test_single_migration_head PASSED         [ 50%]
2025-10-08T16:25:13.4680900Z tests/test_migration_heads.py::test_migration_history_linear PASSED      [100%]
2025-10-08T16:25:13.4681559Z 
2025-10-08T16:25:13.4681788Z =============================== warnings summary ===============================
2025-10-08T16:25:13.4682380Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:25:13.4683896Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:13.4685732Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:13.4686067Z 
2025-10-08T16:25:13.4686288Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:25:13.4687762Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:13.4689586Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:13.4690191Z 
2025-10-08T16:25:13.4690402Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:25:13.4691545Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:13.4692857Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:13.4693338Z 
2025-10-08T16:25:13.4693574Z tests/test_migration_heads.py::test_single_migration_head
2025-10-08T16:25:13.4694750Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:13.4696018Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:13.4696516Z 
2025-10-08T16:25:13.4696817Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:13.4697420Z ======================== 2 passed, 4 warnings in 6.82s =========================
2025-10-08T16:25:14.1816200Z ============================= test session starts ==============================
2025-10-08T16:25:14.1816939Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:14.1817502Z cachedir: .pytest_cache
2025-10-08T16:25:14.1817811Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:14.1818169Z plugins: anyio-4.11.0
2025-10-08T16:25:15.6799670Z collecting ... collected 0 items / 1 error
2025-10-08T16:25:15.6800130Z 
2025-10-08T16:25:15.6800357Z ==================================== ERRORS ====================================
2025-10-08T16:25:15.6801049Z ______________ ERROR collecting tests/test_sql_injection_fixes.py ______________
2025-10-08T16:25:15.6801855Z ImportError while importing test module '/home/runner/work/pyfedi/pyfedi/tests/test_sql_injection_fixes.py'.
2025-10-08T16:25:15.6802486Z Hint: make sure your test modules/packages have valid Python names.
2025-10-08T16:25:15.6802813Z Traceback:
2025-10-08T16:25:15.6803189Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/importlib/__init__.py:88: in import_module
2025-10-08T16:25:15.6803697Z     return _bootstrap._gcd_import(name[level:], package, level)
2025-10-08T16:25:15.6804015Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:15.6804305Z tests/test_sql_injection_fixes.py:12: in <module>
2025-10-08T16:25:15.6804672Z     from app.models import User, Conversation, Message, Notification
2025-10-08T16:25:15.6805211Z E   ImportError: cannot import name 'Message' from 'app.models' (/home/runner/work/pyfedi/pyfedi/app/models.py)
2025-10-08T16:25:15.6805708Z =========================== short test summary info ============================
2025-10-08T16:25:15.6806013Z ERROR tests/test_sql_injection_fixes.py
2025-10-08T16:25:15.6806332Z !!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
2025-10-08T16:25:15.6806671Z =============================== 1 error in 1.25s ===============================
2025-10-08T16:25:16.1311118Z ============================= test session starts ==============================
2025-10-08T16:25:16.1311962Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:16.1312659Z cachedir: .pytest_cache
2025-10-08T16:25:16.1313007Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:16.1313699Z plugins: anyio-4.11.0
2025-10-08T16:25:17.4168125Z collecting ... collected 31 items
2025-10-08T16:25:17.4168412Z 
2025-10-08T16:25:17.4230429Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_angle_brackets PASSED [  3%]
2025-10-08T16:25:17.4255327Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_angle_brackets_in_blockquote PASSED [  6%]
2025-10-08T16:25:17.4269564Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_basic_markdown PASSED [  9%]
2025-10-08T16:25:17.4281667Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_blockquote PASSED [ 12%]
2025-10-08T16:25:17.4293816Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_bracketed_links PASSED [ 16%]
2025-10-08T16:25:17.4308016Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_bracketed_links_code_block PASSED [ 19%]
2025-10-08T16:25:17.4320229Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_bracketed_links_inline_code PASSED [ 22%]
2025-10-08T16:25:17.4331304Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_code_block_link PASSED [ 25%]
2025-10-08T16:25:17.4342553Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_code_blocks PASSED [ 29%]
2025-10-08T16:25:17.4357454Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_complex_markdown_with_angle_brackets PASSED [ 32%]
2025-10-08T16:25:17.4368616Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_disallowed_tags PASSED [ 35%]
2025-10-08T16:25:17.4406002Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_double_bold PASSED [ 38%]
2025-10-08T16:25:17.4416683Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_ellipsis PASSED [ 41%]
2025-10-08T16:25:17.4427187Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_em_dash PASSED  [ 45%]
2025-10-08T16:25:17.4444794Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_em_dash_hr PASSED [ 48%]
2025-10-08T16:25:17.4456089Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_en_dash PASSED  [ 51%]
2025-10-08T16:25:17.4466516Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_gt_lt_in_code PASSED [ 54%]
2025-10-08T16:25:17.4479319Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_gt_lt_in_code_block PASSED [ 58%]
2025-10-08T16:25:17.4490690Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_ignore_smartypants_code_block PASSED [ 61%]
2025-10-08T16:25:17.4503045Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_ignore_smartypants_inline_code PASSED [ 64%]
2025-10-08T16:25:17.4513071Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_lemmy_autocomplete_community PASSED [ 67%]
2025-10-08T16:25:17.4523061Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_lemmy_autocomplete_feed PASSED [ 70%]
2025-10-08T16:25:17.4533344Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_lemmy_autocomplete_multiple_links PASSED [ 74%]
2025-10-08T16:25:17.4543310Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_lemmy_autocomplete_person PASSED [ 77%]
2025-10-08T16:25:17.4554232Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_links PASSED    [ 80%]
2025-10-08T16:25:17.4565519Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_links_w_periods PASSED [ 83%]
2025-10-08T16:25:17.4594751Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_lists PASSED    [ 87%]
2025-10-08T16:25:17.4605933Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_paragraphs PASSED [ 90%]
2025-10-08T16:25:17.4617011Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_spoiler_in_fenced_code PASSED [ 93%]
2025-10-08T16:25:17.4627962Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_strikethrough_in_fenced_code PASSED [ 96%]
2025-10-08T16:25:17.7591622Z tests/test_markdown_to_html.py::TestMarkdownToHtml::test_strikethrough_in_inline_code PASSED [100%]
2025-10-08T16:25:17.7592321Z 
2025-10-08T16:25:17.7592503Z ============================== 31 passed in 1.34s ==============================
2025-10-08T16:25:18.2712556Z ============================= test session starts ==============================
2025-10-08T16:25:18.2714112Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:18.2715081Z cachedir: .pytest_cache
2025-10-08T16:25:18.2715576Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:18.2716135Z plugins: anyio-4.11.0
2025-10-08T16:25:19.3451718Z collecting ... collected 1 item
2025-10-08T16:25:19.3452111Z 
2025-10-08T16:25:20.9118154Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks FAILED         [100%]
2025-10-08T16:25:20.9119001Z 
2025-10-08T16:25:20.9119458Z =================================== FAILURES ===================================
2025-10-08T16:25:20.9120056Z ___________________________ test_api_post_bookmarks ____________________________
2025-10-08T16:25:20.9120468Z 
2025-10-08T16:25:20.9120768Z self = <sqlalchemy.engine.base.Connection object at 0x7f6ba71cfce0>
2025-10-08T16:25:20.9121698Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f6bb098c440>
2025-10-08T16:25:20.9122799Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f6ba6c44a50>
2025-10-08T16:25:20.9123694Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f6ba724d550>
2025-10-08T16:25:20.9124124Z parameters = [(1,)]
2025-10-08T16:25:20.9124249Z 
2025-10-08T16:25:20.9124343Z     def _exec_single_context(
2025-10-08T16:25:20.9124574Z         self,
2025-10-08T16:25:20.9124752Z         dialect: Dialect,
2025-10-08T16:25:20.9124978Z         context: ExecutionContext,
2025-10-08T16:25:20.9125231Z         statement: Union[str, Compiled],
2025-10-08T16:25:20.9125523Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:25:20.9125816Z     ) -> CursorResult[Any]:
2025-10-08T16:25:20.9126097Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:25:20.9126436Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:25:20.9126697Z     
2025-10-08T16:25:20.9126852Z         """
2025-10-08T16:25:20.9127081Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:25:20.9127453Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:25:20.9127753Z     
2025-10-08T16:25:20.9127932Z             if generic_setinputsizes:
2025-10-08T16:25:20.9128159Z                 try:
2025-10-08T16:25:20.9128370Z                     dialect.do_set_input_sizes(
2025-10-08T16:25:20.9128666Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:25:20.9128941Z                     )
2025-10-08T16:25:20.9129428Z                 except BaseException as e:
2025-10-08T16:25:20.9129692Z                     self._handle_dbapi_exception(
2025-10-08T16:25:20.9129986Z                         e, str(statement), parameters, None, context
2025-10-08T16:25:20.9130248Z                     )
2025-10-08T16:25:20.9130419Z     
2025-10-08T16:25:20.9130613Z         cursor, str_statement, parameters = (
2025-10-08T16:25:20.9130873Z             context.cursor,
2025-10-08T16:25:20.9131091Z             context.statement,
2025-10-08T16:25:20.9131318Z             context.parameters,
2025-10-08T16:25:20.9131531Z         )
2025-10-08T16:25:20.9131685Z     
2025-10-08T16:25:20.9131901Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:25:20.9132173Z     
2025-10-08T16:25:20.9132347Z         if not context.executemany:
2025-10-08T16:25:20.9132602Z             effective_parameters = parameters[0]
2025-10-08T16:25:20.9132849Z         else:
2025-10-08T16:25:20.9133047Z             effective_parameters = parameters
2025-10-08T16:25:20.9133279Z     
2025-10-08T16:25:20.9133481Z         if self._has_events or self.engine._has_events:
2025-10-08T16:25:20.9133807Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:25:20.9134113Z                 str_statement, effective_parameters = fn(
2025-10-08T16:25:20.9134377Z                     self,
2025-10-08T16:25:20.9134577Z                     cursor,
2025-10-08T16:25:20.9134785Z                     str_statement,
2025-10-08T16:25:20.9135185Z                     effective_parameters,
2025-10-08T16:25:20.9135439Z                     context,
2025-10-08T16:25:20.9135658Z                     context.executemany,
2025-10-08T16:25:20.9135882Z                 )
2025-10-08T16:25:20.9136055Z     
2025-10-08T16:25:20.9136220Z         if self._echo:
2025-10-08T16:25:20.9136420Z             self._log_info(str_statement)
2025-10-08T16:25:20.9136652Z     
2025-10-08T16:25:20.9136830Z             stats = context._get_cache_stats()
2025-10-08T16:25:20.9137170Z     
2025-10-08T16:25:20.9137375Z             if not self.engine.hide_parameters:
2025-10-08T16:25:20.9137633Z                 self._log_info(
2025-10-08T16:25:20.9137850Z                     "[%s] %r",
2025-10-08T16:25:20.9138054Z                     stats,
2025-10-08T16:25:20.9138269Z                     sql_util._repr_params(
2025-10-08T16:25:20.9138525Z                         effective_parameters,
2025-10-08T16:25:20.9138763Z                         batches=10,
2025-10-08T16:25:20.9139018Z                         ismulti=context.executemany,
2025-10-08T16:25:20.9139466Z                     ),
2025-10-08T16:25:20.9139647Z                 )
2025-10-08T16:25:20.9139824Z             else:
2025-10-08T16:25:20.9140006Z                 self._log_info(
2025-10-08T16:25:20.9140283Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:25:20.9140581Z                     stats,
2025-10-08T16:25:20.9140772Z                 )
2025-10-08T16:25:20.9140945Z     
2025-10-08T16:25:20.9141112Z         evt_handled: bool = False
2025-10-08T16:25:20.9141332Z         try:
2025-10-08T16:25:20.9141572Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:25:20.9141885Z                 effective_parameters = cast(
2025-10-08T16:25:20.9142183Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:25:20.9142459Z                 )
2025-10-08T16:25:20.9151219Z                 if self.dialect._has_events:
2025-10-08T16:25:20.9151768Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:25:20.9152082Z                         if fn(
2025-10-08T16:25:20.9152313Z                             cursor,
2025-10-08T16:25:20.9152556Z                             str_statement,
2025-10-08T16:25:20.9152823Z                             effective_parameters,
2025-10-08T16:25:20.9153095Z                             context,
2025-10-08T16:25:20.9153327Z                         ):
2025-10-08T16:25:20.9153551Z                             evt_handled = True
2025-10-08T16:25:20.9153799Z                             break
2025-10-08T16:25:20.9154031Z                 if not evt_handled:
2025-10-08T16:25:20.9154291Z                     self.dialect.do_executemany(
2025-10-08T16:25:20.9154539Z                         cursor,
2025-10-08T16:25:20.9154761Z                         str_statement,
2025-10-08T16:25:20.9155008Z                         effective_parameters,
2025-10-08T16:25:20.9155250Z                         context,
2025-10-08T16:25:20.9155466Z                     )
2025-10-08T16:25:20.9155725Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:25:20.9156040Z                 if self.dialect._has_events:
2025-10-08T16:25:20.9156343Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:25:20.9156674Z                         if fn(cursor, str_statement, context):
2025-10-08T16:25:20.9156959Z                             evt_handled = True
2025-10-08T16:25:20.9157201Z                             break
2025-10-08T16:25:20.9157424Z                 if not evt_handled:
2025-10-08T16:25:20.9157680Z                     self.dialect.do_execute_no_params(
2025-10-08T16:25:20.9157953Z                         cursor, str_statement, context
2025-10-08T16:25:20.9158197Z                     )
2025-10-08T16:25:20.9158381Z             else:
2025-10-08T16:25:20.9158579Z                 effective_parameters = cast(
2025-10-08T16:25:20.9159330Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:25:20.9159713Z                 )
2025-10-08T16:25:20.9159928Z                 if self.dialect._has_events:
2025-10-08T16:25:20.9160221Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:25:20.9160500Z                         if fn(
2025-10-08T16:25:20.9160715Z                             cursor,
2025-10-08T16:25:20.9160942Z                             str_statement,
2025-10-08T16:25:20.9161332Z                             effective_parameters,
2025-10-08T16:25:20.9161582Z                             context,
2025-10-08T16:25:20.9161797Z                         ):
2025-10-08T16:25:20.9162013Z                             evt_handled = True
2025-10-08T16:25:20.9162254Z                             break
2025-10-08T16:25:20.9162470Z                 if not evt_handled:
2025-10-08T16:25:20.9162718Z >                   self.dialect.do_execute(
2025-10-08T16:25:20.9163021Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:25:20.9163310Z                     )
2025-10-08T16:25:20.9163425Z 
2025-10-08T16:25:20.9163721Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:25:20.9164204Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:20.9164409Z 
2025-10-08T16:25:20.9164683Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f6bb098c440>
2025-10-08T16:25:20.9165154Z cursor = <sqlite3.Cursor object at 0x7f6ba6c1a740>
2025-10-08T16:25:20.9165969Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:20.9166743Z parameters = (1,)
2025-10-08T16:25:20.9167124Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f6ba6c44a50>
2025-10-08T16:25:20.9167480Z 
2025-10-08T16:25:20.9167648Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:20.9167985Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:20.9168288Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:25:20.9168486Z 
2025-10-08T16:25:20.9168846Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:20.9169521Z 
2025-10-08T16:25:20.9169704Z The above exception was the direct cause of the following exception:
2025-10-08T16:25:20.9169957Z 
2025-10-08T16:25:20.9170036Z app = <Flask 'app'>
2025-10-08T16:25:20.9170158Z 
2025-10-08T16:25:20.9170252Z     def test_api_post_bookmarks(app):
2025-10-08T16:25:20.9170506Z         with app.app_context():
2025-10-08T16:25:20.9170785Z             from app.api.alpha.utils.post import put_post_save
2025-10-08T16:25:20.9171064Z     
2025-10-08T16:25:20.9171227Z             user_id = 1
2025-10-08T16:25:20.9171438Z >           user = User.query.get(user_id)
2025-10-08T16:25:20.9171684Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:20.9171841Z 
2025-10-08T16:25:20.9171935Z tests/test_api_post_bookmarks.py:30: 
2025-10-08T16:25:20.9172216Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:20.9172480Z <string>:2: in get
2025-10-08T16:25:20.9172659Z     ???
2025-10-08T16:25:20.9173079Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:25:20.9173629Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:25:20.9173921Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:20.9174345Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:25:20.9174850Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:25:20.9175268Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:20.9175742Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:25:20.9176219Z     return self.session._get_impl(
2025-10-08T16:25:20.9176677Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:25:20.9177146Z     return db_load_fn(
2025-10-08T16:25:20.9177608Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:25:20.9178220Z     session.execute(
2025-10-08T16:25:20.9178630Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:25:20.9179283Z     return self._execute_internal(
2025-10-08T16:25:20.9179779Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:25:20.9180345Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:25:20.9180923Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:25:20.9181438Z     result = conn.execute(
2025-10-08T16:25:20.9181867Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:25:20.9182310Z     return meth(
2025-10-08T16:25:20.9182784Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:25:20.9183330Z     return connection._execute_clauseelement(
2025-10-08T16:25:20.9183868Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:25:20.9184387Z     ret = self._execute_context(
2025-10-08T16:25:20.9184865Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:25:20.9185372Z     return self._exec_single_context(
2025-10-08T16:25:20.9185875Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:25:20.9186391Z     self._handle_dbapi_exception(
2025-10-08T16:25:20.9186902Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:25:20.9187491Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:25:20.9188069Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:25:20.9188582Z     self.dialect.do_execute(
2025-10-08T16:25:20.9188841Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:20.9189133Z 
2025-10-08T16:25:20.9189405Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f6bb098c440>
2025-10-08T16:25:20.9189860Z cursor = <sqlite3.Cursor object at 0x7f6ba6c1a740>
2025-10-08T16:25:20.9190666Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:20.9191429Z parameters = (1,)
2025-10-08T16:25:20.9191806Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f6ba6c44a50>
2025-10-08T16:25:20.9192149Z 
2025-10-08T16:25:20.9192309Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:20.9192652Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:20.9193054Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:20.9208169Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:20.9223611Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:20.9224270Z E       WHERE user.id = ?]
2025-10-08T16:25:20.9224483Z E       [parameters: (1,)]
2025-10-08T16:25:20.9224800Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:20.9225048Z 
2025-10-08T16:25:20.9225404Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:20.9225986Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:25:20.9226314Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:20.9226644Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:20.9227048Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:20.9227402Z =============================== warnings summary ===============================
2025-10-08T16:25:20.9227758Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks
2025-10-08T16:25:20.9228679Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:20.9229658Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:20.9229860Z 
2025-10-08T16:25:20.9230004Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks
2025-10-08T16:25:20.9230900Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:21.4155998Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:21.4156544Z 
2025-10-08T16:25:21.4156878Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks
2025-10-08T16:25:21.4158541Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:21.4160125Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:21.4160508Z 
2025-10-08T16:25:21.4160669Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks
2025-10-08T16:25:21.4161546Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:21.4162516Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:21.4162870Z 
2025-10-08T16:25:21.4163307Z tests/test_api_post_bookmarks.py::test_api_post_bookmarks
2025-10-08T16:25:21.4164684Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_post_bookmarks.py:30: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:25:21.4165993Z     user = User.query.get(user_id)
2025-10-08T16:25:21.4166307Z 
2025-10-08T16:25:21.4166518Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:21.4166966Z =========================== short test summary info ============================
2025-10-08T16:25:21.4167688Z FAILED tests/test_api_post_bookmarks.py::test_api_post_bookmarks - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:21.4183294Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:21.4198613Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:21.4199367Z WHERE user.id = ?]
2025-10-08T16:25:21.4199571Z [parameters: (1,)]
2025-10-08T16:25:21.4199848Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:21.4200227Z ======================== 1 failed, 5 warnings in 2.65s =========================
2025-10-08T16:25:22.1620537Z ============================= test session starts ==============================
2025-10-08T16:25:22.1621270Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:22.1621872Z cachedir: .pytest_cache
2025-10-08T16:25:22.1622208Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:22.1622571Z plugins: anyio-4.11.0
2025-10-08T16:25:23.4392645Z collecting ... collected 4 items
2025-10-08T16:25:23.4393034Z 
2025-10-08T16:25:23.4419516Z tests/test_private_registration_activitypub_integration.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_sets_activitypub_fields_when_activated SKIPPED [ 25%]
2025-10-08T16:25:23.4436120Z tests/test_private_registration_activitypub_integration.py::TestPrivateRegistrationActivityPubSetup::test_create_private_user_skips_activitypub_when_not_activated SKIPPED [ 50%]
2025-10-08T16:25:23.4451165Z tests/test_private_registration_activitypub_integration.py::TestPrivateRegistrationActivityPubSetup::test_multiple_users_get_unique_keypairs SKIPPED [ 75%]
2025-10-08T16:25:23.7423111Z tests/test_private_registration_activitypub_integration.py::TestPrivateRegistrationActivityPubSetup::test_activitypub_urls_are_lowercase SKIPPED [100%]
2025-10-08T16:25:23.7424040Z 
2025-10-08T16:25:23.7424546Z ============================== 4 skipped in 1.29s ==============================
2025-10-08T16:25:24.2168894Z ============================= test session starts ==============================
2025-10-08T16:25:24.2170426Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:24.2171451Z cachedir: .pytest_cache
2025-10-08T16:25:24.2171855Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:24.2172461Z plugins: anyio-4.11.0
2025-10-08T16:25:24.2396634Z collecting ... collected 2 items
2025-10-08T16:25:24.2396999Z 
2025-10-08T16:25:24.2446245Z tests/test_finalize_user_setup_call.py::test_create_private_user_calls_finalize_user_setup PASSED [ 50%]
2025-10-08T16:25:24.2706801Z tests/test_finalize_user_setup_call.py::test_finalize_user_setup_call_is_conditional PASSED [100%]
2025-10-08T16:25:24.2707315Z 
2025-10-08T16:25:24.2707513Z ============================== 2 passed in 0.04s ===============================
2025-10-08T16:25:24.5082099Z ============================= test session starts ==============================
2025-10-08T16:25:24.5082792Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:24.5083359Z cachedir: .pytest_cache
2025-10-08T16:25:24.5083663Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:24.5083993Z plugins: anyio-4.11.0
2025-10-08T16:25:24.6073838Z collecting ... collected 3 items
2025-10-08T16:25:24.6074148Z 
2025-10-08T16:25:24.6085295Z tests/test_explore_page.py::test_explore_template_syntax PASSED          [ 33%]
2025-10-08T16:25:26.3741962Z tests/test_explore_page.py::test_explore_route_exists PASSED             [ 66%]
2025-10-08T16:25:26.8440839Z tests/test_explore_page.py::test_all_templates_use_correct_length_syntax PASSED [100%]
2025-10-08T16:25:26.8441461Z 
2025-10-08T16:25:26.8441664Z =============================== warnings summary ===============================
2025-10-08T16:25:26.8442290Z tests/test_explore_page.py::test_explore_route_exists
2025-10-08T16:25:26.8443779Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:26.8445365Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:26.8445677Z 
2025-10-08T16:25:26.8445884Z tests/test_explore_page.py::test_explore_route_exists
2025-10-08T16:25:26.8447315Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:26.8448754Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:26.8449330Z 
2025-10-08T16:25:26.8449533Z tests/test_explore_page.py::test_explore_route_exists
2025-10-08T16:25:26.8450725Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:26.8452019Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:26.8452495Z 
2025-10-08T16:25:26.8452702Z tests/test_explore_page.py::test_explore_route_exists
2025-10-08T16:25:26.8453842Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:26.8455148Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:26.8455631Z 
2025-10-08T16:25:26.8455936Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:26.8456531Z ======================== 3 passed, 4 warnings in 1.89s =========================
2025-10-08T16:25:27.5732024Z ============================= test session starts ==============================
2025-10-08T16:25:27.5733049Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:27.5733930Z cachedir: .pytest_cache
2025-10-08T16:25:27.5734334Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:27.5734807Z plugins: anyio-4.11.0
2025-10-08T16:25:27.6321928Z collecting ... collected 10 items
2025-10-08T16:25:27.6322184Z 
2025-10-08T16:25:27.6337137Z tests/test_private_registration_security.py::TestRateLimiting::test_rate_limit_enforcement ERROR [ 10%]
2025-10-08T16:25:27.6346934Z tests/test_private_registration_security.py::TestRateLimiting::test_rate_limit_per_ip ERROR [ 20%]
2025-10-08T16:25:27.6356922Z tests/test_private_registration_security.py::TestIPSecurity::test_allowed_ip_ranges ERROR [ 30%]
2025-10-08T16:25:27.6365105Z tests/test_private_registration_security.py::TestIPSecurity::test_x_forwarded_for_parsing ERROR [ 40%]
2025-10-08T16:25:27.6373517Z tests/test_private_registration_security.py::TestIPSecurity::test_no_ip_restrictions ERROR [ 50%]
2025-10-08T16:25:27.6382705Z tests/test_private_registration_security.py::TestConcurrentRequests::test_concurrent_registrations ERROR [ 60%]
2025-10-08T16:25:27.6394755Z tests/test_private_registration_security.py::TestConcurrentRequests::test_concurrent_duplicate_registrations ERROR [ 70%]
2025-10-08T16:25:27.6403265Z tests/test_private_registration_security.py::TestAttackScenarios::test_secret_brute_force_protection ERROR [ 80%]
2025-10-08T16:25:27.6411555Z tests/test_private_registration_security.py::TestAttackScenarios::test_large_payload_handling ERROR [ 90%]
2025-10-08T16:25:27.6429887Z tests/test_private_registration_security.py::TestAttackScenarios::test_malicious_headers ERROR [100%]
2025-10-08T16:25:27.6430366Z 
2025-10-08T16:25:27.6430514Z ==================================== ERRORS ====================================
2025-10-08T16:25:27.6430991Z ________ ERROR at setup of TestRateLimiting.test_rate_limit_enforcement ________
2025-10-08T16:25:27.6431639Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 22
2025-10-08T16:25:27.6432165Z       @patch.dict('os.environ', {
2025-10-08T16:25:27.6432475Z           'PRIVATE_REGISTRATION_RATE_LIMIT': '3',
2025-10-08T16:25:27.6432814Z           'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:27.6433203Z           'PRIVATE_REGISTRATION_SECRET': 'test-rate-limit-secret'
2025-10-08T16:25:27.6433550Z       })
2025-10-08T16:25:27.6433810Z       def test_rate_limit_enforcement(self, test_app):
2025-10-08T16:25:27.6434153Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6435796Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6437482Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6437746Z 
2025-10-08T16:25:27.6438015Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:22
2025-10-08T16:25:27.6438625Z __________ ERROR at setup of TestRateLimiting.test_rate_limit_per_ip ___________
2025-10-08T16:25:27.6439403Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 71
2025-10-08T16:25:27.6439941Z       def test_rate_limit_per_ip(self, test_app):
2025-10-08T16:25:27.6440268Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6442078Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6443780Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6444037Z 
2025-10-08T16:25:27.6444303Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:71
2025-10-08T16:25:27.6444893Z ___________ ERROR at setup of TestIPSecurity.test_allowed_ip_ranges ____________
2025-10-08T16:25:27.6445525Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 123
2025-10-08T16:25:27.6446146Z       @patch.dict('os.environ', {
2025-10-08T16:25:27.6446454Z           'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:27.6446792Z           'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:27.6447127Z           'PRIVATE_REGISTRATION_SECRET': 'test-ip-security-secret'
2025-10-08T16:25:27.6447423Z       })
2025-10-08T16:25:27.6447625Z       def test_allowed_ip_ranges(self, test_app):
2025-10-08T16:25:27.6447904Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6449315Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6450637Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6450860Z 
2025-10-08T16:25:27.6451086Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:123
2025-10-08T16:25:27.6451593Z ________ ERROR at setup of TestIPSecurity.test_x_forwarded_for_parsing _________
2025-10-08T16:25:27.6452130Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 168
2025-10-08T16:25:27.6452588Z       def test_x_forwarded_for_parsing(self, test_app):
2025-10-08T16:25:27.6452878Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6454158Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6455485Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6455697Z 
2025-10-08T16:25:27.6455920Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:168
2025-10-08T16:25:27.6456396Z ___________ ERROR at setup of TestIPSecurity.test_no_ip_restrictions ___________
2025-10-08T16:25:27.6456901Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 194
2025-10-08T16:25:27.6457343Z       def test_no_ip_restrictions(self, test_app):
2025-10-08T16:25:27.6457616Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6458892Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6460311Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6460515Z 
2025-10-08T16:25:27.6460740Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:194
2025-10-08T16:25:27.6461235Z ____ ERROR at setup of TestConcurrentRequests.test_concurrent_registrations ____
2025-10-08T16:25:27.6461752Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 228
2025-10-08T16:25:27.6462203Z       def test_concurrent_registrations(self, test_app):
2025-10-08T16:25:27.6462609Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6463887Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6465294Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6465515Z 
2025-10-08T16:25:27.6465733Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:228
2025-10-08T16:25:27.6466255Z _ ERROR at setup of TestConcurrentRequests.test_concurrent_duplicate_registrations _
2025-10-08T16:25:27.6466808Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 263
2025-10-08T16:25:27.6467289Z       def test_concurrent_duplicate_registrations(self, test_app):
2025-10-08T16:25:27.6467603Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6468868Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6470281Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6470485Z 
2025-10-08T16:25:27.6470700Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:263
2025-10-08T16:25:27.6471192Z ___ ERROR at setup of TestAttackScenarios.test_secret_brute_force_protection ___
2025-10-08T16:25:27.6471715Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 305
2025-10-08T16:25:27.6472178Z       def test_secret_brute_force_protection(self, test_app):
2025-10-08T16:25:27.6472468Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6473732Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6475079Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6475283Z 
2025-10-08T16:25:27.6475504Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:305
2025-10-08T16:25:27.6475981Z ______ ERROR at setup of TestAttackScenarios.test_large_payload_handling _______
2025-10-08T16:25:27.6476495Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 338
2025-10-08T16:25:27.6476945Z       def test_large_payload_handling(self, test_app):
2025-10-08T16:25:27.6477224Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6478484Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6479916Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6480124Z 
2025-10-08T16:25:27.6480339Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:338
2025-10-08T16:25:27.6480817Z _________ ERROR at setup of TestAttackScenarios.test_malicious_headers _________
2025-10-08T16:25:27.6481325Z file /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py, line 371
2025-10-08T16:25:27.6481873Z       def test_malicious_headers(self, test_app):
2025-10-08T16:25:27.6482147Z E       fixture 'test_app' not found
2025-10-08T16:25:27.6690797Z >       available fixtures: anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, doctest_namespace, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory
2025-10-08T16:25:27.6693718Z >       use 'pytest --fixtures [testpath]' for help on them.
2025-10-08T16:25:27.6694011Z 
2025-10-08T16:25:27.6694312Z /home/runner/work/pyfedi/pyfedi/tests/test_private_registration_security.py:371
2025-10-08T16:25:27.6694877Z =========================== short test summary info ============================
2025-10-08T16:25:27.6695500Z ERROR tests/test_private_registration_security.py::TestRateLimiting::test_rate_limit_enforcement
2025-10-08T16:25:27.6696342Z ERROR tests/test_private_registration_security.py::TestRateLimiting::test_rate_limit_per_ip
2025-10-08T16:25:27.6696990Z ERROR tests/test_private_registration_security.py::TestIPSecurity::test_allowed_ip_ranges
2025-10-08T16:25:27.6697652Z ERROR tests/test_private_registration_security.py::TestIPSecurity::test_x_forwarded_for_parsing
2025-10-08T16:25:27.6698319Z ERROR tests/test_private_registration_security.py::TestIPSecurity::test_no_ip_restrictions
2025-10-08T16:25:27.6699288Z ERROR tests/test_private_registration_security.py::TestConcurrentRequests::test_concurrent_registrations
2025-10-08T16:25:27.6700094Z ERROR tests/test_private_registration_security.py::TestConcurrentRequests::test_concurrent_duplicate_registrations
2025-10-08T16:25:27.6700931Z ERROR tests/test_private_registration_security.py::TestAttackScenarios::test_secret_brute_force_protection
2025-10-08T16:25:27.6701678Z ERROR tests/test_private_registration_security.py::TestAttackScenarios::test_large_payload_handling
2025-10-08T16:25:27.6702378Z ERROR tests/test_private_registration_security.py::TestAttackScenarios::test_malicious_headers
2025-10-08T16:25:27.6702889Z ============================== 10 errors in 0.08s ==============================
2025-10-08T16:25:27.9086918Z ============================= test session starts ==============================
2025-10-08T16:25:27.9087646Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:27.9088273Z cachedir: .pytest_cache
2025-10-08T16:25:27.9088575Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:27.9088914Z plugins: anyio-4.11.0
2025-10-08T16:25:28.9584397Z collecting ... collected 1 item
2025-10-08T16:25:28.9584698Z 
2025-10-08T16:25:30.3121548Z tests/test_api_get_community.py::test_api_get_community FAILED           [100%]
2025-10-08T16:25:30.3122181Z 
2025-10-08T16:25:30.3122389Z =================================== FAILURES ===================================
2025-10-08T16:25:30.3123070Z ____________________________ test_api_get_community ____________________________
2025-10-08T16:25:30.3123521Z 
2025-10-08T16:25:30.3123895Z self = <sqlalchemy.engine.base.Connection object at 0x7f37cacf76f0>
2025-10-08T16:25:30.3124962Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f37d45902f0>
2025-10-08T16:25:30.3126099Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f37ca72c690>
2025-10-08T16:25:30.3127137Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f37cad51550>
2025-10-08T16:25:30.3127790Z parameters = [(1, 0)]
2025-10-08T16:25:30.3128016Z 
2025-10-08T16:25:30.3128156Z     def _exec_single_context(
2025-10-08T16:25:30.3128501Z         self,
2025-10-08T16:25:30.3128779Z         dialect: Dialect,
2025-10-08T16:25:30.3129527Z         context: ExecutionContext,
2025-10-08T16:25:30.3129923Z         statement: Union[str, Compiled],
2025-10-08T16:25:30.3130665Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:25:30.3131111Z     ) -> CursorResult[Any]:
2025-10-08T16:25:30.3131544Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:25:30.3132081Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:25:30.3132489Z     
2025-10-08T16:25:30.3132729Z         """
2025-10-08T16:25:30.3133077Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:25:30.3133654Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:25:30.3134338Z     
2025-10-08T16:25:30.3134605Z             if generic_setinputsizes:
2025-10-08T16:25:30.3134967Z                 try:
2025-10-08T16:25:30.3135284Z                     dialect.do_set_input_sizes(
2025-10-08T16:25:30.3135754Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:25:30.3136188Z                     )
2025-10-08T16:25:30.3136503Z                 except BaseException as e:
2025-10-08T16:25:30.3136923Z                     self._handle_dbapi_exception(
2025-10-08T16:25:30.3137376Z                         e, str(statement), parameters, None, context
2025-10-08T16:25:30.3137777Z                     )
2025-10-08T16:25:30.3138052Z     
2025-10-08T16:25:30.3138338Z         cursor, str_statement, parameters = (
2025-10-08T16:25:30.3138723Z             context.cursor,
2025-10-08T16:25:30.3139243Z             context.statement,
2025-10-08T16:25:30.3139595Z             context.parameters,
2025-10-08T16:25:30.3139928Z         )
2025-10-08T16:25:30.3140180Z     
2025-10-08T16:25:30.3140504Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:25:30.3140922Z     
2025-10-08T16:25:30.3141183Z         if not context.executemany:
2025-10-08T16:25:30.3141577Z             effective_parameters = parameters[0]
2025-10-08T16:25:30.3141938Z         else:
2025-10-08T16:25:30.3142223Z             effective_parameters = parameters
2025-10-08T16:25:30.3142582Z     
2025-10-08T16:25:30.3142900Z         if self._has_events or self.engine._has_events:
2025-10-08T16:25:30.3143357Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:25:30.3143832Z                 str_statement, effective_parameters = fn(
2025-10-08T16:25:30.3144225Z                     self,
2025-10-08T16:25:30.3144513Z                     cursor,
2025-10-08T16:25:30.3144827Z                     str_statement,
2025-10-08T16:25:30.3145184Z                     effective_parameters,
2025-10-08T16:25:30.3145546Z                     context,
2025-10-08T16:25:30.3145888Z                     context.executemany,
2025-10-08T16:25:30.3146241Z                 )
2025-10-08T16:25:30.3146495Z     
2025-10-08T16:25:30.3146742Z         if self._echo:
2025-10-08T16:25:30.3147064Z             self._log_info(str_statement)
2025-10-08T16:25:30.3147417Z     
2025-10-08T16:25:30.3147685Z             stats = context._get_cache_stats()
2025-10-08T16:25:30.3148045Z     
2025-10-08T16:25:30.3148313Z             if not self.engine.hide_parameters:
2025-10-08T16:25:30.3148701Z                 self._log_info(
2025-10-08T16:25:30.3149183Z                     "[%s] %r",
2025-10-08T16:25:30.3149508Z                     stats,
2025-10-08T16:25:30.3149825Z                     sql_util._repr_params(
2025-10-08T16:25:30.3150205Z                         effective_parameters,
2025-10-08T16:25:30.3150577Z                         batches=10,
2025-10-08T16:25:30.3150942Z                         ismulti=context.executemany,
2025-10-08T16:25:30.3151327Z                     ),
2025-10-08T16:25:30.3151602Z                 )
2025-10-08T16:25:30.3151863Z             else:
2025-10-08T16:25:30.3152139Z                 self._log_info(
2025-10-08T16:25:30.3152557Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:25:30.3153019Z                     stats,
2025-10-08T16:25:30.3153299Z                 )
2025-10-08T16:25:30.3153552Z     
2025-10-08T16:25:30.3153801Z         evt_handled: bool = False
2025-10-08T16:25:30.3154128Z         try:
2025-10-08T16:25:30.3154662Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:25:30.3155145Z                 effective_parameters = cast(
2025-10-08T16:25:30.3155573Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:25:30.3155985Z                 )
2025-10-08T16:25:30.3156271Z                 if self.dialect._has_events:
2025-10-08T16:25:30.3156701Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:25:30.3157132Z                         if fn(
2025-10-08T16:25:30.3157628Z                             cursor,
2025-10-08T16:25:30.3157975Z                             str_statement,
2025-10-08T16:25:30.3158344Z                             effective_parameters,
2025-10-08T16:25:30.3158728Z                             context,
2025-10-08T16:25:30.3159207Z                         ):
2025-10-08T16:25:30.3159530Z                             evt_handled = True
2025-10-08T16:25:30.3159898Z                             break
2025-10-08T16:25:30.3160235Z                 if not evt_handled:
2025-10-08T16:25:30.3160595Z                     self.dialect.do_executemany(
2025-10-08T16:25:30.3160979Z                         cursor,
2025-10-08T16:25:30.3161302Z                         str_statement,
2025-10-08T16:25:30.3161665Z                         effective_parameters,
2025-10-08T16:25:30.3162018Z                         context,
2025-10-08T16:25:30.3162327Z                     )
2025-10-08T16:25:30.3162707Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:25:30.3163178Z                 if self.dialect._has_events:
2025-10-08T16:25:30.3163632Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:25:30.3164141Z                         if fn(cursor, str_statement, context):
2025-10-08T16:25:30.3164568Z                             evt_handled = True
2025-10-08T16:25:30.3164939Z                             break
2025-10-08T16:25:30.3165271Z                 if not evt_handled:
2025-10-08T16:25:30.3165652Z                     self.dialect.do_execute_no_params(
2025-10-08T16:25:30.3166072Z                         cursor, str_statement, context
2025-10-08T16:25:30.3166460Z                     )
2025-10-08T16:25:30.3166728Z             else:
2025-10-08T16:25:30.3167006Z                 effective_parameters = cast(
2025-10-08T16:25:30.3167451Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:25:30.3167863Z                 )
2025-10-08T16:25:30.3168149Z                 if self.dialect._has_events:
2025-10-08T16:25:30.3168616Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:25:30.3169146Z                         if fn(
2025-10-08T16:25:30.3169465Z                             cursor,
2025-10-08T16:25:30.3169801Z                             str_statement,
2025-10-08T16:25:30.3170181Z                             effective_parameters,
2025-10-08T16:25:30.3170585Z                             context,
2025-10-08T16:25:30.3170936Z                         ):
2025-10-08T16:25:30.3171273Z                             evt_handled = True
2025-10-08T16:25:30.3171646Z                             break
2025-10-08T16:25:30.3171970Z                 if not evt_handled:
2025-10-08T16:25:30.3172353Z >                   self.dialect.do_execute(
2025-10-08T16:25:30.3172819Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:25:30.3173257Z                     )
2025-10-08T16:25:30.3173444Z 
2025-10-08T16:25:30.3173888Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:25:30.3174632Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:30.3174965Z 
2025-10-08T16:25:30.3175371Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f37d45902f0>
2025-10-08T16:25:30.3176093Z cursor = <sqlite3.Cursor object at 0x7f37ca71e5c0>
2025-10-08T16:25:30.3177617Z statement = 'SELECT community.id AS community_id, community.icon_id AS community_icon_id, community.image_id AS community_image_id...munity LEFT OUTER JOIN file AS file_1 ON file_1.id = community.icon_id \nWHERE community.banned = 0\n LIMIT ? OFFSET ?'
2025-10-08T16:25:30.3178924Z parameters = (1, 0)
2025-10-08T16:25:30.3179680Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f37ca72c690>
2025-10-08T16:25:30.3180234Z 
2025-10-08T16:25:30.3180481Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:30.3181184Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:30.3181657Z E       sqlite3.OperationalError: no such table: community
2025-10-08T16:25:30.3181991Z 
2025-10-08T16:25:30.3182535Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:30.3183249Z 
2025-10-08T16:25:30.3183513Z The above exception was the direct cause of the following exception:
2025-10-08T16:25:30.3183917Z 
2025-10-08T16:25:30.3184040Z app = <Flask 'app'>
2025-10-08T16:25:30.3184219Z 
2025-10-08T16:25:30.3184353Z     def test_api_get_community(app):
2025-10-08T16:25:30.3184719Z         with app.app_context():
2025-10-08T16:25:30.3185143Z             from app.api.alpha.utils.community import get_community
2025-10-08T16:25:30.3185745Z >           community = Community.query.filter_by(banned=False).first()
2025-10-08T16:25:30.3186253Z                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:30.3186541Z 
2025-10-08T16:25:30.3186687Z tests/test_api_get_community.py:26: 
2025-10-08T16:25:30.3187112Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:30.3187893Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:2759: in first
2025-10-08T16:25:30.3188723Z     return self.limit(1)._iter().first()  # type: ignore
2025-10-08T16:25:30.3189305Z            ^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:30.3189981Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:2857: in _iter
2025-10-08T16:25:30.3190821Z     result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
2025-10-08T16:25:30.3191690Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:25:30.3192451Z     return self._execute_internal(
2025-10-08T16:25:30.3193222Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:25:30.3194107Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:25:30.3195009Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:25:30.3195840Z     result = conn.execute(
2025-10-08T16:25:30.3196506Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:25:30.3197218Z     return meth(
2025-10-08T16:25:30.3197956Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:25:30.3198824Z     return connection._execute_clauseelement(
2025-10-08T16:25:30.3199801Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:25:30.3200638Z     ret = self._execute_context(
2025-10-08T16:25:30.3201390Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:25:30.3202181Z     return self._exec_single_context(
2025-10-08T16:25:30.3202984Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:25:30.3203827Z     self._handle_dbapi_exception(
2025-10-08T16:25:30.3204853Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:25:30.3205789Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:25:30.3206675Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:25:30.3207468Z     self.dialect.do_execute(
2025-10-08T16:25:30.3207849Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:30.3208169Z 
2025-10-08T16:25:30.3208581Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f37d45902f0>
2025-10-08T16:25:30.3209615Z cursor = <sqlite3.Cursor object at 0x7f37ca71e5c0>
2025-10-08T16:25:30.3210959Z statement = 'SELECT community.id AS community_id, community.icon_id AS community_icon_id, community.image_id AS community_image_id...munity LEFT OUTER JOIN file AS file_1 ON file_1.id = community.icon_id \nWHERE community.banned = 0\n LIMIT ? OFFSET ?'
2025-10-08T16:25:30.3212265Z parameters = (1, 0)
2025-10-08T16:25:30.3212872Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f37ca72c690>
2025-10-08T16:25:30.3213426Z 
2025-10-08T16:25:30.3213677Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:30.3214226Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:30.3214919Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: community
2025-10-08T16:25:30.3231357Z E       [SQL: SELECT community.id AS community_id, community.icon_id AS community_icon_id, community.image_id AS community_image_id, community.user_id AS community_user_id, community.name AS community_name, community.title AS community_title, community.description AS community_description, community.description_html AS community_description_html, community.rules AS community_rules, community.content_warning AS community_content_warning, community.subscriptions_count AS community_subscriptions_count, community.total_subscriptions_count AS community_total_subscriptions_count, community.post_count AS community_post_count, community.post_reply_count AS community_post_reply_count, community.nsfw AS community_nsfw, community.nsfl AS community_nsfl, community.instance_id AS community_instance_id, community.low_quality AS community_low_quality, community.created_at AS community_created_at, community.last_active AS community_last_active, community.public_key AS community_public_key, community.private_key AS community_private_key, community.content_retention AS community_content_retention, community.topic_id AS community_topic_id, community.default_layout AS community_default_layout, community.posting_warning AS community_posting_warning, community.downvote_accept_mode AS community_downvote_accept_mode, community.rss_url AS community_rss_url, community.can_be_archived AS community_can_be_archived, community.ap_id AS community_ap_id, community.ap_profile_id AS community_ap_profile_id, community.ap_followers_url AS community_ap_followers_url, community.ap_preferred_username AS community_ap_preferred_username, community.ap_discoverable AS community_ap_discoverable, community.ap_public_url AS community_ap_public_url, community.ap_fetched_at AS community_ap_fetched_at, community.ap_deleted_at AS community_ap_deleted_at, community.ap_inbox_url AS community_ap_inbox_url, community.ap_outbox_url AS community_ap_outbox_url, community.ap_featured_url AS community_ap_featured_url, community.ap_moderators_url AS community_ap_moderators_url, community.ap_domain AS community_ap_domain, community.banned AS community_banned, community.restricted_to_mods AS community_restricted_to_mods, community.local_only AS community_local_only, community.private AS community_private, community.new_mods_wanted AS community_new_mods_wanted, community.searchable AS community_searchable, community.private_mods AS community_private_mods, community.active_daily AS community_active_daily, community.active_weekly AS community_active_weekly, community.active_monthly AS community_active_monthly, community.active_6monthly AS community_active_6monthly, community.show_popular AS community_show_popular, community.show_all AS community_show_all, community.ignore_remote_language AS community_ignore_remote_language, community.search_vector AS community_search_vector, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash 
2025-10-08T16:25:30.3247722Z E       FROM community LEFT OUTER JOIN file AS file_1 ON file_1.id = community.icon_id 
2025-10-08T16:25:30.3248275Z E       WHERE community.banned = 0
2025-10-08T16:25:30.3248618Z E        LIMIT ? OFFSET ?]
2025-10-08T16:25:30.3248932Z E       [parameters: (1, 0)]
2025-10-08T16:25:30.3249550Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:30.3249927Z 
2025-10-08T16:25:30.3250478Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:30.3251414Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:25:30.3251930Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:30.3252421Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:30.3253051Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:30.3253624Z =============================== warnings summary ===============================
2025-10-08T16:25:30.3254173Z tests/test_api_get_community.py::test_api_get_community
2025-10-08T16:25:30.3255613Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:30.3257079Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:30.3257399Z 
2025-10-08T16:25:30.3257599Z tests/test_api_get_community.py::test_api_get_community
2025-10-08T16:25:30.3259187Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:30.3260922Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:30.3261218Z 
2025-10-08T16:25:30.3261411Z tests/test_api_get_community.py::test_api_get_community
2025-10-08T16:25:30.3262386Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:30.3263455Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:30.3263864Z 
2025-10-08T16:25:30.3264054Z tests/test_api_get_community.py::test_api_get_community
2025-10-08T16:25:30.3264998Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:30.3265984Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:30.3266294Z 
2025-10-08T16:25:30.3266498Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:30.3266902Z =========================== short test summary info ============================
2025-10-08T16:25:30.3267537Z FAILED tests/test_api_get_community.py::test_api_get_community - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: community
2025-10-08T16:25:30.3277987Z [SQL: SELECT community.id AS community_id, community.icon_id AS community_icon_id, community.image_id AS community_image_id, community.user_id AS community_user_id, community.name AS community_name, community.title AS community_title, community.description AS community_description, community.description_html AS community_description_html, community.rules AS community_rules, community.content_warning AS community_content_warning, community.subscriptions_count AS community_subscriptions_count, community.total_subscriptions_count AS community_total_subscriptions_count, community.post_count AS community_post_count, community.post_reply_count AS community_post_reply_count, community.nsfw AS community_nsfw, community.nsfl AS community_nsfl, community.instance_id AS community_instance_id, community.low_quality AS community_low_quality, community.created_at AS community_created_at, community.last_active AS community_last_active, community.public_key AS community_public_key, community.private_key AS community_private_key, community.content_retention AS community_content_retention, community.topic_id AS community_topic_id, community.default_layout AS community_default_layout, community.posting_warning AS community_posting_warning, community.downvote_accept_mode AS community_downvote_accept_mode, community.rss_url AS community_rss_url, community.can_be_archived AS community_can_be_archived, community.ap_id AS community_ap_id, community.ap_profile_id AS community_ap_profile_id, community.ap_followers_url AS community_ap_followers_url, community.ap_preferred_username AS community_ap_preferred_username, community.ap_discoverable AS community_ap_discoverable, community.ap_public_url AS community_ap_public_url, community.ap_fetched_at AS community_ap_fetched_at, community.ap_deleted_at AS community_ap_deleted_at, community.ap_inbox_url AS community_ap_inbox_url, community.ap_outbox_url AS community_ap_outbox_url, community.ap_featured_url AS community_ap_featured_url, community.ap_moderators_url AS community_ap_moderators_url, community.ap_domain AS community_ap_domain, community.banned AS community_banned, community.restricted_to_mods AS community_restricted_to_mods, community.local_only AS community_local_only, community.private AS community_private, community.new_mods_wanted AS community_new_mods_wanted, community.searchable AS community_searchable, community.private_mods AS community_private_mods, community.active_daily AS community_active_daily, community.active_weekly AS community_active_weekly, community.active_monthly AS community_active_monthly, community.active_6monthly AS community_active_6monthly, community.show_popular AS community_show_popular, community.show_all AS community_show_all, community.ignore_remote_language AS community_ignore_remote_language, community.search_vector AS community_search_vector, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash 
2025-10-08T16:25:30.3287953Z FROM community LEFT OUTER JOIN file AS file_1 ON file_1.id = community.icon_id 
2025-10-08T16:25:30.3288324Z WHERE community.banned = 0
2025-10-08T16:25:30.3288538Z  LIMIT ? OFFSET ?]
2025-10-08T16:25:30.3288731Z [parameters: (1, 0)]
2025-10-08T16:25:30.8207969Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:30.8208518Z ======================== 1 failed, 4 warnings in 2.41s =========================
2025-10-08T16:25:31.4948841Z ============================= test session starts ==============================
2025-10-08T16:25:31.4950066Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:31.4950900Z cachedir: .pytest_cache
2025-10-08T16:25:31.4951333Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:31.4951804Z plugins: anyio-4.11.0
2025-10-08T16:25:31.5319330Z collecting ... collected 11 items
2025-10-08T16:25:31.5319717Z 
2025-10-08T16:25:32.7470039Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_generate_secure_password PASSED [  9%]
2025-10-08T16:25:32.7477790Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_hmac_compare_digest_works PASSED [ 18%]
2025-10-08T16:25:32.7490670Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_ip_whitelist_no_restrictions PASSED [ 27%]
2025-10-08T16:25:32.7500956Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_ip_whitelist_validation_allowed PASSED [ 36%]
2025-10-08T16:25:32.7510707Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_ip_whitelist_validation_denied PASSED [ 45%]
2025-10-08T16:25:32.7521909Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_validate_registration_secret_empty PASSED [ 54%]
2025-10-08T16:25:32.7531306Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_validate_registration_secret_failure PASSED [ 63%]
2025-10-08T16:25:32.7541126Z tests/test_private_registration_simple.py::TestSecurityFunctions::test_validate_registration_secret_success PASSED [ 72%]
2025-10-08T16:25:32.7549645Z tests/test_private_registration_simple.py::TestPrivateRegistrationLogic::test_input_sanitization PASSED [ 81%]
2025-10-08T16:25:32.8500425Z tests/test_private_registration_simple.py::TestPrivateRegistrationLogic::test_validate_user_availability_success FAILED [ 90%]
2025-10-08T16:25:33.1620141Z tests/test_private_registration_simple.py::TestPrivateRegistrationLogic::test_validate_user_availability_username_taken FAILED [100%]
2025-10-08T16:25:33.1621117Z 
2025-10-08T16:25:33.1621280Z =================================== FAILURES ===================================
2025-10-08T16:25:33.1621875Z _____ TestPrivateRegistrationLogic.test_validate_user_availability_success _____
2025-10-08T16:25:33.1622322Z 
2025-10-08T16:25:33.1622875Z self = <tests.test_private_registration_simple.TestPrivateRegistrationLogic testMethod=test_validate_user_availability_success>
2025-10-08T16:25:33.1623735Z mock_user = <MagicMock name='User' id='140393141771568'>
2025-10-08T16:25:33.1624020Z 
2025-10-08T16:25:33.1624204Z     @patch('app.api.admin.private_registration.User')
2025-10-08T16:25:33.1624711Z     def test_validate_user_availability_success(self, mock_user):
2025-10-08T16:25:33.1625225Z         """Test user availability validation when available"""
2025-10-08T16:25:33.1625792Z         from app.api.admin.private_registration import validate_user_availability
2025-10-08T16:25:33.1626280Z     
2025-10-08T16:25:33.1626561Z         # Mock that both username and email are available
2025-10-08T16:25:33.1627066Z         mock_user.query.filter_by.return_value.first.return_value = None
2025-10-08T16:25:33.1627507Z     
2025-10-08T16:25:33.1627850Z >       result = validate_user_availability('newuser', 'new@example.com')
2025-10-08T16:25:33.1628320Z                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1628569Z 
2025-10-08T16:25:33.1628748Z tests/test_private_registration_simple.py:97: 
2025-10-08T16:25:33.1629242Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:33.1629644Z app/api/admin/private_registration.py:41: in validate_user_availability
2025-10-08T16:25:33.1630117Z     ap_profile_id = f"https://{current_app.config['SERVER_NAME']}/u/{username.lower()}"
2025-10-08T16:25:33.1630487Z                                ^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1630962Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:25:33.1631426Z     obj = instance._get_current_object()
2025-10-08T16:25:33.1631669Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1631932Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:33.1632126Z 
2025-10-08T16:25:33.1632221Z     def _get_current_object() -> T:
2025-10-08T16:25:33.1632458Z         try:
2025-10-08T16:25:33.1632641Z             obj = local.get()
2025-10-08T16:25:33.1633144Z         except LookupError:
2025-10-08T16:25:33.1633400Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:25:33.1633735Z E           RuntimeError: Working outside of application context.
2025-10-08T16:25:33.1634022Z E           
2025-10-08T16:25:33.1634302Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:25:33.1634751Z E           the current application. To solve this, set up an application context
2025-10-08T16:25:33.1635303Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:25:33.1635549Z 
2025-10-08T16:25:33.1635847Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:25:33.1636438Z _ TestPrivateRegistrationLogic.test_validate_user_availability_username_taken __
2025-10-08T16:25:33.1636745Z 
2025-10-08T16:25:33.1637140Z self = <tests.test_private_registration_simple.TestPrivateRegistrationLogic testMethod=test_validate_user_availability_username_taken>
2025-10-08T16:25:33.1637828Z mock_suggestions = <MagicMock name='generate_username_suggestions' id='140393027931840'>
2025-10-08T16:25:33.1638244Z mock_user = <MagicMock name='User' id='140393027933184'>
2025-10-08T16:25:33.1638437Z 
2025-10-08T16:25:33.1638567Z     @patch('app.api.admin.private_registration.User')
2025-10-08T16:25:33.1638967Z     @patch('app.api.admin.private_registration.generate_username_suggestions')
2025-10-08T16:25:33.1639579Z     def test_validate_user_availability_username_taken(self, mock_suggestions, mock_user):
2025-10-08T16:25:33.1640036Z         """Test user availability validation when username is taken"""
2025-10-08T16:25:33.1640447Z         from app.api.admin.private_registration import validate_user_availability
2025-10-08T16:25:33.1640786Z     
2025-10-08T16:25:33.1640980Z         # Mock existing user for username check
2025-10-08T16:25:33.1641242Z         mock_existing_user = MagicMock()
2025-10-08T16:25:33.1641519Z         mock_user.query.filter_by.side_effect = [
2025-10-08T16:25:33.1641913Z             MagicMock(first=MagicMock(return_value=mock_existing_user)),  # username taken
2025-10-08T16:25:33.1642353Z             MagicMock(first=MagicMock(return_value=None))  # email available
2025-10-08T16:25:33.1642665Z         ]
2025-10-08T16:25:33.1642908Z         mock_suggestions.return_value = ['testuser1', 'testuser2']
2025-10-08T16:25:33.1643197Z     
2025-10-08T16:25:33.1643448Z >       result = validate_user_availability('testuser', 'test@example.com')
2025-10-08T16:25:33.1643800Z                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1643983Z 
2025-10-08T16:25:33.1644105Z tests/test_private_registration_simple.py:117: 
2025-10-08T16:25:33.1644410Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:33.1644798Z app/api/admin/private_registration.py:41: in validate_user_availability
2025-10-08T16:25:33.1645273Z     ap_profile_id = f"https://{current_app.config['SERVER_NAME']}/u/{username.lower()}"
2025-10-08T16:25:33.1645639Z                                ^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1646074Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:318: in __get__
2025-10-08T16:25:33.1646526Z     obj = instance._get_current_object()
2025-10-08T16:25:33.1646775Z           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:33.1647029Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:33.1647234Z 
2025-10-08T16:25:33.1647324Z     def _get_current_object() -> T:
2025-10-08T16:25:33.1647551Z         try:
2025-10-08T16:25:33.1647734Z             obj = local.get()
2025-10-08T16:25:33.1647952Z         except LookupError:
2025-10-08T16:25:33.1648205Z >           raise RuntimeError(unbound_message) from None
2025-10-08T16:25:33.1648539Z E           RuntimeError: Working outside of application context.
2025-10-08T16:25:33.1648827Z E           
2025-10-08T16:25:33.1649337Z E           This typically means that you attempted to use functionality that needed
2025-10-08T16:25:33.1649797Z E           the current application. To solve this, set up an application context
2025-10-08T16:25:33.1650221Z E           with app.app_context(). See the documentation for more information.
2025-10-08T16:25:33.1650466Z 
2025-10-08T16:25:33.1650751Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/werkzeug/local.py:519: RuntimeError
2025-10-08T16:25:33.1651351Z =========================== short test summary info ============================
2025-10-08T16:25:33.1652086Z FAILED tests/test_private_registration_simple.py::TestPrivateRegistrationLogic::test_validate_user_availability_success - RuntimeError: Working outside of application context.
2025-10-08T16:25:33.1652689Z 
2025-10-08T16:25:33.1652871Z This typically means that you attempted to use functionality that needed
2025-10-08T16:25:33.1653299Z the current application. To solve this, set up an application context
2025-10-08T16:25:33.1653713Z with app.app_context(). See the documentation for more information.
2025-10-08T16:25:33.1654489Z FAILED tests/test_private_registration_simple.py::TestPrivateRegistrationLogic::test_validate_user_availability_username_taken - RuntimeError: Working outside of application context.
2025-10-08T16:25:33.1655102Z 
2025-10-08T16:25:33.1655286Z This typically means that you attempted to use functionality that needed
2025-10-08T16:25:33.1655708Z the current application. To solve this, set up an application context
2025-10-08T16:25:33.1656115Z with app.app_context(). See the documentation for more information.
2025-10-08T16:25:33.1656469Z ========================= 2 failed, 9 passed in 1.38s ==========================
2025-10-08T16:25:33.6139888Z ============================= test session starts ==============================
2025-10-08T16:25:33.6140893Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:33.6141770Z cachedir: .pytest_cache
2025-10-08T16:25:33.6142195Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:33.6142639Z plugins: anyio-4.11.0
2025-10-08T16:25:34.8463596Z collecting ... collected 7 items
2025-10-08T16:25:34.8463876Z 
2025-10-08T16:25:34.8487551Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_finds_incomplete_users SKIPPED [ 14%]
2025-10-08T16:25:34.8503576Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_ignores_complete_users SKIPPED [ 28%]
2025-10-08T16:25:34.8517862Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_ignores_unverified_users SKIPPED [ 42%]
2025-10-08T16:25:34.8532617Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_ignores_banned_and_deleted_users SKIPPED [ 57%]
2025-10-08T16:25:34.8546453Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_ignores_remote_users SKIPPED [ 71%]
2025-10-08T16:25:34.8560751Z tests/test_startup_validation_activitypub.py::TestStartupValidationActivityPub::test_fixes_multiple_incomplete_users SKIPPED [ 85%]
2025-10-08T16:25:35.1120488Z tests/test_startup_validation_activitypub.py::test_startup_validation_code_exists PASSED [100%]
2025-10-08T16:25:35.1120991Z 
2025-10-08T16:25:35.1121178Z ========================= 1 passed, 6 skipped in 1.25s =========================
2025-10-08T16:25:35.5516286Z ============================= test session starts ==============================
2025-10-08T16:25:35.5516928Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:35.5517436Z cachedir: .pytest_cache
2025-10-08T16:25:35.5517694Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:35.5517989Z plugins: anyio-4.11.0
2025-10-08T16:25:36.5864480Z collecting ... collected 1 item
2025-10-08T16:25:36.5864758Z 
2025-10-08T16:25:38.0891527Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions FAILED [100%]
2025-10-08T16:25:38.0892019Z 
2025-10-08T16:25:38.0892159Z =================================== FAILURES ===================================
2025-10-08T16:25:38.0892583Z _________________________ test_api_reply_subscriptions _________________________
2025-10-08T16:25:38.0892987Z 
2025-10-08T16:25:38.0893303Z self = <sqlalchemy.engine.base.Connection object at 0x7f907a90bce0>
2025-10-08T16:25:38.0894005Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f90842b02f0>
2025-10-08T16:25:38.0895165Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f907a564a50>
2025-10-08T16:25:38.0896160Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f907ab6d400>
2025-10-08T16:25:38.0896915Z parameters = [(1,)]
2025-10-08T16:25:38.0897137Z 
2025-10-08T16:25:38.0897293Z     def _exec_single_context(
2025-10-08T16:25:38.0897678Z         self,
2025-10-08T16:25:38.0898005Z         dialect: Dialect,
2025-10-08T16:25:38.0898411Z         context: ExecutionContext,
2025-10-08T16:25:38.0898926Z         statement: Union[str, Compiled],
2025-10-08T16:25:38.0899689Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:25:38.0900045Z     ) -> CursorResult[Any]:
2025-10-08T16:25:38.0900385Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:25:38.0900799Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:25:38.0901129Z     
2025-10-08T16:25:38.0901318Z         """
2025-10-08T16:25:38.0901586Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:25:38.0901977Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:25:38.0902279Z     
2025-10-08T16:25:38.0902460Z             if generic_setinputsizes:
2025-10-08T16:25:38.0902698Z                 try:
2025-10-08T16:25:38.0902912Z                     dialect.do_set_input_sizes(
2025-10-08T16:25:38.0903220Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:25:38.0903526Z                     )
2025-10-08T16:25:38.0903733Z                 except BaseException as e:
2025-10-08T16:25:38.0904003Z                     self._handle_dbapi_exception(
2025-10-08T16:25:38.0904298Z                         e, str(statement), parameters, None, context
2025-10-08T16:25:38.0904566Z                     )
2025-10-08T16:25:38.0904748Z     
2025-10-08T16:25:38.0904946Z         cursor, str_statement, parameters = (
2025-10-08T16:25:38.0905197Z             context.cursor,
2025-10-08T16:25:38.0905424Z             context.statement,
2025-10-08T16:25:38.0905653Z             context.parameters,
2025-10-08T16:25:38.0905866Z         )
2025-10-08T16:25:38.0906031Z     
2025-10-08T16:25:38.0906251Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:25:38.0906521Z     
2025-10-08T16:25:38.0906698Z         if not context.executemany:
2025-10-08T16:25:38.0906963Z             effective_parameters = parameters[0]
2025-10-08T16:25:38.0907210Z         else:
2025-10-08T16:25:38.0907406Z             effective_parameters = parameters
2025-10-08T16:25:38.0907643Z     
2025-10-08T16:25:38.0907845Z         if self._has_events or self.engine._has_events:
2025-10-08T16:25:38.0908153Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:25:38.0908458Z                 str_statement, effective_parameters = fn(
2025-10-08T16:25:38.0908719Z                     self,
2025-10-08T16:25:38.0917443Z                     cursor,
2025-10-08T16:25:38.0917717Z                     str_statement,
2025-10-08T16:25:38.0917975Z                     effective_parameters,
2025-10-08T16:25:38.0918227Z                     context,
2025-10-08T16:25:38.0918458Z                     context.executemany,
2025-10-08T16:25:38.0918701Z                 )
2025-10-08T16:25:38.0918878Z     
2025-10-08T16:25:38.0919240Z         if self._echo:
2025-10-08T16:25:38.0919470Z             self._log_info(str_statement)
2025-10-08T16:25:38.0919704Z     
2025-10-08T16:25:38.0920096Z             stats = context._get_cache_stats()
2025-10-08T16:25:38.0920349Z     
2025-10-08T16:25:38.0920538Z             if not self.engine.hide_parameters:
2025-10-08T16:25:38.0920798Z                 self._log_info(
2025-10-08T16:25:38.0921016Z                     "[%s] %r",
2025-10-08T16:25:38.0921232Z                     stats,
2025-10-08T16:25:38.0921457Z                     sql_util._repr_params(
2025-10-08T16:25:38.0921719Z                         effective_parameters,
2025-10-08T16:25:38.0922094Z                         batches=10,
2025-10-08T16:25:38.0922349Z                         ismulti=context.executemany,
2025-10-08T16:25:38.0922607Z                     ),
2025-10-08T16:25:38.0922796Z                 )
2025-10-08T16:25:38.0922968Z             else:
2025-10-08T16:25:38.0923155Z                 self._log_info(
2025-10-08T16:25:38.0923450Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:25:38.0923754Z                     stats,
2025-10-08T16:25:38.0923954Z                 )
2025-10-08T16:25:38.0924131Z     
2025-10-08T16:25:38.0924304Z         evt_handled: bool = False
2025-10-08T16:25:38.0924531Z         try:
2025-10-08T16:25:38.0924777Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:25:38.0925104Z                 effective_parameters = cast(
2025-10-08T16:25:38.0925405Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:25:38.0925682Z                 )
2025-10-08T16:25:38.0925881Z                 if self.dialect._has_events:
2025-10-08T16:25:38.0926173Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:25:38.0926453Z                         if fn(
2025-10-08T16:25:38.0926675Z                             cursor,
2025-10-08T16:25:38.0926896Z                             str_statement,
2025-10-08T16:25:38.0927148Z                             effective_parameters,
2025-10-08T16:25:38.0927403Z                             context,
2025-10-08T16:25:38.0927626Z                         ):
2025-10-08T16:25:38.0927845Z                             evt_handled = True
2025-10-08T16:25:38.0928087Z                             break
2025-10-08T16:25:38.0928315Z                 if not evt_handled:
2025-10-08T16:25:38.0928577Z                     self.dialect.do_executemany(
2025-10-08T16:25:38.0928841Z                         cursor,
2025-10-08T16:25:38.0929245Z                         str_statement,
2025-10-08T16:25:38.0929586Z                         effective_parameters,
2025-10-08T16:25:38.0929848Z                         context,
2025-10-08T16:25:38.0930063Z                     )
2025-10-08T16:25:38.0930317Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:25:38.0930638Z                 if self.dialect._has_events:
2025-10-08T16:25:38.0930948Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:25:38.0931279Z                         if fn(cursor, str_statement, context):
2025-10-08T16:25:38.0931555Z                             evt_handled = True
2025-10-08T16:25:38.0931799Z                             break
2025-10-08T16:25:38.0932029Z                 if not evt_handled:
2025-10-08T16:25:38.0932279Z                     self.dialect.do_execute_no_params(
2025-10-08T16:25:38.0932553Z                         cursor, str_statement, context
2025-10-08T16:25:38.0932799Z                     )
2025-10-08T16:25:38.0932978Z             else:
2025-10-08T16:25:38.0933185Z                 effective_parameters = cast(
2025-10-08T16:25:38.0933489Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:25:38.0933764Z                 )
2025-10-08T16:25:38.0933958Z                 if self.dialect._has_events:
2025-10-08T16:25:38.0934240Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:25:38.0934513Z                         if fn(
2025-10-08T16:25:38.0934723Z                             cursor,
2025-10-08T16:25:38.0934954Z                             str_statement,
2025-10-08T16:25:38.0935327Z                             effective_parameters,
2025-10-08T16:25:38.0935583Z                             context,
2025-10-08T16:25:38.0935806Z                         ):
2025-10-08T16:25:38.0936027Z                             evt_handled = True
2025-10-08T16:25:38.0936267Z                             break
2025-10-08T16:25:38.0936488Z                 if not evt_handled:
2025-10-08T16:25:38.0936728Z >                   self.dialect.do_execute(
2025-10-08T16:25:38.0937024Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:25:38.0937420Z                     )
2025-10-08T16:25:38.0937542Z 
2025-10-08T16:25:38.0937838Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:25:38.0938325Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:38.0938527Z 
2025-10-08T16:25:38.0938794Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f90842b02f0>
2025-10-08T16:25:38.0939544Z cursor = <sqlite3.Cursor object at 0x7f907a53ac40>
2025-10-08T16:25:38.0940365Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:38.0941138Z parameters = (1,)
2025-10-08T16:25:38.0941523Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f907a564a50>
2025-10-08T16:25:38.0941879Z 
2025-10-08T16:25:38.0942047Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:38.0942394Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:38.0942697Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:25:38.0942896Z 
2025-10-08T16:25:38.0943257Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:38.0943692Z 
2025-10-08T16:25:38.0943868Z The above exception was the direct cause of the following exception:
2025-10-08T16:25:38.0944123Z 
2025-10-08T16:25:38.0944202Z app = <Flask 'app'>
2025-10-08T16:25:38.0944318Z 
2025-10-08T16:25:38.0944423Z     def test_api_reply_subscriptions(app):
2025-10-08T16:25:38.0944682Z         with app.app_context():
2025-10-08T16:25:38.0944992Z             from app.api.alpha.utils.reply import put_reply_subscribe
2025-10-08T16:25:38.0945299Z     
2025-10-08T16:25:38.0945470Z             user_id = 1
2025-10-08T16:25:38.0945686Z >           user = User.query.get(user_id)
2025-10-08T16:25:38.0945935Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:38.0946091Z 
2025-10-08T16:25:38.0946198Z tests/test_api_reply_subscriptions.py:29: 
2025-10-08T16:25:38.0946484Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:38.0946762Z <string>:2: in get
2025-10-08T16:25:38.0946949Z     ???
2025-10-08T16:25:38.0947387Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:25:38.0947955Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:25:38.0948257Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:38.0948692Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:25:38.0949327Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:25:38.0949640Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:38.0950117Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:25:38.0950597Z     return self.session._get_impl(
2025-10-08T16:25:38.0951067Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:25:38.0951537Z     return db_load_fn(
2025-10-08T16:25:38.0952128Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:25:38.0952636Z     session.execute(
2025-10-08T16:25:38.0953058Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:25:38.0953528Z     return self._execute_internal(
2025-10-08T16:25:38.0954022Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:25:38.0954690Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:25:38.0955278Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:25:38.0955797Z     result = conn.execute(
2025-10-08T16:25:38.0956229Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:25:38.0956685Z     return meth(
2025-10-08T16:25:38.0957161Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:25:38.0957704Z     return connection._execute_clauseelement(
2025-10-08T16:25:38.0958238Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:25:38.0958761Z     ret = self._execute_context(
2025-10-08T16:25:38.0959366Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:25:38.0959883Z     return self._exec_single_context(
2025-10-08T16:25:38.0960389Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:25:38.0960909Z     self._handle_dbapi_exception(
2025-10-08T16:25:38.0961425Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:25:38.0962024Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:25:38.0962606Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:25:38.0963118Z     self.dialect.do_execute(
2025-10-08T16:25:38.0963383Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:38.0963583Z 
2025-10-08T16:25:38.0963851Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f90842b02f0>
2025-10-08T16:25:38.0964312Z cursor = <sqlite3.Cursor object at 0x7f907a53ac40>
2025-10-08T16:25:38.0965121Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:38.0965885Z parameters = (1,)
2025-10-08T16:25:38.0966264Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f907a564a50>
2025-10-08T16:25:38.0966617Z 
2025-10-08T16:25:38.0966777Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:38.0967125Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:38.0967533Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:38.0982740Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:38.0998127Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:38.0998792Z E       WHERE user.id = ?]
2025-10-08T16:25:38.0999007Z E       [parameters: (1,)]
2025-10-08T16:25:38.0999418Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:38.0999663Z 
2025-10-08T16:25:38.1000027Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:38.1000612Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:25:38.1000948Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:38.1001276Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:38.1001688Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:38.1002037Z =============================== warnings summary ===============================
2025-10-08T16:25:38.1002428Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions
2025-10-08T16:25:38.1003387Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:38.1004285Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:38.1004488Z 
2025-10-08T16:25:38.1004661Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions
2025-10-08T16:25:38.1005599Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:38.5729842Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:38.5730303Z 
2025-10-08T16:25:38.5730681Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions
2025-10-08T16:25:38.5731976Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:38.5733457Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:38.5733963Z 
2025-10-08T16:25:38.5734238Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions
2025-10-08T16:25:38.5735449Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:38.5736832Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:38.5737340Z 
2025-10-08T16:25:38.5737610Z tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions
2025-10-08T16:25:38.5740100Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_reply_subscriptions.py:29: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:25:38.5742072Z     user = User.query.get(user_id)
2025-10-08T16:25:38.5742318Z 
2025-10-08T16:25:38.5742600Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:38.5743187Z =========================== short test summary info ============================
2025-10-08T16:25:38.5744249Z FAILED tests/test_api_reply_subscriptions.py::test_api_reply_subscriptions - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:38.5769704Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:38.5794903Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:38.5795915Z WHERE user.id = ?]
2025-10-08T16:25:38.5796189Z [parameters: (1,)]
2025-10-08T16:25:38.5796602Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:38.5797168Z ======================== 1 failed, 5 warnings in 2.55s =========================
2025-10-08T16:25:39.2325981Z ============================= test session starts ==============================
2025-10-08T16:25:39.2326974Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:39.2327847Z cachedir: .pytest_cache
2025-10-08T16:25:39.2328268Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:39.2328738Z plugins: anyio-4.11.0
2025-10-08T16:25:39.2811302Z collecting ... collected 8 items
2025-10-08T16:25:39.2811630Z 
2025-10-08T16:25:40.3633819Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_secret_authentication_required ERROR [ 12%]
2025-10-08T16:25:40.3753255Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_correct_secret_authentication ERROR [ 25%]
2025-10-08T16:25:40.3846612Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_feature_toggle_security ERROR [ 37%]
2025-10-08T16:25:40.3940443Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_ip_whitelist_enforcement ERROR [ 50%]
2025-10-08T16:25:40.4035370Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_input_sanitization ERROR [ 62%]
2025-10-08T16:25:40.4128980Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_constant_time_secret_comparison ERROR [ 75%]
2025-10-08T16:25:40.4222741Z tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_error_information_disclosure ERROR [ 87%]
2025-10-08T16:25:40.4335384Z tests/test_private_registration_security_focused.py::TestBasicRateLimit::test_basic_rate_limiting ERROR [100%]
2025-10-08T16:25:40.4336499Z 
2025-10-08T16:25:40.4336712Z ==================================== ERRORS ====================================
2025-10-08T16:25:40.4337504Z _ ERROR at setup of TestCoreSecurityProtocols.test_secret_authentication_required _
2025-10-08T16:25:40.4338095Z 
2025-10-08T16:25:40.4338236Z     @pytest.fixture
2025-10-08T16:25:40.4338595Z     def security_app():
2025-10-08T16:25:40.4339005Z         """Create test app with security focus"""
2025-10-08T16:25:40.4339992Z         test_env = {
2025-10-08T16:25:40.4340391Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.4341015Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.4341737Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.4342312Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.4342720Z         }
2025-10-08T16:25:40.4342998Z     
2025-10-08T16:25:40.4343332Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.4343848Z             from app import create_app, db
2025-10-08T16:25:40.4344393Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.4344928Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4345237Z 
2025-10-08T16:25:40.4345493Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.4346061Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.4346445Z 
2025-10-08T16:25:40.4346902Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.4347506Z 
2025-10-08T16:25:40.4347667Z     def create_app(config_class=Config):
2025-10-08T16:25:40.4348061Z         app = Flask(__name__)
2025-10-08T16:25:40.4348425Z         app.config.from_object(config_class)
2025-10-08T16:25:40.4348798Z     
2025-10-08T16:25:40.4349257Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.4349619Z             import sentry_sdk
2025-10-08T16:25:40.4349953Z             sentry_sdk.init(
2025-10-08T16:25:40.4350294Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.4350671Z                 enable_tracing=False,
2025-10-08T16:25:40.4351027Z             )
2025-10-08T16:25:40.4351274Z     
2025-10-08T16:25:40.4351568Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.4351968Z     
2025-10-08T16:25:40.4352272Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.4352741Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.4353146Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.4353553Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.4353933Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4354288Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.4354528Z 
2025-10-08T16:25:40.4354655Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.4355196Z _ ERROR at setup of TestCoreSecurityProtocols.test_correct_secret_authentication _
2025-10-08T16:25:40.4355662Z 
2025-10-08T16:25:40.4355778Z     @pytest.fixture
2025-10-08T16:25:40.4356056Z     def security_app():
2025-10-08T16:25:40.4356394Z         """Create test app with security focus"""
2025-10-08T16:25:40.4356791Z         test_env = {
2025-10-08T16:25:40.4357113Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.4357626Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.4358185Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.4358663Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.4359012Z         }
2025-10-08T16:25:40.4359397Z     
2025-10-08T16:25:40.4359667Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.4360068Z             from app import create_app, db
2025-10-08T16:25:40.4360506Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.4360956Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4361508Z 
2025-10-08T16:25:40.4361738Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.4362252Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.4362566Z 
2025-10-08T16:25:40.4363054Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.4363634Z 
2025-10-08T16:25:40.4363779Z     def create_app(config_class=Config):
2025-10-08T16:25:40.4364343Z         app = Flask(__name__)
2025-10-08T16:25:40.4364695Z         app.config.from_object(config_class)
2025-10-08T16:25:40.4365061Z     
2025-10-08T16:25:40.4365301Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.4365662Z             import sentry_sdk
2025-10-08T16:25:40.4365996Z             sentry_sdk.init(
2025-10-08T16:25:40.4366351Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.4366748Z                 enable_tracing=False,
2025-10-08T16:25:40.4367081Z             )
2025-10-08T16:25:40.4367331Z     
2025-10-08T16:25:40.4367634Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.4368022Z     
2025-10-08T16:25:40.4368329Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.4368768Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.4369429Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.4369833Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.4370196Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4370569Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.4370810Z 
2025-10-08T16:25:40.4370933Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.4371443Z ___ ERROR at setup of TestCoreSecurityProtocols.test_feature_toggle_security ___
2025-10-08T16:25:40.4371890Z 
2025-10-08T16:25:40.4372002Z     @pytest.fixture
2025-10-08T16:25:40.4372287Z     def security_app():
2025-10-08T16:25:40.4372618Z         """Create test app with security focus"""
2025-10-08T16:25:40.4373002Z         test_env = {
2025-10-08T16:25:40.4373320Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.4373830Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.4374399Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.4374880Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.4375222Z         }
2025-10-08T16:25:40.4375455Z     
2025-10-08T16:25:40.4375726Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.4376161Z             from app import create_app, db
2025-10-08T16:25:40.4376599Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.4377033Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4377298Z 
2025-10-08T16:25:40.4377504Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.4378003Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.4378301Z 
2025-10-08T16:25:40.4378749Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.4379474Z 
2025-10-08T16:25:40.4379612Z     def create_app(config_class=Config):
2025-10-08T16:25:40.4379985Z         app = Flask(__name__)
2025-10-08T16:25:40.4380340Z         app.config.from_object(config_class)
2025-10-08T16:25:40.4380703Z     
2025-10-08T16:25:40.4380957Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.4381328Z             import sentry_sdk
2025-10-08T16:25:40.4381646Z             sentry_sdk.init(
2025-10-08T16:25:40.4381993Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.4382396Z                 enable_tracing=False,
2025-10-08T16:25:40.4382739Z             )
2025-10-08T16:25:40.4382969Z     
2025-10-08T16:25:40.4383259Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.4383649Z     
2025-10-08T16:25:40.4383937Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.4384564Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.4384993Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.4385407Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.4385781Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4386146Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.4386384Z 
2025-10-08T16:25:40.4386513Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.4387039Z __ ERROR at setup of TestCoreSecurityProtocols.test_ip_whitelist_enforcement ___
2025-10-08T16:25:40.4387682Z 
2025-10-08T16:25:40.4387796Z     @pytest.fixture
2025-10-08T16:25:40.4388077Z     def security_app():
2025-10-08T16:25:40.4388398Z         """Create test app with security focus"""
2025-10-08T16:25:40.4388783Z         test_env = {
2025-10-08T16:25:40.4389242Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.4389744Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.4390304Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.4390771Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.4391109Z         }
2025-10-08T16:25:40.4391336Z     
2025-10-08T16:25:40.4391615Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.4392018Z             from app import create_app, db
2025-10-08T16:25:40.4392452Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.4392891Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4393162Z 
2025-10-08T16:25:40.4393360Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.4393858Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.4394161Z 
2025-10-08T16:25:40.4394603Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.4395180Z 
2025-10-08T16:25:40.4395316Z     def create_app(config_class=Config):
2025-10-08T16:25:40.4395697Z         app = Flask(__name__)
2025-10-08T16:25:40.4396059Z         app.config.from_object(config_class)
2025-10-08T16:25:40.4396413Z     
2025-10-08T16:25:40.4396671Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.4397027Z             import sentry_sdk
2025-10-08T16:25:40.4397348Z             sentry_sdk.init(
2025-10-08T16:25:40.4397697Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.4398098Z                 enable_tracing=False,
2025-10-08T16:25:40.4398455Z             )
2025-10-08T16:25:40.4398686Z     
2025-10-08T16:25:40.4399008Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.4399556Z     
2025-10-08T16:25:40.4399858Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.4400288Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.4400700Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.4401151Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.4401523Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4401884Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.4402114Z 
2025-10-08T16:25:40.4402240Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.4402804Z _____ ERROR at setup of TestCoreSecurityProtocols.test_input_sanitization ______
2025-10-08T16:25:40.4403262Z 
2025-10-08T16:25:40.4403372Z     @pytest.fixture
2025-10-08T16:25:40.4403663Z     def security_app():
2025-10-08T16:25:40.4404000Z         """Create test app with security focus"""
2025-10-08T16:25:40.4404371Z         test_env = {
2025-10-08T16:25:40.4404690Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.4405190Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.4405731Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.4406184Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.4406521Z         }
2025-10-08T16:25:40.4406746Z     
2025-10-08T16:25:40.4407203Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.4407616Z             from app import create_app, db
2025-10-08T16:25:40.4408057Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.4408476Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4408739Z 
2025-10-08T16:25:40.4408948Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.4409583Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.4410070Z 
2025-10-08T16:25:40.4410494Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.4411067Z 
2025-10-08T16:25:40.4411202Z     def create_app(config_class=Config):
2025-10-08T16:25:40.4411571Z         app = Flask(__name__)
2025-10-08T16:25:40.4411930Z         app.config.from_object(config_class)
2025-10-08T16:25:40.4412285Z     
2025-10-08T16:25:40.4412540Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.4412906Z             import sentry_sdk
2025-10-08T16:25:40.4413222Z             sentry_sdk.init(
2025-10-08T16:25:40.4413565Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.4413950Z                 enable_tracing=False,
2025-10-08T16:25:40.4414276Z             )
2025-10-08T16:25:40.4414508Z     
2025-10-08T16:25:40.4414815Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.4415217Z     
2025-10-08T16:25:40.4415516Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.4415977Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.4416385Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.4416779Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.4417148Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.4417494Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.4417729Z 
2025-10-08T16:25:40.4417847Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.4418388Z _ ERROR at setup of TestCoreSecurityProtocols.test_constant_time_secret_comparison _
2025-10-08T16:25:40.4418866Z 
2025-10-08T16:25:40.4418977Z     @pytest.fixture
2025-10-08T16:25:40.4419417Z     def security_app():
2025-10-08T16:25:40.4419731Z         """Create test app with security focus"""
2025-10-08T16:25:40.4420088Z         test_env = {
2025-10-08T16:25:40.6578330Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.6579001Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.6579939Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.6580426Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.6580745Z         }
2025-10-08T16:25:40.6580963Z     
2025-10-08T16:25:40.6581228Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.6581607Z             from app import create_app, db
2025-10-08T16:25:40.6582013Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.6582441Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6582680Z 
2025-10-08T16:25:40.6582886Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.6583348Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.6583629Z 
2025-10-08T16:25:40.6584030Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.6584564Z 
2025-10-08T16:25:40.6584695Z     def create_app(config_class=Config):
2025-10-08T16:25:40.6585055Z         app = Flask(__name__)
2025-10-08T16:25:40.6585383Z         app.config.from_object(config_class)
2025-10-08T16:25:40.6585729Z     
2025-10-08T16:25:40.6585966Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.6586292Z             import sentry_sdk
2025-10-08T16:25:40.6586589Z             sentry_sdk.init(
2025-10-08T16:25:40.6586906Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.6587261Z                 enable_tracing=False,
2025-10-08T16:25:40.6587871Z             )
2025-10-08T16:25:40.6588104Z     
2025-10-08T16:25:40.6588381Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.6588739Z     
2025-10-08T16:25:40.6589169Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.6589504Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.6589804Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.6590101Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.6590600Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6590839Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6590993Z 
2025-10-08T16:25:40.6591077Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.6591434Z _ ERROR at setup of TestCoreSecurityProtocols.test_error_information_disclosure _
2025-10-08T16:25:40.6591729Z 
2025-10-08T16:25:40.6591808Z     @pytest.fixture
2025-10-08T16:25:40.6591998Z     def security_app():
2025-10-08T16:25:40.6592224Z         """Create test app with security focus"""
2025-10-08T16:25:40.6592490Z         test_env = {
2025-10-08T16:25:40.6592715Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.6593066Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.6593446Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.6593760Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.6593984Z         }
2025-10-08T16:25:40.6594141Z     
2025-10-08T16:25:40.6594332Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.6594602Z             from app import create_app, db
2025-10-08T16:25:40.6594900Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.6595194Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6595361Z 
2025-10-08T16:25:40.6595505Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.6595828Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.6596034Z 
2025-10-08T16:25:40.6596314Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.6596682Z 
2025-10-08T16:25:40.6596784Z     def create_app(config_class=Config):
2025-10-08T16:25:40.6597036Z         app = Flask(__name__)
2025-10-08T16:25:40.6597276Z         app.config.from_object(config_class)
2025-10-08T16:25:40.6597515Z     
2025-10-08T16:25:40.6597692Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.6597932Z             import sentry_sdk
2025-10-08T16:25:40.6598154Z             sentry_sdk.init(
2025-10-08T16:25:40.6598386Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.6598636Z                 enable_tracing=False,
2025-10-08T16:25:40.6598859Z             )
2025-10-08T16:25:40.6599124Z     
2025-10-08T16:25:40.6599329Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.6599587Z     
2025-10-08T16:25:40.6599792Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.6600083Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.6600354Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.6600615Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.6600860Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6601095Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6601255Z 
2025-10-08T16:25:40.6601337Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.6601667Z ________ ERROR at setup of TestBasicRateLimit.test_basic_rate_limiting _________
2025-10-08T16:25:40.6601947Z 
2025-10-08T16:25:40.6602022Z     @pytest.fixture
2025-10-08T16:25:40.6602218Z     def security_app():
2025-10-08T16:25:40.6602448Z         """Create test app with security focus"""
2025-10-08T16:25:40.6602709Z         test_env = {
2025-10-08T16:25:40.6602925Z             'PRIVATE_REGISTRATION_ENABLED': 'true',
2025-10-08T16:25:40.6603260Z             'PRIVATE_REGISTRATION_SECRET': 'secure-test-secret-2024',
2025-10-08T16:25:40.6603757Z             'PRIVATE_REGISTRATION_ALLOWED_IPS': '127.0.0.1,10.0.0.0/8',
2025-10-08T16:25:40.6604071Z             'SERVER_NAME': 'localhost'
2025-10-08T16:25:40.6604298Z         }
2025-10-08T16:25:40.6604454Z     
2025-10-08T16:25:40.6604634Z         with patch.dict(os.environ, test_env):
2025-10-08T16:25:40.6604903Z             from app import create_app, db
2025-10-08T16:25:40.6605199Z >           app = create_app(PrivateRegSecurityTestConfig)
2025-10-08T16:25:40.6605673Z                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6605848Z 
2025-10-08T16:25:40.6605985Z tests/test_private_registration_security_focused.py:47: 
2025-10-08T16:25:40.6606310Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:40.6606507Z 
2025-10-08T16:25:40.6606786Z config_class = <class 'tests.test_private_registration_security_focused.PrivateRegSecurityTestConfig'>
2025-10-08T16:25:40.6607151Z 
2025-10-08T16:25:40.6607251Z     def create_app(config_class=Config):
2025-10-08T16:25:40.6607509Z         app = Flask(__name__)
2025-10-08T16:25:40.6607748Z         app.config.from_object(config_class)
2025-10-08T16:25:40.6607987Z     
2025-10-08T16:25:40.6608153Z         if app.config['SENTRY_DSN']:
2025-10-08T16:25:40.6608388Z             import sentry_sdk
2025-10-08T16:25:40.6608604Z             sentry_sdk.init(
2025-10-08T16:25:40.6608827Z                 dsn=app.config["SENTRY_DSN"],
2025-10-08T16:25:40.6609177Z                 enable_tracing=False,
2025-10-08T16:25:40.6609406Z             )
2025-10-08T16:25:40.6609563Z     
2025-10-08T16:25:40.6609762Z         app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1)
2025-10-08T16:25:40.6610016Z     
2025-10-08T16:25:40.6610209Z         app.config["API_TITLE"] = "PieFed 1.3 Alpha API"
2025-10-08T16:25:40.6610499Z         app.config["API_VERSION"] = "alpha 1.3"
2025-10-08T16:25:40.6610768Z         app.config["OPENAPI_VERSION"] = "3.1.1"
2025-10-08T16:25:40.6611028Z >       if app.config["SERVE_API_DOCS"]:
2025-10-08T16:25:40.6611269Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:40.6611505Z E       KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6611666Z 
2025-10-08T16:25:40.6611756Z app/__init__.py:82: KeyError
2025-10-08T16:25:40.6612009Z =========================== short test summary info ============================
2025-10-08T16:25:40.6612686Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_secret_authentication_required - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6613636Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_correct_secret_authentication - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6614549Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_feature_toggle_security - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6615442Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_ip_whitelist_enforcement - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6616325Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_input_sanitization - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6617233Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_constant_time_secret_comparison - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6618162Z ERROR tests/test_private_registration_security_focused.py::TestCoreSecurityProtocols::test_error_information_disclosure - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6619147Z ERROR tests/test_private_registration_security_focused.py::TestBasicRateLimit::test_basic_rate_limiting - KeyError: 'SERVE_API_DOCS'
2025-10-08T16:25:40.6619855Z ============================== 8 errors in 1.21s ===============================
2025-10-08T16:25:41.0734346Z ============================= test session starts ==============================
2025-10-08T16:25:41.0735269Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:41.0735831Z cachedir: .pytest_cache
2025-10-08T16:25:41.0736113Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:41.0736429Z plugins: anyio-4.11.0
2025-10-08T16:25:42.1440548Z collecting ... collected 1 item
2025-10-08T16:25:42.1440825Z 
2025-10-08T16:25:43.7156649Z tests/test_api_get_site.py::test_api_get_site FAILED                     [100%]
2025-10-08T16:25:43.7157203Z 
2025-10-08T16:25:43.7157417Z =================================== FAILURES ===================================
2025-10-08T16:25:43.7158460Z ______________________________ test_api_get_site _______________________________
2025-10-08T16:25:43.7158898Z 
2025-10-08T16:25:43.7159731Z self = <sqlalchemy.engine.base.Connection object at 0x7f4689117a80>
2025-10-08T16:25:43.7160760Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f4692abc2f0>
2025-10-08T16:25:43.7161944Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f4688d58550>
2025-10-08T16:25:43.7162961Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f4689342cf0>
2025-10-08T16:25:43.7163608Z parameters = [(1,)]
2025-10-08T16:25:43.7163801Z 
2025-10-08T16:25:43.7163939Z     def _exec_single_context(
2025-10-08T16:25:43.7164261Z         self,
2025-10-08T16:25:43.7164535Z         dialect: Dialect,
2025-10-08T16:25:43.7164861Z         context: ExecutionContext,
2025-10-08T16:25:43.7165252Z         statement: Union[str, Compiled],
2025-10-08T16:25:43.7165699Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:25:43.7166126Z     ) -> CursorResult[Any]:
2025-10-08T16:25:43.7166554Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:25:43.7167073Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:25:43.7167484Z     
2025-10-08T16:25:43.7167723Z         """
2025-10-08T16:25:43.7168078Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:25:43.7168659Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:25:43.7169342Z     
2025-10-08T16:25:43.7169607Z             if generic_setinputsizes:
2025-10-08T16:25:43.7169973Z                 try:
2025-10-08T16:25:43.7170285Z                     dialect.do_set_input_sizes(
2025-10-08T16:25:43.7170730Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:25:43.7171139Z                     )
2025-10-08T16:25:43.7171437Z                 except BaseException as e:
2025-10-08T16:25:43.7171842Z                     self._handle_dbapi_exception(
2025-10-08T16:25:43.7172271Z                         e, str(statement), parameters, None, context
2025-10-08T16:25:43.7172676Z                     )
2025-10-08T16:25:43.7172943Z     
2025-10-08T16:25:43.7173215Z         cursor, str_statement, parameters = (
2025-10-08T16:25:43.7173589Z             context.cursor,
2025-10-08T16:25:43.7173912Z             context.statement,
2025-10-08T16:25:43.7174240Z             context.parameters,
2025-10-08T16:25:43.7174557Z         )
2025-10-08T16:25:43.7174793Z     
2025-10-08T16:25:43.7175118Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:25:43.7175532Z     
2025-10-08T16:25:43.7175781Z         if not context.executemany:
2025-10-08T16:25:43.7176169Z             effective_parameters = parameters[0]
2025-10-08T16:25:43.7176533Z         else:
2025-10-08T16:25:43.7176815Z             effective_parameters = parameters
2025-10-08T16:25:43.7177159Z     
2025-10-08T16:25:43.7177511Z         if self._has_events or self.engine._has_events:
2025-10-08T16:25:43.7177972Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:25:43.7178430Z                 str_statement, effective_parameters = fn(
2025-10-08T16:25:43.7178829Z                     self,
2025-10-08T16:25:43.7179288Z                     cursor,
2025-10-08T16:25:43.7179598Z                     str_statement,
2025-10-08T16:25:43.7179947Z                     effective_parameters,
2025-10-08T16:25:43.7180541Z                     context,
2025-10-08T16:25:43.7180882Z                     context.executemany,
2025-10-08T16:25:43.7181222Z                 )
2025-10-08T16:25:43.7181467Z     
2025-10-08T16:25:43.7181696Z         if self._echo:
2025-10-08T16:25:43.7182003Z             self._log_info(str_statement)
2025-10-08T16:25:43.7182348Z     
2025-10-08T16:25:43.7182609Z             stats = context._get_cache_stats()
2025-10-08T16:25:43.7182958Z     
2025-10-08T16:25:43.7183222Z             if not self.engine.hide_parameters:
2025-10-08T16:25:43.7183770Z                 self._log_info(
2025-10-08T16:25:43.7184075Z                     "[%s] %r",
2025-10-08T16:25:43.7184385Z                     stats,
2025-10-08T16:25:43.7184697Z                     sql_util._repr_params(
2025-10-08T16:25:43.7185093Z                         effective_parameters,
2025-10-08T16:25:43.7185456Z                         batches=10,
2025-10-08T16:25:43.7185825Z                         ismulti=context.executemany,
2025-10-08T16:25:43.7186210Z                     ),
2025-10-08T16:25:43.7186483Z                 )
2025-10-08T16:25:43.7186741Z             else:
2025-10-08T16:25:43.7187003Z                 self._log_info(
2025-10-08T16:25:43.7187410Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:25:43.7187867Z                     stats,
2025-10-08T16:25:43.7188149Z                 )
2025-10-08T16:25:43.7188386Z     
2025-10-08T16:25:43.7188628Z         evt_handled: bool = False
2025-10-08T16:25:43.7188959Z         try:
2025-10-08T16:25:43.7189460Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:25:43.7189934Z                 effective_parameters = cast(
2025-10-08T16:25:43.7190369Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:25:43.7190777Z                 )
2025-10-08T16:25:43.7191052Z                 if self.dialect._has_events:
2025-10-08T16:25:43.7191467Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:25:43.7191897Z                         if fn(
2025-10-08T16:25:43.7192202Z                             cursor,
2025-10-08T16:25:43.7192535Z                             str_statement,
2025-10-08T16:25:43.7192905Z                             effective_parameters,
2025-10-08T16:25:43.7193269Z                             context,
2025-10-08T16:25:43.7193605Z                         ):
2025-10-08T16:25:43.7193921Z                             evt_handled = True
2025-10-08T16:25:43.7194274Z                             break
2025-10-08T16:25:43.7194603Z                 if not evt_handled:
2025-10-08T16:25:43.7194977Z                     self.dialect.do_executemany(
2025-10-08T16:25:43.7195350Z                         cursor,
2025-10-08T16:25:43.7195652Z                         str_statement,
2025-10-08T16:25:43.7196019Z                         effective_parameters,
2025-10-08T16:25:43.7196408Z                         context,
2025-10-08T16:25:43.7196723Z                     )
2025-10-08T16:25:43.7197119Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:25:43.7197586Z                 if self.dialect._has_events:
2025-10-08T16:25:43.7198054Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:25:43.7198557Z                         if fn(cursor, str_statement, context):
2025-10-08T16:25:43.7198976Z                             evt_handled = True
2025-10-08T16:25:43.7199558Z                             break
2025-10-08T16:25:43.7199898Z                 if not evt_handled:
2025-10-08T16:25:43.7200276Z                     self.dialect.do_execute_no_params(
2025-10-08T16:25:43.7200684Z                         cursor, str_statement, context
2025-10-08T16:25:43.7201038Z                     )
2025-10-08T16:25:43.7201301Z             else:
2025-10-08T16:25:43.7201586Z                 effective_parameters = cast(
2025-10-08T16:25:43.7202030Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:25:43.7202445Z                 )
2025-10-08T16:25:43.7202902Z                 if self.dialect._has_events:
2025-10-08T16:25:43.7203339Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:25:43.7203741Z                         if fn(
2025-10-08T16:25:43.7204068Z                             cursor,
2025-10-08T16:25:43.7204402Z                             str_statement,
2025-10-08T16:25:43.7204775Z                             effective_parameters,
2025-10-08T16:25:43.7205142Z                             context,
2025-10-08T16:25:43.7205669Z                         ):
2025-10-08T16:25:43.7205991Z                             evt_handled = True
2025-10-08T16:25:43.7206344Z                             break
2025-10-08T16:25:43.7206662Z                 if not evt_handled:
2025-10-08T16:25:43.7207009Z >                   self.dialect.do_execute(
2025-10-08T16:25:43.7207453Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:25:43.7207894Z                     )
2025-10-08T16:25:43.7208062Z 
2025-10-08T16:25:43.7208524Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:25:43.7209439Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:43.7209750Z 
2025-10-08T16:25:43.7210161Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f4692abc2f0>
2025-10-08T16:25:43.7210875Z cursor = <sqlite3.Cursor object at 0x7f4688d678c0>
2025-10-08T16:25:43.7212260Z statement = 'SELECT site.id AS site_id, site.name AS site_name, site.description AS site_description, site.icon_id AS site_icon_id..., site.private_instance AS site_private_instance, site.language_id AS site_language_id \nFROM site \nWHERE site.id = ?'
2025-10-08T16:25:43.7213566Z parameters = (1,)
2025-10-08T16:25:43.7214140Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f4688d58550>
2025-10-08T16:25:43.7214684Z 
2025-10-08T16:25:43.7214928Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:43.7215455Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:43.7215918Z E       sqlite3.OperationalError: no such table: site
2025-10-08T16:25:43.7216238Z 
2025-10-08T16:25:43.7216786Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:43.7217486Z 
2025-10-08T16:25:43.7217759Z The above exception was the direct cause of the following exception:
2025-10-08T16:25:43.7218155Z 
2025-10-08T16:25:43.7218276Z app = <Flask 'app'>
2025-10-08T16:25:43.7218447Z 
2025-10-08T16:25:43.7218573Z     def test_api_get_site(app):
2025-10-08T16:25:43.7218924Z         with app.app_context():
2025-10-08T16:25:43.7219477Z             from app.api.alpha.utils.site import get_site
2025-10-08T16:25:43.7219937Z >           g.site = Site.query.get(1)
2025-10-08T16:25:43.7220294Z                      ^^^^^^^^^^^^^^^^^
2025-10-08T16:25:43.7220522Z 
2025-10-08T16:25:43.7220655Z tests/test_api_get_site.py:27: 
2025-10-08T16:25:43.7221070Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:43.7221466Z <string>:2: in get
2025-10-08T16:25:43.7221734Z     ???
2025-10-08T16:25:43.7222395Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:25:43.7223235Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:25:43.7223679Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:43.7224347Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:25:43.7225143Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:25:43.7225604Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:43.7226316Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:25:43.7227024Z     return self.session._get_impl(
2025-10-08T16:25:43.7227920Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:25:43.7228673Z     return db_load_fn(
2025-10-08T16:25:43.7229561Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:25:43.7230354Z     session.execute(
2025-10-08T16:25:43.7230973Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:25:43.7231874Z     return self._execute_internal(
2025-10-08T16:25:43.7232652Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:25:43.7233529Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:25:43.7234433Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:25:43.7235224Z     result = conn.execute(
2025-10-08T16:25:43.7235887Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:25:43.7236569Z     return meth(
2025-10-08T16:25:43.7237299Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:25:43.7238162Z     return connection._execute_clauseelement(
2025-10-08T16:25:43.7238993Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:25:43.7240038Z     ret = self._execute_context(
2025-10-08T16:25:43.7240772Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:25:43.7241546Z     return self._exec_single_context(
2025-10-08T16:25:43.7242322Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:25:43.7243133Z     self._handle_dbapi_exception(
2025-10-08T16:25:43.7243924Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:25:43.7244854Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:25:43.7245757Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:25:43.7246579Z     self.dialect.do_execute(
2025-10-08T16:25:43.7246959Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:43.7247261Z 
2025-10-08T16:25:43.7247655Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f4692abc2f0>
2025-10-08T16:25:43.7248372Z cursor = <sqlite3.Cursor object at 0x7f4688d678c0>
2025-10-08T16:25:43.7249890Z statement = 'SELECT site.id AS site_id, site.name AS site_name, site.description AS site_description, site.icon_id AS site_icon_id..., site.private_instance AS site_private_instance, site.language_id AS site_language_id \nFROM site \nWHERE site.id = ?'
2025-10-08T16:25:43.7251242Z parameters = (1,)
2025-10-08T16:25:43.7251846Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f4688d58550>
2025-10-08T16:25:43.7252375Z 
2025-10-08T16:25:43.7252616Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:43.7253129Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:43.7253745Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: site
2025-10-08T16:25:43.7263683Z E       [SQL: SELECT site.id AS site_id, site.name AS site_name, site.description AS site_description, site.icon_id AS site_icon_id, site.sidebar AS site_sidebar, site.sidebar_html AS site_sidebar_html, site.legal_information AS site_legal_information, site.legal_information_html AS site_legal_information_html, site.tos_url AS site_tos_url, site.privacy_url AS site_privacy_url, site.public_key AS site_public_key, site.private_key AS site_private_key, site.enable_downvotes AS site_enable_downvotes, site.enable_gif_reply_rep_decrease AS site_enable_gif_reply_rep_decrease, site.enable_chan_image_filter AS site_enable_chan_image_filter, site.enable_this_comment_filter AS site_enable_this_comment_filter, site.allow_local_image_posts AS site_allow_local_image_posts, site.remote_image_cache_days AS site_remote_image_cache_days, site.enable_nsfw AS site_enable_nsfw, site.enable_nsfl AS site_enable_nsfl, site.community_creation_admin_only AS site_community_creation_admin_only, site.reports_email_admins AS site_reports_email_admins, site.registration_mode AS site_registration_mode, site.application_question AS site_application_question, site.allow_or_block_list AS site_allow_or_block_list, site.allowlist AS site_allowlist, site.blocklist AS site_blocklist, site.blocked_phrases AS site_blocked_phrases, site.auto_decline_referrers AS site_auto_decline_referrers, site.created_at AS site_created_at, site.updated AS site_updated, site.last_active AS site_last_active, site.log_activitypub_json AS site_log_activitypub_json, site.default_theme AS site_default_theme, site.default_filter AS site_default_filter, site.contact_email AS site_contact_email, site.about AS site_about, site.about_html AS site_about_html, site.logo AS site_logo, site.logo_180 AS site_logo_180, site.logo_152 AS site_logo_152, site.logo_32 AS site_logo_32, site.logo_16 AS site_logo_16, site.show_inoculation_block AS site_show_inoculation_block, site.additional_css AS site_additional_css, site.additional_js AS site_additional_js, site.private_instance AS site_private_instance, site.language_id AS site_language_id 
2025-10-08T16:25:43.7273822Z E       FROM site 
2025-10-08T16:25:43.7274109Z E       WHERE site.id = ?]
2025-10-08T16:25:43.7274436Z E       [parameters: (1,)]
2025-10-08T16:25:43.7274889Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:43.7275269Z 
2025-10-08T16:25:43.7275823Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:43.7276738Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:25:43.7277253Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:43.7277750Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:43.7278378Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:43.7278926Z =============================== warnings summary ===============================
2025-10-08T16:25:43.7279971Z tests/test_api_get_site.py::test_api_get_site
2025-10-08T16:25:43.7281228Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:43.7282382Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:43.7282674Z 
2025-10-08T16:25:43.7282829Z tests/test_api_get_site.py::test_api_get_site
2025-10-08T16:25:43.7293177Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:43.7294131Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:43.7294343Z 
2025-10-08T16:25:43.7294474Z tests/test_api_get_site.py::test_api_get_site
2025-10-08T16:25:43.7295191Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:43.7296049Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:43.7296374Z 
2025-10-08T16:25:43.7296497Z tests/test_api_get_site.py::test_api_get_site
2025-10-08T16:25:43.7297394Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:43.7298239Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:43.7298556Z 
2025-10-08T16:25:43.7298664Z tests/test_api_get_site.py::test_api_get_site
2025-10-08T16:25:43.7299920Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_get_site.py:27: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:25:43.7301118Z     g.site = Site.query.get(1)
2025-10-08T16:25:43.7301275Z 
2025-10-08T16:25:43.7301466Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:43.7301872Z =========================== short test summary info ============================
2025-10-08T16:25:43.7302463Z FAILED tests/test_api_get_site.py::test_api_get_site - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: site
2025-10-08T16:25:43.7308564Z [SQL: SELECT site.id AS site_id, site.name AS site_name, site.description AS site_description, site.icon_id AS site_icon_id, site.sidebar AS site_sidebar, site.sidebar_html AS site_sidebar_html, site.legal_information AS site_legal_information, site.legal_information_html AS site_legal_information_html, site.tos_url AS site_tos_url, site.privacy_url AS site_privacy_url, site.public_key AS site_public_key, site.private_key AS site_private_key, site.enable_downvotes AS site_enable_downvotes, site.enable_gif_reply_rep_decrease AS site_enable_gif_reply_rep_decrease, site.enable_chan_image_filter AS site_enable_chan_image_filter, site.enable_this_comment_filter AS site_enable_this_comment_filter, site.allow_local_image_posts AS site_allow_local_image_posts, site.remote_image_cache_days AS site_remote_image_cache_days, site.enable_nsfw AS site_enable_nsfw, site.enable_nsfl AS site_enable_nsfl, site.community_creation_admin_only AS site_community_creation_admin_only, site.reports_email_admins AS site_reports_email_admins, site.registration_mode AS site_registration_mode, site.application_question AS site_application_question, site.allow_or_block_list AS site_allow_or_block_list, site.allowlist AS site_allowlist, site.blocklist AS site_blocklist, site.blocked_phrases AS site_blocked_phrases, site.auto_decline_referrers AS site_auto_decline_referrers, site.created_at AS site_created_at, site.updated AS site_updated, site.last_active AS site_last_active, site.log_activitypub_json AS site_log_activitypub_json, site.default_theme AS site_default_theme, site.default_filter AS site_default_filter, site.contact_email AS site_contact_email, site.about AS site_about, site.about_html AS site_about_html, site.logo AS site_logo, site.logo_180 AS site_logo_180, site.logo_152 AS site_logo_152, site.logo_32 AS site_logo_32, site.logo_16 AS site_logo_16, site.show_inoculation_block AS site_show_inoculation_block, site.additional_css AS site_additional_css, site.additional_js AS site_additional_js, site.private_instance AS site_private_instance, site.language_id AS site_language_id 
2025-10-08T16:25:43.7314576Z FROM site 
2025-10-08T16:25:43.7314754Z WHERE site.id = ?]
2025-10-08T16:25:43.7314950Z [parameters: (1,)]
2025-10-08T16:25:44.2922274Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:44.2922831Z ======================== 1 failed, 5 warnings in 2.65s =========================
2025-10-08T16:25:45.0499361Z ============================= test session starts ==============================
2025-10-08T16:25:45.0499971Z platform linux -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- /opt/hostedtoolcache/Python/3.13.7/x64/bin/python
2025-10-08T16:25:45.0500443Z cachedir: .pytest_cache
2025-10-08T16:25:45.0500718Z rootdir: /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:45.0500983Z plugins: anyio-4.11.0
2025-10-08T16:25:46.1094337Z collecting ... collected 1 item
2025-10-08T16:25:46.1094768Z 
2025-10-08T16:25:47.6531382Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions FAILED [100%]
2025-10-08T16:25:47.6532064Z 
2025-10-08T16:25:47.6532318Z =================================== FAILURES ===================================
2025-10-08T16:25:47.6533105Z _________________________ test_api_post_subscriptions __________________________
2025-10-08T16:25:47.6533636Z 
2025-10-08T16:25:47.6534447Z self = <sqlalchemy.engine.base.Connection object at 0x7f61c970bce0>
2025-10-08T16:25:47.6535633Z dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f61d31b0440>
2025-10-08T16:25:47.6537011Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f61c9364a50>
2025-10-08T16:25:47.6538325Z statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x7f61c996d550>
2025-10-08T16:25:47.6538939Z parameters = [(1,)]
2025-10-08T16:25:47.6539459Z 
2025-10-08T16:25:47.6539640Z     def _exec_single_context(
2025-10-08T16:25:47.6540009Z         self,
2025-10-08T16:25:47.6540274Z         dialect: Dialect,
2025-10-08T16:25:47.6540539Z         context: ExecutionContext,
2025-10-08T16:25:47.6540840Z         statement: Union[str, Compiled],
2025-10-08T16:25:47.6541201Z         parameters: Optional[_AnyMultiExecuteParams],
2025-10-08T16:25:47.6541559Z     ) -> CursorResult[Any]:
2025-10-08T16:25:47.6541900Z         """continue the _execute_context() method for a single DBAPI
2025-10-08T16:25:47.6542294Z         cursor.execute() or cursor.executemany() call.
2025-10-08T16:25:47.6542619Z     
2025-10-08T16:25:47.6542823Z         """
2025-10-08T16:25:47.6543108Z         if dialect.bind_typing is BindTyping.SETINPUTSIZES:
2025-10-08T16:25:47.6543515Z             generic_setinputsizes = context._prepare_set_input_sizes()
2025-10-08T16:25:47.6543876Z     
2025-10-08T16:25:47.6544124Z             if generic_setinputsizes:
2025-10-08T16:25:47.6544423Z                 try:
2025-10-08T16:25:47.6544675Z                     dialect.do_set_input_sizes(
2025-10-08T16:25:47.6545015Z                         context.cursor, generic_setinputsizes, context
2025-10-08T16:25:47.6545396Z                     )
2025-10-08T16:25:47.6545647Z                 except BaseException as e:
2025-10-08T16:25:47.6545958Z                     self._handle_dbapi_exception(
2025-10-08T16:25:47.6546288Z                         e, str(statement), parameters, None, context
2025-10-08T16:25:47.6546635Z                     )
2025-10-08T16:25:47.6546902Z     
2025-10-08T16:25:47.6547149Z         cursor, str_statement, parameters = (
2025-10-08T16:25:47.6547458Z             context.cursor,
2025-10-08T16:25:47.6547743Z             context.statement,
2025-10-08T16:25:47.6548020Z             context.parameters,
2025-10-08T16:25:47.6548298Z         )
2025-10-08T16:25:47.6548534Z     
2025-10-08T16:25:47.6548805Z         effective_parameters: Optional[_AnyExecuteParams]
2025-10-08T16:25:47.6549306Z     
2025-10-08T16:25:47.6549538Z         if not context.executemany:
2025-10-08T16:25:47.6549846Z             effective_parameters = parameters[0]
2025-10-08T16:25:47.6550155Z         else:
2025-10-08T16:25:47.6550400Z             effective_parameters = parameters
2025-10-08T16:25:47.6550684Z     
2025-10-08T16:25:47.6550939Z         if self._has_events or self.engine._has_events:
2025-10-08T16:25:47.6551315Z             for fn in self.dispatch.before_cursor_execute:
2025-10-08T16:25:47.6551676Z                 str_statement, effective_parameters = fn(
2025-10-08T16:25:47.6551996Z                     self,
2025-10-08T16:25:47.6552255Z                     cursor,
2025-10-08T16:25:47.6552509Z                     str_statement,
2025-10-08T16:25:47.6552807Z                     effective_parameters,
2025-10-08T16:25:47.6553103Z                     context,
2025-10-08T16:25:47.6553384Z                     context.executemany,
2025-10-08T16:25:47.6553666Z                 )
2025-10-08T16:25:47.6553914Z     
2025-10-08T16:25:47.6554299Z         if self._echo:
2025-10-08T16:25:47.6554569Z             self._log_info(str_statement)
2025-10-08T16:25:47.6554863Z     
2025-10-08T16:25:47.6555106Z             stats = context._get_cache_stats()
2025-10-08T16:25:47.6555405Z     
2025-10-08T16:25:47.6555644Z             if not self.engine.hide_parameters:
2025-10-08T16:25:47.6555960Z                 self._log_info(
2025-10-08T16:25:47.6556230Z                     "[%s] %r",
2025-10-08T16:25:47.6556506Z                     stats,
2025-10-08T16:25:47.6556888Z                     sql_util._repr_params(
2025-10-08T16:25:47.6557207Z                         effective_parameters,
2025-10-08T16:25:47.6557517Z                         batches=10,
2025-10-08T16:25:47.6557813Z                         ismulti=context.executemany,
2025-10-08T16:25:47.6558123Z                     ),
2025-10-08T16:25:47.6558361Z                 )
2025-10-08T16:25:47.6558606Z             else:
2025-10-08T16:25:47.6558843Z                 self._log_info(
2025-10-08T16:25:47.6559362Z                     "[%s] [SQL parameters hidden due to hide_parameters=True]",
2025-10-08T16:25:47.6559727Z                     stats,
2025-10-08T16:25:47.6559993Z                 )
2025-10-08T16:25:47.6560239Z     
2025-10-08T16:25:47.6560487Z         evt_handled: bool = False
2025-10-08T16:25:47.6560778Z         try:
2025-10-08T16:25:47.6561074Z             if context.execute_style is ExecuteStyle.EXECUTEMANY:
2025-10-08T16:25:47.6561432Z                 effective_parameters = cast(
2025-10-08T16:25:47.6561784Z                     "_CoreMultiExecuteParams", effective_parameters
2025-10-08T16:25:47.6562117Z                 )
2025-10-08T16:25:47.6562350Z                 if self.dialect._has_events:
2025-10-08T16:25:47.6562692Z                     for fn in self.dialect.dispatch.do_executemany:
2025-10-08T16:25:47.6563040Z                         if fn(
2025-10-08T16:25:47.6563321Z                             cursor,
2025-10-08T16:25:47.6563611Z                             str_statement,
2025-10-08T16:25:47.6563908Z                             effective_parameters,
2025-10-08T16:25:47.6564214Z                             context,
2025-10-08T16:25:47.6564492Z                         ):
2025-10-08T16:25:47.6564750Z                             evt_handled = True
2025-10-08T16:25:47.6565052Z                             break
2025-10-08T16:25:47.6565325Z                 if not evt_handled:
2025-10-08T16:25:47.6565632Z                     self.dialect.do_executemany(
2025-10-08T16:25:47.6565945Z                         cursor,
2025-10-08T16:25:47.6566212Z                         str_statement,
2025-10-08T16:25:47.6566511Z                         effective_parameters,
2025-10-08T16:25:47.6566816Z                         context,
2025-10-08T16:25:47.6567069Z                     )
2025-10-08T16:25:47.6567370Z             elif not effective_parameters and context.no_parameters:
2025-10-08T16:25:47.6567752Z                 if self.dialect._has_events:
2025-10-08T16:25:47.6568094Z                     for fn in self.dialect.dispatch.do_execute_no_params:
2025-10-08T16:25:47.6568470Z                         if fn(cursor, str_statement, context):
2025-10-08T16:25:47.6568798Z                             evt_handled = True
2025-10-08T16:25:47.6569239Z                             break
2025-10-08T16:25:47.6569499Z                 if not evt_handled:
2025-10-08T16:25:47.6569789Z                     self.dialect.do_execute_no_params(
2025-10-08T16:25:47.6570098Z                         cursor, str_statement, context
2025-10-08T16:25:47.6570381Z                     )
2025-10-08T16:25:47.6570610Z             else:
2025-10-08T16:25:47.6570873Z                 effective_parameters = cast(
2025-10-08T16:25:47.6571233Z                     "_CoreSingleExecuteParams", effective_parameters
2025-10-08T16:25:47.6571550Z                 )
2025-10-08T16:25:47.6571811Z                 if self.dialect._has_events:
2025-10-08T16:25:47.6572149Z                     for fn in self.dialect.dispatch.do_execute:
2025-10-08T16:25:47.6572599Z                         if fn(
2025-10-08T16:25:47.6572871Z                             cursor,
2025-10-08T16:25:47.6573143Z                             str_statement,
2025-10-08T16:25:47.6573469Z                             effective_parameters,
2025-10-08T16:25:47.6573777Z                             context,
2025-10-08T16:25:47.6574058Z                         ):
2025-10-08T16:25:47.6574340Z                             evt_handled = True
2025-10-08T16:25:47.6574638Z                             break
2025-10-08T16:25:47.6575027Z                 if not evt_handled:
2025-10-08T16:25:47.6575334Z >                   self.dialect.do_execute(
2025-10-08T16:25:47.6575664Z                         cursor, str_statement, effective_parameters, context
2025-10-08T16:25:47.6576032Z                     )
2025-10-08T16:25:47.6576183Z 
2025-10-08T16:25:47.6576493Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: 
2025-10-08T16:25:47.6577029Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:47.6577253Z 
2025-10-08T16:25:47.6577538Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f61d31b0440>
2025-10-08T16:25:47.6578037Z cursor = <sqlite3.Cursor object at 0x7f61c933acc0>
2025-10-08T16:25:47.6578878Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:47.6580033Z parameters = (1,)
2025-10-08T16:25:47.6580466Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f61c9364a50>
2025-10-08T16:25:47.6580831Z 
2025-10-08T16:25:47.6581016Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:47.6581422Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:47.6581754Z E       sqlite3.OperationalError: no such table: user
2025-10-08T16:25:47.6581980Z 
2025-10-08T16:25:47.6582354Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:47.6582814Z 
2025-10-08T16:25:47.6583002Z The above exception was the direct cause of the following exception:
2025-10-08T16:25:47.6583266Z 
2025-10-08T16:25:47.6583367Z app = <Flask 'app'>
2025-10-08T16:25:47.6583508Z 
2025-10-08T16:25:47.6583636Z     def test_api_post_subscriptions(app):
2025-10-08T16:25:47.6583977Z         with app.app_context():
2025-10-08T16:25:47.6584335Z             from app.api.alpha.utils.post import put_post_subscribe
2025-10-08T16:25:47.6584675Z     
2025-10-08T16:25:47.6584888Z             user_id = 1
2025-10-08T16:25:47.6585162Z >           user = User.query.get(user_id)
2025-10-08T16:25:47.6585473Z                    ^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:47.6585642Z 
2025-10-08T16:25:47.6585761Z tests/test_api_post_subscriptions.py:30: 
2025-10-08T16:25:47.6586119Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:47.6586432Z <string>:2: in get
2025-10-08T16:25:47.6586676Z     ???
2025-10-08T16:25:47.6587171Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/util/deprecations.py:386: in warned
2025-10-08T16:25:47.6587773Z     return fn(*args, **kwargs)  # type: ignore[no-any-return]
2025-10-08T16:25:47.6588123Z            ^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:47.6588577Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1126: in get
2025-10-08T16:25:47.6589289Z     return self._get_impl(ident, loading.load_on_pk_identity)
2025-10-08T16:25:47.6589623Z            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-10-08T16:25:47.6590115Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/query.py:1135: in _get_impl
2025-10-08T16:25:47.6590618Z     return self.session._get_impl(
2025-10-08T16:25:47.6591245Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:3873: in _get_impl
2025-10-08T16:25:47.6591779Z     return db_load_fn(
2025-10-08T16:25:47.6592291Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/loading.py:695: in load_on_pk_identity
2025-10-08T16:25:47.6592844Z     session.execute(
2025-10-08T16:25:47.6593307Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2365: in execute
2025-10-08T16:25:47.6593822Z     return self._execute_internal(
2025-10-08T16:25:47.6594496Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/session.py:2251: in _execute_internal
2025-10-08T16:25:47.6595111Z     result: Result[Any] = compile_state_cls.orm_execute_statement(
2025-10-08T16:25:47.6595744Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
2025-10-08T16:25:47.6596307Z     result = conn.execute(
2025-10-08T16:25:47.6596785Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1419: in execute
2025-10-08T16:25:47.6597303Z     return meth(
2025-10-08T16:25:47.6597809Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
2025-10-08T16:25:47.6598386Z     return connection._execute_clauseelement(
2025-10-08T16:25:47.6598962Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
2025-10-08T16:25:47.6599706Z     ret = self._execute_context(
2025-10-08T16:25:47.6600231Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
2025-10-08T16:25:47.6600784Z     return self._exec_single_context(
2025-10-08T16:25:47.6601334Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
2025-10-08T16:25:47.6601923Z     self._handle_dbapi_exception(
2025-10-08T16:25:47.6602473Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
2025-10-08T16:25:47.6603119Z     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
2025-10-08T16:25:47.6603738Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
2025-10-08T16:25:47.6604312Z     self.dialect.do_execute(
2025-10-08T16:25:47.6604639Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2025-10-08T16:25:47.6604881Z 
2025-10-08T16:25:47.6605173Z self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x7f61d31b0440>
2025-10-08T16:25:47.6605684Z cursor = <sqlite3.Cursor object at 0x7f61c933acc0>
2025-10-08T16:25:47.6606526Z statement = 'SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS ...le_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id \nWHERE user.id = ?'
2025-10-08T16:25:47.6607360Z parameters = (1,)
2025-10-08T16:25:47.6607786Z context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x7f61c9364a50>
2025-10-08T16:25:47.6608159Z 
2025-10-08T16:25:47.6608355Z     def do_execute(self, cursor, statement, parameters, context=None):
2025-10-08T16:25:47.6608733Z >       cursor.execute(statement, parameters)
2025-10-08T16:25:47.6609390Z E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:47.6624606Z E       [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:47.6640215Z E       FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:47.6640923Z E       WHERE user.id = ?]
2025-10-08T16:25:47.6641202Z E       [parameters: (1,)]
2025-10-08T16:25:47.6641582Z E       (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:47.6641861Z 
2025-10-08T16:25:47.6642234Z /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/sqlalchemy/engine/default.py:951: OperationalError
2025-10-08T16:25:47.6642877Z ------------------------------ Captured log setup ------------------------------
2025-10-08T16:25:47.6643275Z INFO     app:__init__.py:298 Started!
2025-10-08T16:25:47.6643647Z INFO     app:startup_validation.py:102 Running startup validations...
2025-10-08T16:25:47.6644090Z INFO     app:startup_validation.py:118 Startup validations completed
2025-10-08T16:25:47.6644499Z =============================== warnings summary ===============================
2025-10-08T16:25:47.6644930Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions
2025-10-08T16:25:47.6645906Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:32: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:47.6646841Z     numpy_installed = find_loader('numpy') is not None
2025-10-08T16:25:47.6647058Z 
2025-10-08T16:25:47.6647260Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions
2025-10-08T16:25:47.6648224Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pytesseract/pytesseract.py:36: DeprecationWarning: 'pkgutil.find_loader' is deprecated and slated for removal in Python 3.14; use importlib.util.find_spec() instead
2025-10-08T16:25:48.2490773Z     pandas_installed = find_loader('pandas') is not None
2025-10-08T16:25:48.2491318Z 
2025-10-08T16:25:48.2491726Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions
2025-10-08T16:25:48.2493503Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: tagMap is deprecated. Please use TAG_MAP instead.
2025-10-08T16:25:48.2495359Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:48.2496059Z 
2025-10-08T16:25:48.2496426Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions
2025-10-08T16:25:48.2497596Z   /opt/hostedtoolcache/Python/3.13.7/x64/lib/python3.13/site-packages/pyasn1/codec/ber/encoder.py:952: DeprecationWarning: typeMap is deprecated. Please use TYPE_MAP instead.
2025-10-08T16:25:48.2498810Z     warnings.warn(f"{attr} is deprecated. Please use {newAttr} instead.", DeprecationWarning)
2025-10-08T16:25:48.2499531Z 
2025-10-08T16:25:48.2499773Z tests/test_api_post_subscriptions.py::test_api_post_subscriptions
2025-10-08T16:25:48.2501776Z   /home/runner/work/pyfedi/pyfedi/tests/test_api_post_subscriptions.py:30: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
2025-10-08T16:25:48.2502932Z     user = User.query.get(user_id)
2025-10-08T16:25:48.2503096Z 
2025-10-08T16:25:48.2503293Z -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
2025-10-08T16:25:48.2503684Z =========================== short test summary info ============================
2025-10-08T16:25:48.2504471Z FAILED tests/test_api_post_subscriptions.py::test_api_post_subscriptions - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
2025-10-08T16:25:48.2519766Z [SQL: SELECT user.id AS user_id, user.user_name AS user_user_name, user.alt_user_name AS user_alt_user_name, user.title AS user_title, user.email AS user_email, user.password_hash AS user_password_hash, user.verified AS user_verified, user.verification_token AS user_verification_token, user.banned AS user_banned, user.banned_until AS user_banned_until, user.ban_posts AS user_ban_posts, user.ban_comments AS user_ban_comments, user.deleted AS user_deleted, user.deleted_by AS user_deleted_by, user.about AS user_about, user.about_html AS user_about_html, user.keywords AS user_keywords, user.matrix_user_id AS user_matrix_user_id, user.hide_nsfw AS user_hide_nsfw, user.hide_nsfl AS user_hide_nsfl, user.created AS user_created, user.last_seen AS user_last_seen, user.avatar_id AS user_avatar_id, user.cover_id AS user_cover_id, user.public_key AS user_public_key, user.private_key AS user_private_key, user.newsletter AS user_newsletter, user.email_unread AS user_email_unread, user.email_unread_sent AS user_email_unread_sent, user.receive_message_mode AS user_receive_message_mode, user.bounces AS user_bounces, user.timezone AS user_timezone, user.reputation AS user_reputation, user.attitude AS user_attitude, user.post_count AS user_post_count, user.post_reply_count AS user_post_reply_count, user.stripe_customer_id AS user_stripe_customer_id, user.stripe_subscription_id AS user_stripe_subscription_id, user.searchable AS user_searchable, user.indexable AS user_indexable, user.bot AS user_bot, user.bot_override AS user_bot_override, user.suppress_crossposts AS user_suppress_crossposts, user.vote_privately AS user_vote_privately, user.ignore_bots AS user_ignore_bots, user.unread_notifications AS user_unread_notifications, user.ip_address AS user_ip_address, user.ip_address_country AS user_ip_address_country, user.instance_id AS user_instance_id, user.reports AS user_reports, user.default_sort AS user_default_sort, user.default_comment_sort AS user_default_comment_sort, user.default_filter AS user_default_filter, user.theme AS user_theme, user.font AS user_font, user.community_keyword_filter AS user_community_keyword_filter, user.referrer AS user_referrer, user.markdown_editor AS user_markdown_editor, user.interface_language AS user_interface_language, user.language_id AS user_language_id, user.read_language_ids AS user_read_language_ids, user.reply_collapse_threshold AS user_reply_collapse_threshold, user.reply_hide_threshold AS user_reply_hide_threshold, user.feed_auto_follow AS user_feed_auto_follow, user.feed_auto_leave AS user_feed_auto_leave, user.accept_private_messages AS user_accept_private_messages, user.google_oauth_id AS user_google_oauth_id, user.hide_low_quality AS user_hide_low_quality, user.show_subscribed_communities AS user_show_subscribed_communities, user.additional_css AS user_additional_css, user.mastodon_oauth_id AS user_mastodon_oauth_id, user.discord_oauth_id AS user_discord_oauth_id, user.password_updated_at AS user_password_updated_at, user.ap_id AS user_ap_id, user.ap_profile_id AS user_ap_profile_id, user.ap_public_url AS user_ap_public_url, user.ap_fetched_at AS user_ap_fetched_at, user.ap_followers_url AS user_ap_followers_url, user.ap_preferred_username AS user_ap_preferred_username, user.ap_manually_approves_followers AS user_ap_manually_approves_followers, user.ap_deleted_at AS user_ap_deleted_at, user.ap_inbox_url AS user_ap_inbox_url, user.ap_domain AS user_ap_domain, user.search_vector AS user_search_vector, user.hide_read_posts AS user_hide_read_posts, file_1.id AS file_1_id, file_1.file_path AS file_1_file_path, file_1.file_name AS file_1_file_name, file_1.width AS file_1_width, file_1.height AS file_1_height, file_1.alt_text AS file_1_alt_text, file_1.source_url AS file_1_source_url, file_1.thumbnail_path AS file_1_thumbnail_path, file_1.thumbnail_width AS file_1_thumbnail_width, file_1.thumbnail_height AS file_1_thumbnail_height, file_1.hash AS file_1_hash, file_2.id AS file_2_id, file_2.file_path AS file_2_file_path, file_2.file_name AS file_2_file_name, file_2.width AS file_2_width, file_2.height AS file_2_height, file_2.alt_text AS file_2_alt_text, file_2.source_url AS file_2_source_url, file_2.thumbnail_path AS file_2_thumbnail_path, file_2.thumbnail_width AS file_2_thumbnail_width, file_2.thumbnail_height AS file_2_thumbnail_height, file_2.hash AS file_2_hash, instance_1.id AS instance_1_id, instance_1.domain AS instance_1_domain, instance_1.inbox AS instance_1_inbox, instance_1.shared_inbox AS instance_1_shared_inbox, instance_1.outbox AS instance_1_outbox, instance_1.vote_weight AS instance_1_vote_weight, instance_1.software AS instance_1_software, instance_1.version AS instance_1_version, instance_1.created_at AS instance_1_created_at, instance_1.updated_at AS instance_1_updated_at, instance_1.last_seen AS instance_1_last_seen, instance_1.last_successful_send AS instance_1_last_successful_send, instance_1.failures AS instance_1_failures, instance_1.most_recent_attempt AS instance_1_most_recent_attempt, instance_1.dormant AS instance_1_dormant, instance_1.start_trying_again AS instance_1_start_trying_again, instance_1.gone_forever AS instance_1_gone_forever, instance_1.ip_address AS instance_1_ip_address, instance_1.trusted AS instance_1_trusted, instance_1.posting_warning AS instance_1_posting_warning, instance_1.nodeinfo_href AS instance_1_nodeinfo_href 
2025-10-08T16:25:48.2535179Z FROM user LEFT OUTER JOIN file AS file_1 ON file_1.id = user.avatar_id LEFT OUTER JOIN file AS file_2 ON file_2.id = user.cover_id LEFT OUTER JOIN instance AS instance_1 ON instance_1.id = user.instance_id 
2025-10-08T16:25:48.2535835Z WHERE user.id = ?]
2025-10-08T16:25:48.2536037Z [parameters: (1,)]
2025-10-08T16:25:48.2536311Z (Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-08T16:25:48.2536677Z ======================== 1 failed, 5 warnings in 2.61s =========================
2025-10-08T16:25:48.9667394Z Post job cleanup.
2025-10-08T16:25:49.0934231Z Cache hit occurred on the primary key Linux-pip-93b72d60a1f660b784d6309a0b22f127a738518ffed9eeb65aa476cd228c20e5, not saving cache.
2025-10-08T16:25:49.1021458Z Post job cleanup.
2025-10-08T16:25:49.2691383Z Post job cleanup.
2025-10-08T16:25:49.3621185Z [command]/usr/bin/git version
2025-10-08T16:25:49.3664126Z git version 2.51.0
2025-10-08T16:25:49.3707026Z Temporarily overriding HOME='/home/runner/work/_temp/982ef28c-2d49-45e2-a350-844e11e3dda7' before making global git config changes
2025-10-08T16:25:49.3708361Z Adding repository directory to the temporary git global config as a safe directory
2025-10-08T16:25:49.3713228Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/pyfedi/pyfedi
2025-10-08T16:25:49.3747727Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-10-08T16:25:49.3780382Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-10-08T16:25:49.4006858Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-10-08T16:25:49.4027563Z http.https://github.com/.extraheader
2025-10-08T16:25:49.4039906Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2025-10-08T16:25:49.4070096Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-10-08T16:25:49.4393247Z Cleaning up orphan processes